Version 1
SubGoalCombiner SGC_AND
INITSECTION
//DB_DeathFogIgnoreTriggers((TRIGGERGUID)TRIGGERGUID_S_ARX_OutsideArx_70258644-e81b-43b0-872c-d695cc32cdeb);
DB_DeathFogIgnoreTriggers((TRIGGERGUID)TRIGGERGUID_S_ARX_Sewers_456f708b-fbf8-4d93-ae34-78c969c22b2c);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_Sewers_QueensFloor_c2ac0f3b-cea2-4c74-a3bf-2b4e82a54b85);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_KemmVault_Floor_01_8bd84dae-9618-4027-9a62-a03bc59a7beb);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_KemmVault_SecondFloor_c3c87da9-f9ae-4954-9402-6906b1c23d86);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_KemmVault_Floor_03_0a0bfbfb-1a85-4acf-9d71-f0db7c9dca97);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_HorrorSleep_WarZone_59391e6d-a22d-4f33-982b-a5b65c023e21);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_HorrorSleep_Arena_1b8cf005-392f-434a-a564-ecae6778fab0);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_HorrorSleep_Sunset_67df0f1c-9cf2-46c5-8b28-64376a9b274c);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_LV_Top_c45f8ae9-3576-49ae-b7cf-2a00c5a07335);
DB_DeathFogIgnoreTriggers(TRIGGERGUID_S_ARX_LV_Bot_6a0f9b76-2e10-428b-a4ed-bcff3786b9bb);
DB_DeathFogIgnoreTriggers(S_ARX_Prison_TheMistakeTrigger_36773fe5-0673-4668-8e10-b68c3ba811be);

//DB_Dialogs(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,"ARX_Sewers_DoomsdayDevice");
SetVisible(CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,0);
ProcSetInvulnerable(CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,1);
CharacterSetImmortal(CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,1);

DB_DeathFogIgnoreTag("UNDEAD");
DB_DeathFogIgnoreTag("MASKED_UNDEAD");
DB_DeathFogIgnoreTag("DEATHFOG_IMMUNE");
DB_DeathFogIgnoreTag("CONSTRUCT");
DB_DeathFogIgnoreTag("VOIDWOKEN");
DB_DeathFogIgnoreTag("DEMON");

DB_Arx_Deathfog_LeaveParty((CHARACTERGUID)CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,1,"QuestUpdate_FTJ_COM_Ifan_DeathfogLeave");
DB_Arx_Deathfog_LeaveParty(CHARACTERGUID_S_Player_Beast_f25ca124-a4d2-427b-af62-df66df41a978,4000,"QuestUpdate_FTJ_COM_Beast_DeathfogLeave");

DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_000_a04a6e27-eb97-42db-a6d8-1e5e5ac5e5b5);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_001_bef86aa0-5d8f-498c-92bf-1834b79b3115);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_002_de8e8304-7db5-4e0b-af86-33e48d8772e0);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_003_a1a795fd-c044-44d3-bd69-c120347bd980);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_004_7efb8f1b-215e-4680-8dab-29c00fc47eda);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_005_62103ba9-7c4d-4cb7-9f97-2b61036f6b61);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_006_b1fe08b1-165a-45cb-b8c8-64ec319e4f31);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_007_969ab4ac-167a-49d2-a534-6ef5a674f180);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_008_321c731b-ceae-4520-a107-a81ef5ca3aa9);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_009_e5a25629-b198-4db5-90d4-689d09fedb74);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_010_ab8f0c60-663e-44a0-83d4-5ec8f35a669e);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_011_175b15d2-c36c-44f5-89f5-8085abc96dbd);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_012_efca31d8-a4bd-4fa6-9eb7-045c29e16cd1);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_013_116a1d17-da7c-4bb9-94dc-36fc6fc2e9f8);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_014_9aba79ee-501c-41b6-883a-3ddb39086e25);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_015_705b604b-f751-42d7-9520-3a0f499d7dc8);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_016_2decb894-0a8c-4394-a2e8-3144bf42def6);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_017_9a4bee27-003d-4a60-9f25-f86bd44ccf2c);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_018_5770f80c-0c84-4f88-b6d2-50f6c0f4b727);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_019_c9b84534-e4ee-468b-977f-bbb5e6dc2a67);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_020_6f5871c7-240c-477f-abeb-a8251cc4724d);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_021_dbb16e99-b394-4b62-a2b0-4083bcf8ef16);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_022_a30eda0a-1a29-45c0-b98b-08eee35b00f8);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_023_e3a67e44-9378-4c51-818c-36bf465a4d02);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_024_e8a6df62-5017-4f37-9608-95dcc5ac88ae);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_025_ddbca359-574e-47ba-b9ce-4a8d0c6c4891);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_026_6de37e28-8aca-48f3-b638-bd752ed03d32);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_027_f3ccc355-6761-477c-87b5-31d5c430c11b);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_028_be3011f0-c638-4464-ab0b-d0fdaf346ebb);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_029_44f34442-0c67-4e41-b85f-8c7f8c7a56e6);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_030_0f0bb1a1-2b74-4f9b-a7e7-69c2f551e3ab);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_031_fadfe339-00eb-43a8-b82e-9a03163db5e8);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_032_6364443d-3230-4f44-b69d-1937846bbcdf);
DB_DeathFog_PuddlePoint(TRIGGERGUID_S_ARX_DeathFog_PuddlePoint_033_b35ee9fd-10ba-4a1c-ae32-d0bd17729a8a);

DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_01_69ecdc7d-8e1b-47f0-a483-0e4188d942a1,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_02_60d566dd-d03c-489a-8b54-7fdf8b1f824d,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_03_f3f31f34-13cf-42c0-8e3a-45f3c81d5591,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_04_7ba9660f-6c40-43e9-b5a7-d97fd00d412f,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_05_62cff6e3-594d-4114-8764-93b69eae03aa,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_06_939bbbc9-f0b7-4dbc-bfe8-c0c177353752,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_08_d6c37582-c840-4944-972c-23e2e758a668,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_09_45f3cfe9-8c1e-4949-b46e-f29a9bf9501e,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_10_750ba532-efbf-4201-ab7f-4a21c430ebc8,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_11_72e305dd-ba9a-4ec2-804e-995e95ff5b27,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_12_0fa8b324-aad4-4ea6-9ded-7b5ed080eab1,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_13_a6844493-61cf-4d3e-a7d1-6a2bf9f67973,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_14_db027113-0ca3-4971-8e4a-854eb0e84b75,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_15_5167a0e3-18ea-4015-bda8-7a48c2c4bcdc,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_16_1581a8eb-7447-4fcf-af6e-92d0c20fa4eb,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_17_dbcab706-137e-4d29-ba44-0d22383f65bd,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_18_65e060d7-53f1-4b59-a770-80e0461a633d,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_19_44496c11-b65d-488f-af36-5045b4df4fb3,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_20_0540d28e-b097-4bb2-aa5f-9030db9826ad,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_21_49fbc7c9-7d37-4ef2-9a51-dd498db5ca9d,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_22_d2b14311-4e9f-469d-af82-abea4cfba4e2,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_23_e27e7201-d822-4911-b061-d2899ced3e8c,"RS3_FX_Environment_Cloud_Deathfog_Big_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_24_f44b9119-fe92-4249-87b5-666a000293e3,"RS3_FX_Environment_Cloud_Deathfog_Medium_A");
DB_DeathFog_PuddlePoint_Sea(TRIGGERGUID_S_ARX_Sea_DeathfogPoint_25_82c63ede-ad93-44c4-881a-5bdbc398f6e0,"RS3_FX_Environment_Cloud_Deathfog_Big_A");

//ATM_PBR_Default_EvenMoreSmallScale_Rift_A <29d7b32e-03ec-47fc-ac92-425b5e95872c>
DB_DeathFog_AtmTrig((TRIGGERGUID)TRIGGERGUID_ATM_ARX_AlchemistHouse_6a53c5ac-6fc5-4ae1-b6d7-040d6c258a26,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_AlchemistUndergroundFight_002_Arx_AlchemistCellar_Develop_000_facf6e9b-8a69-8b7a-2aa5-96a07116c812,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Barrack_Archive_c7556769-52fc-46c3-8a8f-58fd20c6bd89,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Barrack_Cellar_d6b9ec82-9ab0-4079-822e-2b9e9e477e44,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_BlackHouseCellar_A_Arx_000_5aee26e1-b302-c3a0-ccf8-027428a3c7c7,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_BlackHouseCellar_B_1dba9990-b3ad-471b-b076-8a17114bc795,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Cellars_b8d26336-5865-4b68-ba14-82586f421279,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Kemm_Noble_972af7d5-79e0-84ab-5b7b-a2885ff7c618,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Prison_b338624b-f73b-8485-37db-53d22439fd81,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_PrisonBasement_1b69bc81-ffb4-4d9e-a88d-0d80cd24e6f0,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_PrisonSewers_3ca67f52-fceb-85d4-393d-3f671fa0e9ef,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_SecondFloors_001_1707ac46-df2e-4c77-ab83-8b178610e96c,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_SewersCrossRoads_00fb566a-fc88-4e86-b2eb-8731004db89c,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
DB_DeathFog_AtmTrig(TRIGGERGUID_S_ATM_ARX_TheMistakeIsFree_GloomTrigger_9ce919b8-1919-46fc-869b-6b4819b903ce,"29d7b32e-03ec-47fc-ac92-425b5e95872c"); //inside
//ATM_PBR_Default_EvenMoreSmallScale_Rift_C <9cb2f29e-cd03-421f-885e-a9b7e9299ae6>
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_ArxCity_75ec6c14-4ac9-40af-a423-733e5bab5fd9,"6709f79f-8208-499b-ac9f-f46d5f058470"); //outside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Decks_49f657c1-ff67-46b8-acbf-5b646b0a240e,"6709f79f-8208-499b-ac9f-f46d5f058470"); //outside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Outskirts_2b163d9e-2e75-4c2d-9a78-45eb148f5f30,"6709f79f-8208-499b-ac9f-f46d5f058470"); //outside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_ClanWars_8ae8183c-555a-4841-851c-ae850be4b2d8,"6709f79f-8208-499b-ac9f-f46d5f058470"); //outside

//ATM_PBR_Default_EvenMoreSmallScale_Rift_B <8870bb3a-e54d-4fb4-bc41-a1e7338679f2>
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Barracks_fbd5d7ea-241f-4472-8d6c-14a28573c8de,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_BlackHouse_7734a003-69ea-49df-8d34-03895429b68c,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_City_Garage_A_0fe255b9-cbda-48d9-bcee-6cf957408c77,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_FenceHouse_a1383896-0c51-4a6b-a478-e55a06fea560,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_HarbourHouse_A_813a04b7-2f90-44e1-ad49-0cbab44ea4b2,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_KemmsMansionFirstFloor_ddf5a3e2-a826-436b-900a-e29c750d6fb4,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Kemms_OwlHouse_4ab126b4-097c-45eb-a4e9-b40ac0a7a375,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_LoreMasterHouse_764eefe6-28d8-4a42-8249-7a620db8762e,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_Merchant_Estate_ecae3ac4-2910-46a5-a609-5878929c50d0,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_School_07bf04e1-486e-49f4-b509-3155f3d4b3af,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_ATM_ARX_ToyMakerHouse_a1f3947e-3885-4712-bad7-34e8d4ae9771,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside
DB_DeathFog_AtmTrig(TRIGGERGUID_AtmosphereTrigger_ARX_Cathedral_A_0e355d23-e59d-41ad-a27e-d34643bd1bde,"8870bb3a-e54d-4fb4-bc41-a1e7338679f2"); //outside-inside


//REGION
Proc_RegisterPartyDecisionDialogOutcomes_Fixed("ARX_Sewers_PDD_DoomsdayDevice","ARX_Sewers_PDD_DoomsdayDevice_Destroy","ARX_Sewers_PDD_DoomsdayDevice_ToSea","ARX_Sewers_PDD_DoomsdayDevice_ToArx","","");

DB_Queue_PDD_DoomsdayDevice("FixedAChosen","Queue_FixedAChosen");
DB_Queue_PDD_DoomsdayDevice("FixedBChosen","Queue_FixedBChosen");

//END_REGION

//REGION journal updates, DOS2EE-4013
DB_ARX_TheImperialDwarves_DeathfogEntries("QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_DestroyedMachine","QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_DestroyedMachine_CLOSE","QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_DestroyedMachine_Queen");
DB_ARX_TheImperialDwarves_DeathfogEntries("QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_ReleasedToSea","QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_ReleasedToSea_CLOSE","QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_ReleasedToSea_Queen");


DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Sewers_ThiefGhost_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Sewers_ThiefGhost");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Ros_EnteredSewers_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Ros_EnteredSewers");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_Found_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Sewers_EnteredQueensRoom");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_Confront_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Sewers_MetTheQueenWithQ");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsDead_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsDead");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_Spared_SUBA","ARX_Sewers_PDD_QueensFate_Safe");
DB_QuestMerge_TheImperialDwarves("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsSafe_SUBA","QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsSafe");

DB_JDF_QuestLinkedFlag("QuestUpdate_RC_ARX_TheImperialDwarves_Ros_SaveTheQueen","QuestUpdate_RC_ARX_TheImperialDwarves_Ros_SaveTheQueen");

//END_REGION
KBSECTION
//REGION genocide
IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
DB_ARX_Sewers_DoomsdayDevice_Activate(_Char)
AND
DB_Arx_Deathfog_LeaveParty(_AngryPartymember,_Delay,_Journal)
AND
NOT DB_Avatars(_AngryPartymember)
AND
_Char != _AngryPartymember
AND
QRY_SameUser(_Char,_AngryPartymember)
THEN
ObjectSetFlag(_AngryPartymember,_Journal);
PROC_Origins_CompanionLeavePermanently(_AngryPartymember);
SetVarFixedString(_AngryPartymember,"currentState","");
SetRelationIndivFactionToPlayers(_AngryPartymember,0);
Proc_OriginLeft(_AngryPartymember,"_Deathfog");
ProcObjectTimer(_AngryPartymember,"ARX_Deathfog_CompanionLeavesDialog",_Delay);

PROC
ProcObjectTimerFinished(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"ARX_Deathfog_CompanionLeavesDialog")
THEN
Proc_StartDialog(1,"ARX_AD_Ifan_AfterDeathfog",CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f);

PROC
ProcObjectTimerFinished(CHARACTERGUID_S_Player_Beast_f25ca124-a4d2-427b-af62-df66df41a978,"ARX_Deathfog_CompanionLeavesDialog")
THEN
Proc_StartDialog(1,"ARX_AD_Beast_AfterDeathfog",CHARACTERGUID_S_Player_Beast_f25ca124-a4d2-427b-af62-df66df41a978);

IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
DB_ARX_Sewers_DoomsdayDevice_Activate(_Char)
THEN
NOT DB_ARX_Sewers_DoomsdayDevice_Activate(_Char);
ProcDefineReflectionDialog("ARX_RD_ActivatedDeathFogMachine",(CHARACTERGUID)_Char);

IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_Twist",_Char,_)
THEN
PlayAnimation(_Char,"use_activate");
PlayAnimation(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"Lever");
//PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SetState_Items_Objects_MCH_Laboratory_Machines_Turbine_A_Loop_Inactive");
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Items_Objects_MCH_Laboratory_Machines_Turbine_A","Items_Objects_MCH_Laboratory_Machines_Turbine_A_Inactive",1);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Soundvol_Arx_Sewers_DeathfogMachine_Active","Soundvol_Arx_Sewers_DeathfogMachine_Inactive",1);
PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SE_ARX_DeathfogEvents_Release_ToArx");
ObjectSetFlag(_Char,"GLO_PathOfBlood_MurderedInnocent");


IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_Activate",(CHARACTERGUID)_Char,_)
THEN
Proc_ARX_Sewers_DoomsdayDevice_ActivateAnimations(_Char); 


IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_Activate",(CHARACTERGUID)_Char,_)
//CharacterUsedItem(_,ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
THEN
DB_ARX_Sewers_DoomsdayDevice_Activate(_Char);
UserSetFlag(_Char,"ARX_PlayerUsedDeathFogMachine");
GlobalSetFlag("ARX_InitiateGenocide");

IF
CharacterDied(_Char)
AND
GlobalGetFlag("Arx_Sewers_Q_PlayerArrested_QueueGenocide",1)
AND
DB_InRegion(_Char,TRIGGERGUID_S_ARX_Sewers_QueensFloor_c2ac0f3b-cea2-4c74-a3bf-2b4e82a54b85)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
AND
CharacterIsDead(CHARACTERGUID_S_ARX_Sewers_Q_52f20922-7b22-4d47-90f7-83172f21fe3b,0)
THEN
Proc_ARX_Sewers_Genocide_CheckForPlayers();

IF
CharacterLeftTrigger(_,TRIGGERGUID_S_ARX_Sewers_QueensFloor_c2ac0f3b-cea2-4c74-a3bf-2b4e82a54b85)
AND
GlobalGetFlag("Arx_Sewers_Q_PlayerArrested_QueueGenocide",1)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
AND
CharacterIsDead(CHARACTERGUID_S_ARX_Sewers_Q_52f20922-7b22-4d47-90f7-83172f21fe3b,0)
THEN
Proc_ARX_Sewers_Genocide_CheckForPlayers();

PROC
Proc_ARX_Sewers_Genocide_CheckForPlayers()
THEN
NOT DB_ARX_Sewers_Genocide_CheckForPlayers_InRegion(1);

PROC
Proc_ARX_Sewers_Genocide_CheckForPlayers()
AND
DB_IsPlayer(_Char)
AND
DB_InRegion(_Char,TRIGGERGUID_S_ARX_Sewers_QueensFloor_c2ac0f3b-cea2-4c74-a3bf-2b4e82a54b85)
AND
CharacterIsDead(_Char,0)
THEN
DB_ARX_Sewers_Genocide_CheckForPlayers_InRegion(1);

PROC
Proc_ARX_Sewers_Genocide_CheckForPlayers()
AND
NOT DB_ARX_Sewers_Genocide_CheckForPlayers_InRegion(1)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
THEN
GlobalSetFlag("ARX_InitiateGenocide");
GlobalSetFlag("RC_ARX_TheImperialDwarves_Deathfog_FleeIsbeil_SetUpdate");
NOT DB_ARX_Sewers_Genocide_CheckForPlayers_InRegion(1);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Items_Objects_MCH_Laboratory_Machines_Turbine_A","Items_Objects_MCH_Laboratory_Machines_Turbine_A_Inactive",1);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Soundvol_Arx_Sewers_DeathfogMachine_Active","Soundvol_Arx_Sewers_DeathfogMachine_Inactive",1);
PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SE_ARX_DeathfogEvents_Release_ToArx");
PlayAnimation(ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Turbine_a9ed5c0e-ee01-45df-9cd4-4d74e48df573,"custom1");
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Up_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_01_0c234f01-0ef2-40c9-b195-c25ab3599921,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Up_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_02_9cd7bebf-1e03-4f66-b9e7-feccd62f21bb,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");

IF
GlobalFlagSet("RC_ARX_TheImperialDwarves_Deathfog_FleeIsbeil_SetUpdate")
AND
DB_IsPlayer(_Char)
THEN
ObjectSetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Deathfog_FleeIsbeil");


IF
TextEventSet("deathfog")
THEN
GlobalSetFlag("ARX_InitiateGenocide");

IF
GlobalFlagSet("ARX_InitiateGenocide")
AND
DB_CurrentLevel("ARX_Main")
AND
QueryOnlyOnce("ARX_InitiateGenocide_Iterator")
THEN
Proc_Arx_InitiateGenocide_CreateSurfaces();
Proc_Arx_DeathFog_SetAtm();
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Main_2b111616-c09a-4614-9941-d3574e468c19, "ARX_Dead", "Dead", 1);
CharacterLaunchOsirisOnlyIterator("ARX_InitiateGenocide_Iterator");
TimerLaunch("Arx_InitiateDeaths",0);

IF
StoryEvent((CHARACTERGUID)_Char,"ARX_InitiateGenocide_Iterator")
AND
CharacterIsDead(_Char,0)
THEN
Proc_Arx_InitiateGenocide(_Char);


PROC
Proc_Arx_InitiateGenocide((CHARACTERGUID)_Char)
AND
DB_DeathFogIgnoreTriggers(_Trig)
AND
ObjectIsInTrigger(_Char,_Trig,1)
THEN
DB_DeathFogIgnoreChar(_Char);

PROC
Proc_Arx_InitiateGenocide((CHARACTERGUID)_Char)
AND
NOT DB_DeathFogIgnoreChar(_Char)
AND
DB_DeathFogIgnoreTriggers(_Trig)
AND
DB_InRegion(_Char,_Trig)
THEN
DB_DeathFogIgnoreChar(_Char);

PROC
Proc_Arx_InitiateGenocide((CHARACTERGUID)_Char)
AND
NOT DB_DeathFogIgnoreChar(_Char)
AND
DB_DeathFogIgnoreTag(_Tag)
AND
IsTagged(_Char,_Tag,1)
THEN
DB_DeathFogIgnoreChar(_Char);

PROC
Proc_Arx_InitiateGenocide((CHARACTERGUID)_Char)
AND
NOT DB_DeathFogIgnoreChar(_Char)
THEN
Proc_ArxInitiateGenocide_RecordCharacter(_Char);

PROC
Proc_ArxInitiateGenocide_RecordCharacter((CHARACTERGUID)_Char)
AND
NOT DB_ArxGenocideCounter(_)
THEN
DB_ArxGenocideCounter(0);
DB_ArxGenocideCurrentDeathcounter(0);

PROC
Proc_ArxInitiateGenocide_RecordCharacter((CHARACTERGUID)_Char)
AND
IsTagged(_Char,"KID",1)
AND
IsTagged(_Char,"GHOST",0)
THEN
SetOnStage(_Char,0);

PROC
Proc_ArxInitiateGenocide_RecordCharacter((CHARACTERGUID)_Char)
AND
IsTagged(_Char,"KID",0)
AND
IsTagged(_Char,"GHOST",0)
AND
DB_ArxGenocideCounter(_Count)
AND
IntegerSum(_Count,1,_NewCount)
THEN
DB_ArxGenocideEntry(_NewCount,_Char);
NOT DB_ArxGenocideCounter(_Count);
DB_ArxGenocideCounter(_NewCount);

IF
TimerFinished("Arx_InitiateDeaths")
AND
DB_ArxGenocideCurrentDeathcounter(_Count)
AND
IntegerSum(_Count,20,_NewCount)
THEN
Proc_ArxGenocideKillUpTo(_NewCount);
NOT DB_ArxGenocideCurrentDeathcounter(_Count);
DB_ArxGenocideCurrentDeathcounter(_NewCount);
TimerLaunch("Arx_InitiateDeaths",100);
Proc_ArxGenocideCheckRemainingDeaths();

PROC
Proc_ArxGenocideCheckRemainingDeaths()
AND
NOT DB_ArxGenocideEntry(_,_)
THEN
TimerCancel("Arx_InitiateDeaths");

PROC
Proc_ArxGenocideKillUpTo((INTEGER)_Count)
AND
DB_ArxGenocideEntry(_Index,_Char)
AND
_Index<=_Count
THEN
Proc_Arx_InitiateGenocide_Kill(_Char);
NOT DB_ArxGenocideEntry(_Index,_Char);

PROC
Proc_Arx_InitiateGenocide_Kill((CHARACTERGUID)_Char)
THEN
CharacterDie(_Char,1,"Acid");

IF
CharacterEnteredTrigger(_Char,TRIGGERGUID_S_SUB_Arx_cb6e79c8-f5f8-49d7-8d46-133e2d13349d)
AND
GlobalGetFlag("ARX_InitiateGenocide",1)
AND
QueryOnlyOnce("ARX_InitiateGenocide_InitiateTimers")
THEN
DB_ARX_InitiateGenocide_InitiateTimers(_Char);
TimerLaunch("ARX_InitiateGenocide_InitiateVB",10000);

IF
TimerFinished("ARX_InitiateGenocide_InitiateVB")
AND
DB_ARX_InitiateGenocide_InitiateTimers(_Char)
THEN
StartVoiceBark("ARX_VB_DeathFogReflection",_Char);
Proc_DeathFog_ClearDBs();

PROC
Proc_Arx_InitiateGenocide_CreateSurfaces()
AND
DB_DeathFog_PuddlePoint(_Trig)
THEN
CreatePuddle(_Trig,"SurfaceDeathfogCloud",200,300,30,50,0.5);

//END_REGION

//REGION doomsday device dialog
IF
CharacterUsedItem(_Char,ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786)
AND
IsSpeakerReserved(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,0)
THEN
Proc_StartDialog(0,"ARX_Sewers_DoomsdayDevice",ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,_Char);

IF
DialogStarted("ARX_Sewers_PDD_DoomsdayDevice",_Id)
THEN
//DialogAddActor(_Id,CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901);
DialogAddActorAt(_Id,CHARACTERGUID_S_ARX_GodKing_InvisHelper_DoomsdayDevice_a2a122de-264c-482a-b861-5dcf5274e901,5);


IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
AND
DB_IsPlayer(_Char)
AND
ObjectGetFlag(_Char,"ARX_Sewers_DoomsdayDevice_GodKing_Queue",1)
THEN
ObjectSetFlag(_Char,"ARX_TheEighth_Punish_Deathfog");

//ARX_Sewers_DoomsdayDevice_Destroy
//ARX_Sewers_DoomsdayDevice_ToSea
IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_Twist_ToSea",_Char,_)
THEN
PlayAnimation(_Char,"use_activate");
PlayAnimation(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"Lever");
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Items_Objects_MCH_Laboratory_Machines_Turbine_A","Items_Objects_MCH_Laboratory_Machines_Turbine_A_Inactive",1);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Soundvol_Arx_Sewers_DeathfogMachine_Active","Soundvol_Arx_Sewers_DeathfogMachine_Inactive",1);
PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SE_ARX_DeathfogEvents_Release_ToSea");


IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_ToSea",(CHARACTERGUID)_Char,_)
THEN
Proc_ARX_Sewers_DoomsdayDevice_ActivateAnimations(_Char); 


IF
ObjectFlagSet("ARX_TheEighth_Punish_Deathfog",_Char,_Inst)
AND
DB_Queue_PDD_DoomsdayDevice(_Fixed,_Queue)
AND
ObjectGetFlag(_Char,_Queue,1)
THEN
ObjectSetFlag(_Char,_Fixed);
ObjectClearFlag(_Char,_Queue);
//END_REGION

//REGION ARX_Sewers_DoomsdayDevice_Destroy
IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_Destroy",(CHARACTERGUID)_Char,_)
AND
GlobalGetFlag("ARX_InitiateGenocide_Destroy",0)
THEN
DB_ARX_Sewers_DoomsdayDevice_Destroyed(_Char);
UserSetFlag(_Char,"ARX_Sewers_UsedDoomsdayDevice_Destroy");
GlobalSetFlag("ARX_InitiateGenocide_Destroy");
TimerLaunch("ARX_Sewers_DoomsdayDevice_Destroy_Turbine",1000);

IF
TimerFinished("ARX_Sewers_DoomsdayDevice_Destroy_Turbine")
THEN
ItemDestroy(ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Turbine_a9ed5c0e-ee01-45df-9cd4-4d74e48df573);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Items_Objects_MCH_Laboratory_Machines_Turbine_A","Items_Objects_MCH_Laboratory_Machines_Turbine_A_Inactive",1);
TriggerSetSoundState(TRIGGERGUID_SoundVolumeTrigger_ARX_Sewers_Machine_48788763-9f38-40bf-831f-45ea1b040c57,"Soundvol_Arx_Sewers_DeathfogMachine_Active","Soundvol_Arx_Sewers_DeathfogMachine_Inactive",1);
PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SE_ARX_DeathfogEvents_Destroy");

IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
GlobalGetFlag("ARX_InitiateGenocide_Destroy",1)
AND
DB_ARX_Sewers_DoomsdayDevice_Destroyed(_Char)
THEN
StartVoiceBark("ARX_Sewers_VB_DoomsdayDevice_Destroyed",_Char);

IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
GlobalGetFlag("ARX_InitiateGenocide_Destroy",1)
AND
QueryOnlyOnce("ARX_InitiateGenocide_Destroy")
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Down_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_01_0c234f01-0ef2-40c9-b195-c25ab3599921,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");
TimerLaunch("ARX_InitiateGenocide_Destroy_01",1000);
PlaySound(ITEMGUID_S_ARX_Sewers_Lever_Genocide_63f52375-fd2f-4978-b4ad-da3c7d3a9786,"SE_ARX_DeathfogEvents_FogTank_Leak");



IF
TimerFinished("ARX_InitiateGenocide_Destroy_01")
THEN
CreatePuddle(TRIGGERGUID_S_ARX_Sewers_Deathfog_SpreadPoint_01_81d32416-d7aa-49ce-bc3e-a23b2fb9dd82,"SurfaceDeathfogCloud",1500,3000,1,3,0.1);
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Down_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_02_9cd7bebf-1e03-4f66-b9e7-feccd62f21bb,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");
TimerLaunch("ARX_InitiateGenocide_Destroy_02",1000);

IF
TimerFinished("ARX_InitiateGenocide_Destroy_02")
THEN
CreatePuddle(TRIGGERGUID_S_ARX_Sewers_Deathfog_SpreadPoint_03_ca7b7d2d-9692-4116-97b4-1d38a43ce648,"SurfaceDeathfogCloud",1000,2000,1,3,0.1);
CreatePuddle(TRIGGERGUID_S_ARX_Sewers_Deathfog_SpreadPoint_02_27bb4ba9-ffce-4006-b338-75cc7a4756f6,"SurfaceDeathfogCloud",1500,3000,1,3,0.1);


//END_REGION

//REGION ARX_Sewers_DoomsdayDevice_ToSea
IF
TextEventSet("tosea")
THEN
Proc_ARX_InitiateGenocide_ToSea();

IF
ObjectFlagSet("ARX_Sewers_DoomsdayDevice_ToSea",(CHARACTERGUID)_Char,_)
AND
GlobalGetFlag("ARX_InitiateGenocide_ToSea",0)
THEN
DB_ARX_Sewers_DoomsdayDevice_ToSea(_Char);
UserSetFlag(_Char,"ARX_Sewers_UsedDoomsdayDevice_ToSea");
GlobalSetFlag("ARX_InitiateGenocide_ToSea");

IF
DialogEnded("ARX_Sewers_DoomsdayDevice",_)
AND
GlobalGetFlag("ARX_InitiateGenocide_ToSea",1)
AND
QueryOnlyOnce("ARX_InitiateGenocide_ToSea")
THEN
Proc_ARX_InitiateGenocide_ToSea();

PROC
Proc_ARX_InitiateGenocide_ToSea()
AND
DB_DeathFog_PuddlePoint_Sea(_Trig,_Effect)
THEN
PROC_LoopEffect(_Effect,_Trig,"ARX_DeathFog_PuddlePoint_Sea","ARX_Main","");

//spread deathfog
//END_REGION

//REGION
IF
CharacterLeftTrigger(_Char,TRIGGERGUID_S_ARX_Sewers_QueensFloor_c2ac0f3b-cea2-4c74-a3bf-2b4e82a54b85)
AND
QRY_AnyRegionActive()
AND
GlobalGetFlag("RC_ARX_Sewers_Q_IsDead",1)
AND
GlobalGetFlag("ARX_InitiateGenocide_ToSea",0)
AND
GlobalGetFlag("ARX_InitiateGenocide_Destroy",0)
AND
GlobalGetFlag("ARX_InitiateGenocide",0)
AND
QueryOnlyOnce("ARX_Sewers_VB_DoomsdayDevice_LeftAlone")
THEN
StartVoiceBark("ARX_Sewers_VB_DoomsdayDevice_LeftAlone",_Char);
//END_REGION

//REGION
PROC
Proc_DeathFog_ClearDBs()
AND
DB_DeathFogIgnoreChar(_Char)
THEN
NOT DB_DeathFogIgnoreChar(_Char);

PROC
Proc_Arx_DeathFog_SetAtm()
AND
DB_DeathFog_AtmTrig(_Trig,_Atm)
THEN
TriggerSetAtmosphere(_Trig,_Atm);

//END_REGION

//REGION
PROC
Proc_ARX_Sewers_DoomsdayDevice_ActivateAnimations((CHARACTERGUID)_Char)
THEN
StartCameraSpline(SPLINEGUID_S_ARX_Sewers_DoomsdayDevice_CameraSpline_55439bbb-7da6-43ee-9de0-fc0b2ef2957f,_Char,0.0,0,1,1);
PlayAnimation(ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Turbine_a9ed5c0e-ee01-45df-9cd4-4d74e48df573,"custom1");
TimerLaunch("ARX_Sewers_DoomsdayDevice_Twist_Gas_01",250);

IF
TimerFinished("ARX_Sewers_DoomsdayDevice_Twist_Gas_01")
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Up_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_01_0c234f01-0ef2-40c9-b195-c25ab3599921,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");
TimerLaunch("ARX_Sewers_DoomsdayDevice_Twist_Gas_02",1000);

IF
TimerFinished("ARX_Sewers_DoomsdayDevice_Twist_Gas_02")
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_ARX_DeathfogMachine_GlassBell_Empties_Up_01",ITEMGUID_S_ARX_Sewers_DoomsdayDevice_Glass_02_9cd7bebf-1e03-4f66-b9e7-feccd62f21bb,"ARX_Sewers_DoomsdayDevice_Twist_Gas_01","ARX_Main","");



//END_REGION

//REGION journal updates, DOS2EE-4013
IF
DB_QuestMerge_TheImperialDwarves(_QuestFlag,_FlagSet)
AND
NOT DB_JDF_QuestLinkedFlag(_FlagSet,_QuestFlag)
THEN
DB_JDF_QuestLinkedFlag(_FlagSet,_QuestFlag);
DB_JDF_Dependencies("QuestUpdate_RC_ARX_TheImperialDwarves_Ros_SaveTheQueen",_FlagSet);



IF
ObjectFlagSet(_Flag,(CHARACTERGUID)_Char,_)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_Flag,_,_)
THEN
Proc_ARX_TheImperialDwarves_DeathfogEntries(_Flag,_Char);

PROC
Proc_ARX_TheImperialDwarves_DeathfogEntries((STRING)_Flag,(CHARACTERGUID)_Char)
AND
PartyGetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Ros_SaveTheQueen",1)
AND
PartyGetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Queen_Spared_SUBA",0)
AND
PartyGetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsSafe_SUBA",0)
AND
CharacterIsDead(CHARACTERGUID_S_ARX_Sewers_TheEmpress_78c95ad2-2d1a-4358-9c9c-77ff9a5fc3c9,0)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_Flag,_,_FlagQueen)
THEN
PartySetFlag(_Char,_FlagQueen);

PROC
Proc_ARX_TheImperialDwarves_DeathfogEntries((STRING)_Flag,(CHARACTERGUID)_Char)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_Flag,_FlagClose,_FlagQueen)
AND
PartyGetFlag(_Char,_FlagQueen,0)
THEN
PartySetFlag(_Char,_FlagClose);


PROC
Proc_ARX_TheImperialDwarves_DeathfogEntries((STRING)_Flag,(CHARACTERGUID)_Char)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_Flag,_FlagClose,_FlagQueen)
THEN
NOT DB_QuestDef_CloseAtRegionEnded("RC_ARX_TheImperialDwarves","QuestUpdate_RC_ARX_TheImperialDwarves_CloseLeftARXDeathfog","ARX_Main");
DB_QuestDef_CloseAtRegionEnded("RC_ARX_TheImperialDwarves",_FlagClose,"ARX_Main");

//DOS2EE-4829

PROC
ProcRegionEnded("ARX_Main")
AND
DB_IsPlayer(_Char)
AND
PartyGetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Ros_SaveTheQueen",1)
AND 
QuestIsClosed(_Char,"RC_ARX_TheImperialDwarves_SUBA",0)
THEN
ObjectSetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_CloseLeftARXQueenFind");

PROC
ProcRegionEnded("ARX_Main")
AND
DB_IsPlayer(_Char)
AND
NOT DB_QuestDef_CloseAtRegionEnded("RC_ARX_TheImperialDwarves",_,"ARX_Main")
THEN
ObjectSetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_CloseLeftARXDeathfog");



//beast resolutions
IF
ObjectFlagSet("QuestUpdate_FTJ_COM_Beast_Resolved",(CHARACTERGUID)_Char,_)
THEN
ObjectSetFlag(_Char,"ARX_Sewers_PDD_QueensFate_Safe");

IF
ObjectFlagSet("QuestUpdate_FTJ_OriginBeast_Resolved",(CHARACTERGUID)_Char,_)
THEN
ObjectSetFlag(_Char,"ARX_Sewers_PDD_QueensFate_Safe");

//QueenDFCompletion
IF
ObjectFlagSet("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsDead_SUBA",(CHARACTERGUID)_Char,_)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_,_,_QueenFlag)
AND
PartyGetFlag(_Char,_QueenFlag,1)
THEN
PartySetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_QueenDFCompletion");




IF
ObjectFlagSet("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_Spared_SUBA",(CHARACTERGUID)_Char,_)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_,_,_QueenFlag)
AND
PartyGetFlag(_Char,_QueenFlag,1)
THEN
PartySetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_QueenDFCompletion");

IF
DB_Sees(_Char,CHARACTERGUID_S_ARX_Sewers_TheEmpress_78c95ad2-2d1a-4358-9c9c-77ff9a5fc3c9)
AND
NOT DB_Dead(CHARACTERGUID_S_ARX_Sewers_TheEmpress_78c95ad2-2d1a-4358-9c9c-77ff9a5fc3c9)
AND
GlobalGetFlag("ARX_Sewers_TheQueen_InKemmsMansion",1)
AND
QuestIsClosed(_Char,"RC_ARX_TheImperialDwarves_SUBA",0)
THEN
ObjectSetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsSafe");

IF
ObjectFlagSet("QuestUpdate_RC_ARX_TheImperialDwarves_Queen_IsSafe_SUBA",(CHARACTERGUID)_Char,_)
AND
DB_ARX_TheImperialDwarves_DeathfogEntries(_,_,_QueenFlag)
AND
PartyGetFlag(_Char,_QueenFlag,1)
THEN
ObjectSetFlag(_Char,"QuestUpdate_RC_ARX_TheImperialDwarves_QueenDFCompletion");


//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ARX"
