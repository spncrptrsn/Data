Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_TUT_FinaleBreakingTentacles((ITEMGUID)ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95, (ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_CD_1_35395d9f-6a0e-4109-99ab-d37a0e24fc96, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_2_09c9d35e-acf2-4cd8-811c-3a12a8928d51, ITEMGUID_S_TUT_BreakingWalls_CD_2_4b06b666-70a8-4a81-801d-b60e3b7b435e, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_3_eac2d58f-cab0-4774-b676-779bdb138934, ITEMGUID_S_TUT_BreakingWalls_CD_3_2f4b6be8-6791-4847-8567-ee5c5ee9eb88, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_4_4dddb7a4-b2ec-4530-8eaa-6d6d753d6521, ITEMGUID_S_TUT_BreakingWalls_CD_4_b9d7d8e0-21ae-481d-be5b-9d32e7308ab5, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_5_69739237-12e8-48c6-9820-d992ad7a2de8, ITEMGUID_S_TUT_BreakingWalls_CD_5_ad980624-8815-4b57-b6f1-ccd5f3108f40, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_8_8c5c7478-d82b-41d3-973d-c21cba5d460b, ITEMGUID_S_TUT_BreakingWalls_CD_8_f4386354-e86d-4edf-898a-b017d9f94d12, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_CD_9_8d11f603-ddfb-49cc-a13c-a86a39218692, ITEMGUID_S_TUT_BreakingWalls_CD_9_8937feda-d489-471c-a40c-9e751b6c9d93, "", 2600);

DB_TUT_FinaleBreakingTentacles((ITEMGUID)ITEMGUID_S_TUT_BreakInTentacle_LD_1_b1784e2d-4845-4a44-96f5-7f7254d22989, (ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_LD_1_d66cd2f1-abf2-4134-b211-0e959a472e19, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_2_fd095f37-be0c-4fb2-93ad-6c58f0b5ec0a, ITEMGUID_S_TUT_BreakingWalls_LD_2_c7060501-7322-48cd-8d8d-3d3f4f6a7b52, "", 1000);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_3_7d6374e2-1579-42e4-bb17-e0d7137eeb9e, ITEMGUID_S_TUT_BreakingWalls_LD_3_2a3d11ab-f86e-4e72-a81c-07a9f7caf860, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_4_e3bd9feb-1ade-4c47-b0e3-3b126f3f290f, ITEMGUID_S_TUT_BreakingWalls_LD_4_64291098-ea1f-47ec-a3bc-43f1f58fe786, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_5_f9666fb1-2c01-445c-8098-954f818abab2, ITEMGUID_S_TUT_BreakingWalls_LD_5_9c00b714-c29a-4755-bc0f-a1ea3fddf415, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_6_ef20900b-8020-4c1f-8295-206808e3980c, ITEMGUID_S_TUT_BreakingWalls_LD_6_46588da0-65c0-451b-8530-8aabd50d3d67, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_7_cf7418a4-ceae-47b1-8ba1-f4b54b81bf65, ITEMGUID_S_TUT_BreakingWalls_LD_7_9689501e-0d72-433e-8702-6bde418da01f, "", 1000);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_8_18e5c100-b754-453b-9939-ee330a11daa0, ITEMGUID_S_TUT_BreakingWalls_LD_8_9fddeddd-aab6-45ac-aee0-965fe4a3028d, "", 1000);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_LD_9_63dd8554-c4fe-4eb9-ac27-08425fb4018c, ITEMGUID_S_TUT_BreakingWalls_LD_9_751e2a39-fe31-4cfb-8687-dd856a5e68bb, "", 2600);

DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_1_f7adf400-6999-4ee4-864c-27af650f811a, ITEMGUID_S_TUT_BreakingWalls_MD_1_b266385e-9796-4577-a14e-4b289a6f08c2, "", 400);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_2_4910f3a4-3388-489d-9b46-349c4ced2916, ITEMGUID_S_TUT_BreakingWalls_MD_2_6af42536-379e-4f43-a5bb-cc21ae955ebf, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_3_091add6c-258a-43a2-9c0b-561fdb23928b, ITEMGUID_S_TUT_BreakingWalls_MD_3_35b61e53-0651-4565-8c2a-2c667fc3de80, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_4_38664dea-fabd-4739-a773-4d2c5229305c, ITEMGUID_S_TUT_BreakingWalls_MD_4_3f20a396-790e-4333-972e-65a3f7537854, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_5_44e0dc99-a528-4e47-b712-479dd02cf122, ITEMGUID_S_TUT_BreakingWalls_MD_5_9e964967-d835-4818-812e-46f5cc929619, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_6_2ddb5119-5d2b-4ac0-a0b3-b91641964ec7, ITEMGUID_S_TUT_BreakingWalls_MD_6_9d25275c-24c1-44a6-a905-eb7ee792a2fa, "", 2600);
DB_TUT_FinaleBreakingTentacles(ITEMGUID_S_TUT_BreakInTentacle_MD_7_5bf55379-a9aa-4668-bb65-2d91bad14891, ITEMGUID_S_TUT_BreakingWalls_MD_7_5d2eabd2-4edd-451c-81b3-14ffb3adc119, "", 400);


/*DB_TUT_FinaleBreakingTentacles_DuringFight((ITEMGUID)ITEMGUID_S_TUT_BreakInTentacle_LD_2_fd095f37-be0c-4fb2-93ad-6c58f0b5ec0a);
DB_TUT_FinaleBreakingTentacles_DuringFight(ITEMGUID_S_TUT_BreakInTentacle_LD_3_7d6374e2-1579-42e4-bb17-e0d7137eeb9e);
DB_TUT_FinaleBreakingTentacles_DuringFight(ITEMGUID_S_TUT_BreakInTentacle_LD_5_f9666fb1-2c01-445c-8098-954f818abab2);*/

DB_TUT_BreakingWalls_Windows((ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_CD_3_2f4b6be8-6791-4847-8567-ee5c5ee9eb88,(ITEMGUID)ITEMGUID_S_TUT_SplashHelper_Cargo_Left_1_af3fe50a-2d9f-409f-a097-d5807ba4855e);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_5_ad980624-8815-4b57-b6f1-ccd5f3108f40,ITEMGUID_S_TUT_SplashHelper_Cargo_Left_2_f109f6a0-a78a-43a1-8c27-a3c32fa8a6d1);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_1_35395d9f-6a0e-4109-99ab-d37a0e24fc96,ITEMGUID_S_TUT_SplashHelper_Cargo_Left_3_ed167866-0245-41d3-88f2-6205c70a3384);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_8_f4386354-e86d-4edf-898a-b017d9f94d12,ITEMGUID_S_TUT_SplashHelper_Cargo_Right_1_a3225544-0325-43ad-bccf-3b1816b047d0);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_2_4b06b666-70a8-4a81-801d-b60e3b7b435e,ITEMGUID_S_TUT_SplashHelper_Cargo_Right_2_125efe84-3845-4e7e-8b15-4a11199b9365);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_4_b9d7d8e0-21ae-481d-be5b-9d32e7308ab5,ITEMGUID_S_TUT_SplashHelper_Cargo_Right_3_7ea174a8-a5b7-4462-b3f2-dd64bc8127ca);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_CD_9_8937feda-d489-471c-a40c-9e751b6c9d93,ITEMGUID_S_TUT_SplashHelper_Cargo_Right_4_21df258f-8f5e-48a4-8283-ed378dd55ab1);

DB_TUT_BreakingWalls_Windows((ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_LD_1_d66cd2f1-abf2-4134-b211-0e959a472e19, (ITEMGUID)ITEMGUID_S_TUT_SplashHelper_Bottom_Right_8_6771010a-1ac6-47d9-aa07-1a7f2db1a673);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_2_c7060501-7322-48cd-8d8d-3d3f4f6a7b52, ITEMGUID_S_TUT_SplashHelper_Bottom_Right_4_2b94f6c1-67e1-495a-9252-7b3cec9c4acb);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_3_2a3d11ab-f86e-4e72-a81c-07a9f7caf860, ITEMGUID_S_TUT_SplashHelper_Bottom_Left_1_eb0bae13-2093-4ef1-b408-b61b2e0b9121);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_4_64291098-ea1f-47ec-a3bc-43f1f58fe786, ITEMGUID_S_TUT_SplashHelper_Bottom_Left_5_98d07cc6-e8a8-4f9a-96c5-f35c0854e93b);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_5_9c00b714-c29a-4755-bc0f-a1ea3fddf415, ITEMGUID_S_TUT_SplashHelper_Bottom_Right_1_f1aaf58c-1cc5-44d8-ae0b-9995a32a77ba);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_6_46588da0-65c0-451b-8530-8aabd50d3d67, ITEMGUID_S_TUT_SplashHelper_Bottom_Right_6_413b0f20-70d0-4f1d-a265-6db54c0ce6bd);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_7_9689501e-0d72-433e-8702-6bde418da01f, ITEMGUID_S_TUT_SplashHelper_Bottom_Left_4_4231ba46-f242-4bd5-87f5-03c146e3b872);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_8_9fddeddd-aab6-45ac-aee0-965fe4a3028d, ITEMGUID_S_TUT_SplashHelper_Bottom_Left_Front_1_e1b8a5f0-c610-4799-b437-dc3f20abca39);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_LD_9_751e2a39-fe31-4cfb-8687-dd856a5e68bb, ITEMGUID_S_TUT_SplashHelper_Bottom_Right_Front_5aa87f82-6644-4a11-a739-a3eb53c54e7b);

DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_1_b266385e-9796-4577-a14e-4b289a6f08c2, ITEMGUID_S_TUT_SplashHelper_Middle_Right_4_7733caf7-0a00-446e-b84e-399ac864f154);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_2_6af42536-379e-4f43-a5bb-cc21ae955ebf, ITEMGUID_S_TUT_SplashHelper_Middle_Right_7_cc3e50aa-1c59-4209-b11a-b6bdf8f3a3fb);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_3_35b61e53-0651-4565-8c2a-2c667fc3de80, ITEMGUID_S_TUT_SplashHelper_Middle_Left_2_f6b97876-3542-4ad9-8670-563cdef209f8);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_4_3f20a396-790e-4333-972e-65a3f7537854, ITEMGUID_S_TUT_SplashHelper_Middle_Left_8_d351cdd4-fc41-4339-bc19-98c3307c9507);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_5_9e964967-d835-4818-812e-46f5cc929619, ITEMGUID_S_TUT_SplashHelper_Middle_Right_6_ded99fdd-fc7f-4586-89a3-bfe1e58fecd7);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_6_9d25275c-24c1-44a6-a905-eb7ee792a2fa, ITEMGUID_S_TUT_SplashHelper_Middle_Right_1_8bdd91b1-9c81-432f-8282-e1eca8e0d9bd);
DB_TUT_BreakingWalls_Windows(ITEMGUID_S_TUT_BreakingWalls_MD_7_5d2eabd2-4edd-451c-81b3-14ffb3adc119, ITEMGUID_S_TUT_SplashHelper_Middle_Left_5_c42d7bef-4c63-4ae5-a9ff-903c49e149bc);

//Removes dynamic map item that was on the wall before one of the tentacles.
SetOnStage(ITEMGUID_BOOK_Poster_Map_004_9d1d8b58-4c63-45f0-b091-5230b8acaa39,0);
KBSECTION
IF
TextEventSet("Summon_The_Kraken")
THEN
PROC_TUT_SummonTheKraken();

IF
DB_TUT_FinaleBreakingTentacles(_Tentacle, _, _, _)
THEN
ItemSetForceSynch(_Tentacle, 1);
SetVisible(_Tentacle, 0);

/*PROC
PROC_TUT_LowerDeck_LaunchVoidLings()
AND
DB_TUT_FinaleBreakingTentacles_DuringFight(_Tentacle)
AND
DB_TUT_FinaleBreakingTentacles(_Tentacle, _, _, _)
AND
NOT DB_TUT_FinaleBreakingTentaclesAppeared(_Tentacle)
AND
Random(5000, _Random)
AND
IntegerSum(_Random, 4000, _Timer)
THEN
DB_TUT_FinaleBreakingTentaclesAppeared(_Tentacle);
ProcObjectTimer(_Tentacle, "TUT_Tentacle_SmashThrough", _Timer);
PROC_TUT_DisableSmallWaves();*/

PROC
PROC_TUT_SummonTheKraken()
AND
DB_TUT_FinaleBreakingTentacles(_Tentacle, _, _, _)
AND
NOT DB_TUT_FinaleBreakingTentaclesAppeared(_Tentacle)
AND
Random(5000, _Timer)
/*AND
IntegerSum(_Random, 2000, _Timer)*/
THEN
DB_TUT_FinaleBreakingTentaclesAppeared(_Tentacle);
ProcObjectTimer(_Tentacle, "TUT_Tentacle_SmashThrough", _Timer);
PROC_TUT_DisableSmallWaves();

PROC
PROC_TUT_DisableSmallWaves()
AND
DB_TUT_Splashes_Wave_Timer(_Deck, _Side, _Timer, 0)
THEN
NOT DB_TUT_Splashes_Wave_Timer(_Deck, _Side, _Timer, 0);

PROC
ProcObjectTimerFinished((ITEMGUID)_Tentacle, "TUT_Tentacle_SmashThrough")
AND
DB_TUT_FinaleBreakingTentacles(_Tentacle, _Wall, _, _WallTimer)
THEN
SetStoryEvent(_Tentacle, "TUT_StartAppear");
ProcObjectTimer(_Wall, "TUT_MiddleDeck_BreakWall", _WallTimer);

PROC
ProcObjectTimerFinished(ITEMGUID_S_TUT_BreakInTentacle_LD_8_18e5c100-b754-453b-9939-ee330a11daa0, "TUT_Tentacle_SmashThrough")
THEN
ProcObjectTimer(ITEMGUID_S_TUT_LowerDeck_DoorToStairs_003_9760d569-f634-4041-bc6f-80b6c4df7117, "TUT_BottomDeck_BreakDoor", 9200);

PROC
ProcObjectTimerFinished(ITEMGUID_S_TUT_LowerDeck_DoorToStairs_003_9760d569-f634-4041-bc6f-80b6c4df7117, "TUT_BottomDeck_BreakDoor")
AND
ItemIsClosed(ITEMGUID_S_TUT_LowerDeck_DoorToStairs_003_9760d569-f634-4041-bc6f-80b6c4df7117, 1)
AND
GetPosition(ITEMGUID_S_TUT_LowerDeck_DoorToStairs_003_9760d569-f634-4041-bc6f-80b6c4df7117, _X, _Y, _Z)
THEN
ItemDestroy(ITEMGUID_S_TUT_LowerDeck_DoorToStairs_003_9760d569-f634-4041-bc6f-80b6c4df7117);
PlayScaledEffectAtPosition("RS3_FX_GP_Impacts_Wood_01", 2.0, _X, _Y, _Z);

/*
PROC
ProcObjectTimerFinished((ITEMGUID)_Tentacle, "TUT_FinaleBreakingTentacleDisappear")
THEN
PlayAnimation(_Tentacle, "die_melee", "TUT_FinaleBreakingTentacleOffStage");

IF
StoryEvent(_Tentacle, "TUT_FinaleBreakingTentacleOffStage")
THEN
SetOnStage(_Tentacle, 0);*/

IF
ItemDestroying(ITEMGUID_S_TUT_BreakingWalls_MD_2_6af42536-379e-4f43-a5bb-cc21ae955ebf)
AND
GetPosition(FUR_Humans_Citz_BedSingle_Poor_D_000_0841ace1-610b-4fc9-8894-b4322f830777, _X, _Y, _Z)
THEN
PlayScaledEffectAtPosition("RS3_FX_GP_Impacts_Wood_01", 2.0, _X, _Y, _Z);
ItemDestroy(FUR_Humans_Citz_BedSingle_Poor_D_000_0841ace1-610b-4fc9-8894-b4322f830777);

PROC
ProcObjectTimerFinished(_Wall, "TUT_MiddleDeck_BreakWall")
THEN
ItemDestroy((ITEMGUID)_Wall);

//REGION //Save Game Patching

IF //Sets Cargo Deck tentacles invisible for older save games
SavegameLoaded(_Major,_Minor,_Rev,_Build)
AND
QRY_VersionIsOlderThan(_Major,_Minor,_Rev,_Build, 3, 5, 1, 0)
AND
DB_TUT_FinaleBreakingTentacles(_Tentacle,_Wall, _Event, _Timer)
THEN
NOT DB_TUT_FinaleBreakingTentacles((ITEMGUID)ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95, (ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_CD_1_35395d9f-6a0e-4109-99ab-d37a0e24fc96, "", 1000);
DB_TUT_FinaleBreakingTentacles((ITEMGUID)ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95, (ITEMGUID)ITEMGUID_S_TUT_BreakingWalls_CD_1_35395d9f-6a0e-4109-99ab-d37a0e24fc96, "", 2600);
SetOnStage(ITEMGUID_BOOK_Poster_Map_004_9d1d8b58-4c63-45f0-b091-5230b8acaa39,0);
TeleportToPosition(ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95,17.033, 3.111, -314.075,"",0);
SetVarFixedString(ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95,"IdleAnimation","Still_UA_01");
SetVarFixedString(ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95,"SpawnAnimation","spawn");
ItemRotateToAngleY(ITEMGUID_S_TUT_BreakInTentacle_CD_1_93747aa4-5a5e-4c24-ac5c-e63a2fbf7d95,184.214,1000.0);
TeleportToPosition(ITEMGUID_S_TUT_BreakInTentacle_CD_5_69739237-12e8-48c6-9820-d992ad7a2de8,32.984, 4.373, -312.615,"",0);
SetVarFixedString(ITEMGUID_S_TUT_BreakInTentacle_CD_5_69739237-12e8-48c6-9820-d992ad7a2de8,"IdleAnimation","Still_UA_01");
SetVarFixedString(ITEMGUID_S_TUT_BreakInTentacle_CD_5_69739237-12e8-48c6-9820-d992ad7a2de8,"SpawnAnimation","spawn");
ItemRotateToAngleY(ITEMGUID_S_TUT_BreakInTentacle_CD_5_69739237-12e8-48c6-9820-d992ad7a2de8,188.585,1000.0);
ItemSetForceSynch(_Tentacle, 1);
PROC_TUT_BreakingTentacles((ITEMGUID)_Tentacle);

PROC
PROC_TUT_BreakingTentacles((ITEMGUID)_Tentacle)
AND
NOT DB_TUT_FinaleBreakingTentaclesAppeared(_Tentacle)
THEN
SetVisible(_Tentacle, 0);

//END_REGION

PROC
ProcRegionEnded("TUT_Tutorial_A")
THEN
GoalCompleted;
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Tutorial_PrisonShip"
