Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_Possessed_003");
KBSECTION
IF
AttackedByObject(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,(CHARACTERGUID)_Player,_,_,_)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_ChainsDestroyed",0)
AND
GetPosition(_Player,_X,_Y,_Z)
THEN
Proc_StartDialog(1,"RC_BI_AD_Vault_Possessed_003_AttackedWhileChained",CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743);

IF
CharacterUsedItem(_Player,ITEMGUID_S_RC_BI_Vault_Lever_003_83387865-a734-4af1-a435-5af7432bad4b)
AND
DB_IsPlayer(_Player)
AND
NOT DB_OnlyOnce("RC_BI_Vault_003_DemonSpoked")
AND
ObjectGetFlag(ITEMGUID_S_RC_BI_Vault_Lever_003_83387865-a734-4af1-a435-5af7432bad4b,"RC_BI_Vault_Repaired",1)
THEN
Proc_StartDialog(0,"RC_BI_Vault_Whisper_003",_Player);
DB_OnlyOnce("RC_BI_Vault_003_DemonSpoked");
 
IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_S_RC_BI_Vault_Prison_003_0f989d97-4c51-4fef-9124-3d15a03238c8)
AND
CharacterIsDead(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,0)
AND
DB_Dialogs(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_Possessed_003")
AND
NOT DB_OnlyOnce("RC_BI_Vault_003_DemonSpoked")
THEN
Proc_StartDialog(0,"RC_BI_Vault_Possessed_003",CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,_Player);
DB_OnlyOnce("RC_BI_Vault_003_DemonSpoked");

IF
ObjectSourcePointAddRequest((CHARACTERGUID)_Player,_AddSP,_WasSP)
AND
DB_IsPlayer(_Player)
AND
DB_InRegion(_Player,TRIGGERGUID_S_RC_BI_Vault_Prison_003_0f989d97-4c51-4fef-9124-3d15a03238c8)
AND
ObjectGetFlag(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_ChainsDestroyed",0)
AND
_WasSP == 0
AND
ObjectGetFlag(_Player,"RC_BI_Vault_003_RejectedLizard",0)
THEN
Proc_StartDialog(0,"RC_BI_Vault_Possessed_003",CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,_Player);

IF
CharacterDied(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743)
AND
DB_IsPlayer(_Player)
THEN
ObjectSetFlag(_Player,"QuestUpdate_RC_BI_TheVaults_KilledGodwoken");

IF
ObjectFlagSet("RC_BI_Vault_ChainsDestroyed",CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,_ID)
THEN
SetCanFight(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,1);
SetCanJoinCombat(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,1);
ProcSetRelationToPlayers(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,0);

IF
ObjectFlagSet("RC_BI_Vault_003_Approach",(CHARACTERGUID)_Player,_ID)
THEN
TeleportTo(_Player,CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743);
PlayEffect(_Player,"RS3_FX_GP_ScriptedEvent_Teleport_GenericSmoke_01");

IF
ObjectFlagSet("RC_BI_Vault_003_Freeze",(CHARACTERGUID)_Player,_ID)
THEN
PlayAnimation(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"cast_target_start","RC_BI_Vault_003_PreCast");
PROC_LoopEffect("RS3_FX_Soul_Prepare_Soul_Root_01",CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_FreezeCast","RC_Main","");
DB_RC_BI_PlayerFreezed(_Player);

IF
StoryEvent(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_003_PreCast")
AND
DB_RC_BI_PlayerFreezed(_Player)
THEN
PlayAnimation(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"cast_target_cast","RC_BI_Vault_003_Cast");
PROC_StopLoopEffect(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_FreezeCast");
PROC_LoopEffect("RS3_FX_GP_Status_Shackles_of_Pain_01",_Player,"RC_BI_Vault_Freezed","RC_Main","Dummy_NeckFX");
PROC_LoopBeamEffect("RS3_FX_GP_ScriptedEvent_ChainedDragon_Beam_01",_Player,CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"Dummy_NeckFX","Dummy_NeckFX","RC_BI_Vault_Freezed","RC_Main");
PlayEffect(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RS3_FX_Skills_Soul_Cast_Soul_Impact_Root_01");
CharacterSetAnimationOverride(_Player,"stillmental");
NOT DB_RC_BI_PlayerFreezed(_Player);

IF
ObjectFlagSet("RC_BI_Vault_003_Vampirism",(CHARACTERGUID)_Player,_ID)
THEN
PlayEffect(_Player,"RS3_FX_Skills_Soul_Cast_SpiritVision_Overlay_01");
PlayEffect(_Player,"RS3_FX_GP_ScriptedEvent_PuzzlePillars_01");
PlayAnimation(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"resurrect");
PlayAnimation(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"hit_magic");
PlayEffect(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RS3_FX_GP_ScriptedEvent_Replenish_SourcePoint_01");
PlayEffect(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RS3_FX_Skills_Soul_Cast_SpiritVision_Overlay_01");
Proc_RemoveSourcePoints(_Player);

IF 
ObjectFlagSet("RC_BI_Vault_003_Vampirism",(CHARACTERGUID)_Player,_ID)
AND
DB_RC_BI_Vault_Pillars(_Pillar,CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,_,_,_QuestNum)
THEN
Proc_RC_BI_Vault_SetBrokenPillarsUpdate(_Player,_Pillar,_QuestNum);
ItemDestroy(_Pillar);

IF
DialogEnded("RC_BI_Vault_Possessed_003",_ID)
AND
DialogGetInvolvedPlayer(_ID,1,(CHARACTERGUID)_Player)
THEN
PROC_StopLoopEffect(_Player,"RC_BI_Vault_Freezed");
PROC_StopLoopBeamEffect(_Player,"RC_BI_Vault_Freezed");
CharacterSetAnimationOverride(_Player,"");

IF
DialogEnded("RC_BI_Vault_Possessed_003",_ID)
AND
DialogGetInvolvedPlayer(_ID,1,(CHARACTERGUID)_Player)
AND
ObjectGetFlag(_Player,"RC_BI_Vault_003_Vampirism",1)
THEN
ProcSetRelationToPlayers(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,0);
ProcTriggerUnregisterForPlayers(TRIGGERGUID_S_RC_BI_Vault_Prison_003_0f989d97-4c51-4fef-9124-3d15a03238c8);
NOT DB_Dialogs(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_Possessed_003");

IF
DialogEnded("RC_BI_Vault_Possessed_003",_ID)
AND
DialogGetInvolvedPlayer(_ID,1,(CHARACTERGUID)_Player)
AND
ObjectGetFlag(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,"RC_BI_Vault_ChainsDestroyed",1)
THEN
EnterCombat(CHARACTERGUID_S_RC_BI_Vault_PosessedPerson_003_019e266d-2d45-4818-a778-2cebffdcd743,_Player);

PROC
Proc_DialogFlagSetup("RC_BI_Vault_Possessed_003", _, _Player)
THEN
ObjectClearFlag(_Player, "RC_BI_Vaults_HasSourcePoint");

PROC
Proc_DialogFlagSetup("RC_BI_Vault_Possessed_003", _, _Player)
AND
CharacterGetSourcePoints((CHARACTERGUID)_Player, _SP)
AND
_SP > 0
THEN
ObjectSetFlag(_Player, "RC_BI_Vaults_HasSourcePoint");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
