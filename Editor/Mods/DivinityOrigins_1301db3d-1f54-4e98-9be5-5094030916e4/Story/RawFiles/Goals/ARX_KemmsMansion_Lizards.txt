Version 1
SubGoalCombiner SGC_AND
INITSECTION
/*SetOnStage(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, 0);
CharacterSetImmortal(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, 1);

DB_OneShotPlayerTrigger(TRIGGERGUID_S_ARX_CancelLizardNoble_ae99ac7f-4a4a-406f-8726-d36decc23f80);
DB_OneShotPlayerTrigger(TRIGGERGUID_S_ARX_LizardNobleOnStage_263fb053-15dd-4179-b2f5-b2b367eaefa0);

DB_OriginMomentTag("RC_ARX_LizardNoble","RED PRINCE","RC_ARX_LizardNoble_COM_RedPrince");

DB_Dialogs(CHARACTERGUID_S_RC_ARX_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42,"RC_ARX_LizardNoble");
*/

//Turned into one liners
DB_Dialogs(CHARACTERGUID_S_ARX_KemmMansion_2ndFloor_LizardNoble_01_37a7425d-1cfe-4492-aa40-d66caf396a58,"ARX_KemmMansion_2ndFloor_LizardNoble_01");
DB_Dialogs(CHARACTERGUID_S_ARX_KemmMansion_2ndFloor_LizardNoble_02_c66063b8-b546-4185-96be-f3058aa84257,"ARX_KemmMansion_2ndFloor_LizardNoble_02");
DB_Dialogs(CHARACTERGUID_S_ARX_KemmMansion_2ndFloor_LizardNoble_03_2ac35354-4d80-4e7d-8113-5acb7b22a787,"ARX_KemmMansion_2ndFloor_LizardNoble_03");


DB_OriginMomentTag("ARX_KemmMansion_2ndFloor_LizardNoble_01","RED PRINCE","ARX_KemmMansion_LizardNobles_COM_RedPrince");

DB_QuestDef_State("FTJ_COM_RedPrince","KemmMansion_NotPregnant");
DB_QuestDef_State("FTJ_COM_RedPrince","KemmMansion_Pregnant");
DB_QuestDef_UpdateEvent("FTJ_COM_RedPrince","HouseOfShadows_KemmMansion_NotPregnant", "QuestUpdate_FTJ_COM_RedPrince_KemmMansion_NotPregnant");
DB_QuestDef_UpdateEvent("FTJ_COM_RedPrince","HouseOfShadows_KemmMansion_Pregnant", "QuestUpdate_FTJ_COM_RedPrince_KemmMansion_Pregnant");
DB_QuestDef_State("FTJ_OriginRedPrince","KemmMansion_NotPregnant");
DB_QuestDef_State("FTJ_OriginRedPrince","KemmMansion_Pregnant");

KBSECTION
IF
DialogEnded("ARX_LizardPrincess",_)
THEN
NOT DB_OriginMomentTag("ARX_KemmMansion_2ndFloor_LizardNoble_01","RED PRINCE","ARX_KemmMansion_LizardNobles_COM_RedPrince");

IF
DialogEnded("ARX_LizardPrincess_COM_RedPrince",_)
THEN
NOT DB_OriginMomentTag("ARX_KemmMansion_2ndFloor_LizardNoble_01","RED PRINCE","ARX_KemmMansion_LizardNobles_COM_RedPrince");

IF
ObjectFlagSet("ARX_HorrorSleep_Sunset_Newt_TaughtSkill",_,_)
THEN
GlobalSetFlag("ARX_HorrorSleep_Complete_WithDragonNewborn");

IF
TextEventSet("sleepkill")
THEN
GlobalSetFlag("ARX_HorrorSleep_Closed");
GlobalSetFlag("ARX_HorrorSleep_Sunset_RedPrincess_Dead");

IF
TextEventSet("sleeplive")
THEN
GlobalSetFlag("ARX_HorrorSleep_Closed");
GlobalClearFlag("ARX_HorrorSleep_Sunset_RedPrincess_Dead");

IF
TextEventSet("sadhapreg")
THEN
GlobalSetFlag("RC_RedPrincessPregnantAfterRC");


//REGION Archive

/*PROC
ProcOneShotTriggerEntered(_, TRIGGERGUID_S_ARX_CancelLizardNoble_ae99ac7f-4a4a-406f-8726-d36decc23f80)
THEN
ProcTriggerUnregisterForPlayers(TRIGGERGUID_S_ARX_LizardNobleOnStage_263fb053-15dd-4179-b2f5-b2b367eaefa0);
NOT DB_OneShotPlayerTrigger(TRIGGERGUID_S_ARX_LizardNobleOnStage_263fb053-15dd-4179-b2f5-b2b367eaefa0);

PROC
ProcOneShotTriggerEntered(_, TRIGGERGUID_S_ARX_LizardNobleOnStage_263fb053-15dd-4179-b2f5-b2b367eaefa0)
AND
NOT DB_GlobalFlag("RC_RedPrincessPregnantAfterRC")
THEN
PROC_ARX_SetupKemmsLizards();

PROC
PROC_ARX_SetupKemmsLizards()
THEN
SetOnStage(CHARACTERGUID_S_RC_ARX_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, 1);
ProcCharacterDisableCrime(CHARACTERGUID_S_RC_ARX_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42,"Steal");
//TODO Disable Investigation



//REGION Lizard Noble Spotted Red Prince 
IF
CharacterCharacterEvent(S_RC_ARX_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"ARX_KemmMansion_Lizards_Noble_Spotted_RP")
THEN
Proc_StartDialog(0,"RC_ARX_LizardNoble",S_RC_ARX_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);

//END_REGION

//REGION Checking if the Red Prince has encountered the Red Princess before
QRY
QRY_CoS_RedPrinceKnowsPrincess()
AND
DB_GlobalFlag("RC_RedPrince_DreamedBrahmos")
THEN
DB_NOOP(0);

QRY
QRY_CoS_RedPrinceKnowsPrincess()
AND
DB_GlobalFlag("RC_FL_RedPrinceKnowPrincess")
THEN
DB_NOOP(0);

//END_REGION

//REGION Sex Scene
IF
DialogEnded("RC_ARX_LizardNoble", _)
AND
DB_GlobalFlag("ARX_LizardNoble_SeductionSuccess")
THEN
PROC_RemoveDialogFromCharacter(CHARACTERGUID_S_ARX_KemmMansion_Liza1rdNoble_003d31c6-e2bf-4850-a15d-389727593e42);
CharacterFreeze(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
TriggerRegisterForCharacter(TRIGGERGUID_S_ARX_KemmMansion_LizardNoble_StartFade_71cf09f8-c90b-4275-a19a-5057126e33ac, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
ProcCharacterMoveTo(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");
ProcCharacterMoveTo(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");

IF
DialogEnded("RC_ARX_LizardNoble", _)
AND
DB_GlobalFlag("ARX_LizardNoble_SeductionFailure")
THEN
PROC_PrincessPoof(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
DialogEnded("RC_ARX_LizardNoble_COM_RedPrince", _)
AND
DB_GlobalFlag("ARX_LizardNoble_SeductionFailure")
THEN
PROC_PrincessPoof(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
CharacterEnteredTrigger(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, TRIGGERGUID_S_ARX_KemmMansion_LizardNoble_StartFade_71cf09f8-c90b-4275-a19a-5057126e33ac)
THEN
FadeToBlack(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, 1.0, 0, "ARX_LizardNoble_ToBed");
TriggerUnregisterForCharacter(TRIGGERGUID_S_ARX_KemmMansion_LizardNoble_StartFade_71cf09f8-c90b-4275-a19a-5057126e33ac, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);

IF
DialogEnded("RC_ARX_LizardNoble_COM_RedPrince", _ID)
AND
NOT DB_GlobalFlag("ARX_LizardNoble_SeductionSuccess")
THEN
CharacterSetRelationIndivFactionToIndivFaction(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, 0);
CharacterSetRelationIndivFactionToIndivFaction(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, 0);

IF
DialogEnded("RC_ARX_LizardNoble_COM_RedPrince", _ID)
AND
DB_GlobalFlag("ARX_LizardNoble_SeductionSuccess")
THEN
PROC_RemoveDialogFromCharacter(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);
CharacterFreeze(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
ProcCharacterMoveTo(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");
ProcCharacterMoveTo(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");

IF
DialogEnded("RC_ARX_LizardNoble_COM_RedPrince", _ID)
AND
DB_GlobalFlag("ARX_LizardNoble_SeductionSuccess")
AND
CharacterIsControlled(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, 1)
THEN
FadeToBlack(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, 1.0, 0, "ARX_LizardNoble_ToBed");

IF
FadeOutDone(_, "ARX_LizardNoble_ToBed")
THEN
ProcCharacterMoveTo(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");
ProcCharacterMoveTo(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, TRIGGERGUID_S_ARX_KemmsMansion_LibraryTP_010bdbe9-17e4-4106-a6e7-d505141be213, 0, "ARX_LizardNoble_AtStairsUp");

IF
StoryEvent(_Character, "ARX_LizardNoble_AtStairsUp")
THEN
TeleportTo(_Character, ITEMGUID_S_ARX_KemmsMansion_LizardNobleBed_fb553e66-f55a-4596-8914-727f656edfa2, "ARX_LizardNoble_AtBed", 0);


//REGION Undressing the Red Prince
IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "Breast", (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Item);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "Leggings", (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Item);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "Gloves", (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Item);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "Helmet", (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Item);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedWeapon(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Item);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
CharacterGetEquippedShield(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, (ITEMGUID)_Item)
THEN
CharacterUnequipItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, (ITEMGUID)_Item);

//END_REGION


IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
THEN
DB_OnlyOnce("ARX_LizardNoble_RedPrinceLieDownBed");
CharacterUseItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, ITEMGUID_S_ARX_KemmsMansion_LizardNobleBed_fb553e66-f55a-4596-8914-727f656edfa2, "");

IF
CharacterUsedItem(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, ITEMGUID_S_ARX_KemmsMansion_LizardNobleBed_fb553e66-f55a-4596-8914-727f656edfa2)
AND
DB_OnlyOnce("ARX_LizardNoble_RedPrinceLieDownBed")
AND
QueryOnlyOnce("ARX_LizardNoble_RedPrinceAfterLieDownBed")
THEN
CharacterFreeze(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
TimerLaunch("ARX_LizardNoble_WakeUp", 1500);
Proc_StartDialog(0, "ARX_LizardNoble_After", CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
SetOnStage(ITEMGUID_S_ARX_HorrorSleep_Sunset_DragonEgg_08648767-508f-866e-2852-2558d0b3b041,1); 
SetOnStage(ITEMGUID_S_ARX_HorrorSleep_Sunset_DragonEgg_CampFire_6cd6eb80-633b-454f-a96a-bd65af5473f7,1);
SetOnStage(ITEMGUID_S_ARX_HorrorSleep_Sunset_DragonEgg_AshPile_c9663fd3-61ff-4a0b-a63f-ae38b6cbba55,1);
TriggerRegisterForItems(TRIGGERGUID_S_ARX_HorrorSleep_Sunset_DragonEgg_Box_96466a11-99eb-43bd-b069-329899e0fc48);

IF
TimerFinished("ARX_LizardNoble_WakeUp")
THEN
CharacterUnfreeze(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);
UnlockSecretRegion(TRIGGERGUID_S_ARX_LizardNobleBedRoom_6ee53a94-191b-4724-9e0e-925f3c051bfe);
FadeToBlack(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, 2.0, 1, "ARX_LizardWakeUp");

IF
GlobalFlagSet("ARX_LizardNoble_Transform")
AND
QueryOnlyOnce("ARX_LizardNoble_Transform")
THEN
ItemUnlock(ITEMGUID_S_ARX_KemmsMansion_LizardNobleDoor_dbf6b41b-a581-49a4-a0e0-574bbeebefaa);
PlayEffect(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, "RS3_FX_GP_ScriptedEvent_RedPrincess_Teleport_01");
Transform(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, "GLO_Lizards_EmpirePrincess_951ab286-ff5f-4e6c-a683-eca2eca689d7", 0);
CharacterSetFightMode(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, 1, 1);

IF
DialogEnded("ARX_LizardNoble_After", _)
THEN
PROC_PrincessPoof(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

//REGION Journal updates
IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
DB_GlobalFlag("COS_RPToSallowman")
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 1)
THEN
ObjectSetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_OriginsRedPrince_NobleWarned", 0);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
DB_GlobalFlag("COS_RPToSallowman")
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 0)
THEN
PartySetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_COM_RedPrince_NobleWarned", 0);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
NOT DB_GlobalFlag("COS_RPToSallowman")
AND
QRY_CoS_RedPrinceKnowsPrincess()
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 1)
THEN
ObjectSetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_OriginsRedPrince_NobleKnow", 0);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
NOT DB_GlobalFlag("COS_RPToSallowman")
AND
QRY_CoS_RedPrinceKnowsPrincess()
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 0)
THEN
PartySetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_COM_RedPrince_NobleKnow", 0);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
NOT DB_GlobalFlag("COS_RPToSallowman")
AND
NOT QRY_CoS_RedPrinceKnowsPrincess()
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 1)
THEN
ObjectSetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_OriginsRedPrince_Noble", 0);

IF
StoryEvent(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "ARX_LizardNoble_AtBed")
AND
NOT DB_GlobalFlag("COS_RPToSallowman")
AND
NOT QRY_CoS_RedPrinceKnowsPrincess()
AND
IsTagged(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "AVATAR", 0)
THEN
PartySetFlag(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, "QuestUpdate_FTJ_COM_RedPrince_Noble", 0);

//END_REGION

//END_REGION


//REGION Red Princess Flees
QRY
QRY_Arx_RedPrinceNearNoble()
AND
GetDistanceTo(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Dist)
AND
_Dist <= 18.0
THEN
ObjectSetFlag(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, "RC_FL_RedPrinceNear", 0);

IF
ObjectTurnStarted(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42)
AND
CharacterGetHitpointsPercentage(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _HP)
AND
_HP <= 70.0
AND
QRY_Arx_RedPrinceNearNoble()
AND
QueryOnlyOnce("ARX_AD_RedPrincessFlee")
THEN
RemoveHarmfulStatuses(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);
Proc_StartDialog(1, "ARX_AD_RedPrincessFlee", CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
CharacterReceivedDamage(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _, _)
AND
CharacterGetHitpointsPercentage(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _HP)
AND
_HP <= 25.0
AND
NOT QRY_Arx_RedPrinceNearNoble()
AND
QueryOnlyOnce("ARX_AD_RedPrincessFlee")
THEN
RemoveHarmfulStatuses(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);
ObjectClearFlag(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, "RC_FL_RedPrinceNear", 0);
Proc_StartDialog(1, "ARX_AD_RedPrincessFlee", CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
ObjectLeftCombat(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _)
AND
NOT DB_Dead(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42)
AND
QRY_Arx_RedPrinceNearNoble()
AND
QueryOnlyOnce("ARX_AD_RedPrincessFlee")
THEN
RemoveHarmfulStatuses(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);
Proc_StartDialog(1, "ARX_AD_RedPrincessFlee", CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
ObjectLeftCombat(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _)
AND
NOT DB_Dead(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42)
AND
NOT QRY_Arx_RedPrinceNearNoble()
AND
QueryOnlyOnce("ARX_AD_RedPrincessFlee")
THEN
RemoveHarmfulStatuses(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);
ObjectClearFlag(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, "RC_FL_RedPrinceNear", 0);
Proc_StartDialog(1, "ARX_AD_RedPrincessFlee", CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
ObjectLeftCombat(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _ID)
AND
DB_OnlyOnce("ARX_LizardNoble_Transform")
AND
DB_CombatCharacters(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _ID)
AND
DB_CompanionAvatarBond(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Avatar)
AND
DB_OriginMoment_COMREQ_Denied(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42)
AND
QueryOnlyOnce("ARX_LizardNoble_CRD_RedPrince")
THEN
Proc_RelationshipDialog(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"ARX_LizardNoble_CRD_RedPrince",_Avatar);

IF
ObjectLeftCombat(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42, _ID)
AND
DB_OnlyOnce("ARX_LizardNoble_Transform")
AND
DB_WasInCombat(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _ID)
AND
DB_CompanionAvatarBond(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f, _Avatar)
AND
DB_OriginMoment_COMREQ_Denied(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42)
AND
QueryOnlyOnce("ARX_LizardNoble_CRD_RedPrince")
THEN
Proc_RelationshipDialog(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"ARX_LizardNoble_CRD_RedPrince",_Avatar);

IF
AutomatedDialogEnded("ARX_AD_RedPrincessFlee", _)
THEN
PROC_PrincessPoof(CHARACTERGUID_S_ARX_KemmMansion_LizardNoble_003d31c6-e2bf-4850-a15d-389727593e42);

IF
StoryEvent(_Guard, "ARX_LizardNoble_BodyGuard_OffStage")
THEN
SetOnStage(_Guard, 0);
//END_REGION

IF
GlobalFlagSet("ARX_LizardNoble_SeductionSuccess")
THEN
GlobalSetFlag("RC_RedPrincessPregnantAfterRC");

IF
ObjectEnteredCombat(CHARACTERGUID_S_CoS_Temples_SpyMaster_787c6c4a-6e5a-4044-9616-27e21e5a171e, _)
AND
DB_ARX_SpymasterAssassins(_Assassin)
THEN
CharacterAppear(_Assassin, 1, "");
*/
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ARX"
