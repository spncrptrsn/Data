Version 1
SubGoalCombiner SGC_AND
INITSECTION
Proc_RegisterPartyDecisionDialogOutcomes_Fixed("PVPDialogTest2","TestA","TestB","","","");
Proc_RegisterPartyDecisionDialogOutcomes_Optional("PVPDialogTest2","Test1","Test2","Test3","","");
KBSECTION
IF
TextEventSet("g")
THEN
SetHasDialog(CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,1);

IF
TextEventSet("kickavatar")
AND
CharacterGetHostCharacter(_Player)
THEN
PROC_GLO_PartyMembers_Kick(_Player,"Hero KickedAvatarCompanions");

IF
TextEventSet("kickifan")
THEN
PROC_GLO_PartyMembers_Kick(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Hero KickedAvatarCompanions");


IF
TextEventSet("playsound")
AND
CharacterGetHostCharacter(_Player)
AND
GetTextEventParamString(1,_Sound)
THEN
PlaySound(_Player,_Sound);

IF
TextEventSet("dismissall")
AND
CharacterGetHostCharacter(_Player)
AND
DB_Avatars(_Player)
AND
DB_IsPlayer(_Companion)
AND
NOT DB_Avatars(_Companion)
THEN
PROC_GLO_PartyMembers_Remove(_Companion,_Player,0);

IF
TextEventSet("sourcerain")
AND
CharacterGetHostCharacter(_Player)
AND
GetPosition(_Player,_X,_Y,_Z)
AND
Integer(_X,_IntX)
AND
Integer(_Z,_IntZ)
THEN
PROC_DebugSourceRain(_IntX,_Y,_IntZ,5);

PROC
PROC_DebugSourceRain((INTEGER)_IntX,(REAL)_Y,(INTEGER)_IntZ,(INTEGER)_Amount)
AND
_Amount > 0
AND
Random(14,_RandX)
AND
Random(14,_RandZ)
AND
IntegerSum(_IntX,_RandX,_SubX)
AND
IntegerSum(_SubX,-7,_NewX)
AND
IntegerSum(_IntZ,_RandZ,_SubZ)
AND
IntegerSum(_SubZ,-7,_NewZ)
AND
Real(_NewX,_X)
AND
Real(_NewZ,_Z)
AND
IntegerSubtract(_Amount,1,_NewAmount)
THEN
CreateSurfaceAtPosition(_X,_Y,_Z,"SurfaceSource",1.0,20.0);
PROC_DebugSourceRain(_IntX,_Y,_IntZ,_NewAmount);

IF
TextEventSet("10u")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
AND
DB_CompanionAvatarBond((CHARACTERGUID)_Companion,_Player)
THEN
ObjectSetFlag(_Companion,"CompanionRelationUp10",0);

IF
TextEventSet("10d")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
AND
DB_CompanionAvatarBond((CHARACTERGUID)_Companion,_Player)
THEN
ObjectSetFlag(_Companion,"CompanionRelationDown10",0);

IF
TextEventSet("att")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
AND
DB_CompanionAvatarBond((CHARACTERGUID)_Companion,_Player)
AND
CharacterGetAttitudeTowardsPlayer(_Companion,_Player,_Att)
AND
IntegertoString(_Att,_IntStr)
AND
StringConcatenate("Attitude: ",_IntStr,_FinalResult)
THEN
DebugText(_Companion,_FinalResult);

IF
TextEventSet("1sp")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
ObjectClearFlag(_Player,"GLO_Has2MaxMP",0);
ObjectClearFlag(_Player,"GLO_Has3MaxMP",0);
CharacterOverrideMaxSourcePoints(_Player,1);
CharacterAddSourcePoints(_Player,3);

IF
TextEventSet("2sp")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
ObjectSetFlag(_Player,"GLO_Has2MaxMP");
ObjectClearFlag(_Player,"GLO_Has3MaxMP",0);
CharacterOverrideMaxSourcePoints(_Player,2);
CharacterAddSourcePoints(_Player,3);

IF
TextEventSet("3sp")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
ObjectSetFlag(_Player,"GLO_Has2MaxMP");
ObjectSetFlag(_Player,"GLO_Has3MaxMP");
CharacterOverrideMaxSourcePoints(_Player,3);
CharacterAddSourcePoints(_Player,3);

IF
TextEventSet("noavatar")
AND
DB_IsPlayer(_Player)
THEN
ClearTag(_Player,"AVATAR");

IF
TextEventSet("questtest")
THEN
QuestAdd(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"FTJ_COM_Lohse");
QuestUpdate(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"FTJ_COM_Lohse","Saheila_Dies");
QuestUpdate(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"FTJ_COM_Lohse","Saheila_Lives");


IF
TextEventSet("refdiag")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
NOT DB_ReflectionDialog_Finished("FTJ_RD_SilentMonks");
ProcDefineReflectionDialog("FTJ_RD_SilentMonks",_Player);

IF
TextEventSet("refdiag2")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
NOT DB_ReflectionDialog_Finished("LV_RD_CompanionDismissal");
ProcDefineReflectionDialog("LV_RD_CompanionDismissal",_Player);

IF
TextEventSet("refdiag3")
AND
DB_IsPlayer(_Player)
AND
CharacterIsControlled(_Player,1)
THEN
NOT DB_ReflectionDialog_Finished("LV_RD_CompanionDismissal");
ProcDefineReflectionDialog("LV_RD_CompanionDismissal",_Player);
ProcStartReflectionDialog(_Player,"LV_RD_CompanionDismissal");

IF
TextEventSet("reldiag")
THEN
NOT DB_RelationshipDialogsFinished(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"FTJ_Saheila_CRD_Lohse");
Proc_RelationshipDialog(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"FTJ_Saheila_CRD_Lohse",CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295);

IF
TextEventSet("animpartymale")
THEN
Transform(Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Dwarves_Hero_Male_024d1763-b2aa-46ec-b705-6338059838be",1);
Transform(Player_Jean_Pyke_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Elves_Hero_Male_19913083-924e-45ec-8b5b-119d5913722f",1);
Transform(Player_Placeholder_Elf_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Humans_Hero_Male_25611432-e5e4-482a-8f5d-196c9e90001e",1);
Transform(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"Lizards_Hero_Male_fa12e21f-0a10-47dd-af46-ab2c9a53cf6d",1);

IF
TextEventSet("animpartyfemale")
THEN
Transform(Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Dwarves_Hero_Female_c1c58707-b06e-499e-9c43-91a90be602b0",1);
Transform(Player_Jean_Pyke_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Elves_Hero_Female_7ef846f5-34dc-450c-815e-a58dfc190a7b",1);
Transform(Player_Placeholder_Elf_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Humans_Hero_Female_de8ea39b-6989-4b93-b34a-81e549c540f2",1);
Transform(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"Lizards_Hero_Female_e4a6bcfa-ecd6-4e56-8592-cd16b85a1c50",1);

IF
TextEventSet("animpartydwarfelf")
THEN
Transform(Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Dwarves_Hero_Male_024d1763-b2aa-46ec-b705-6338059838be",1);
Transform(Player_Jean_Pyke_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Dwarves_Hero_Female_c1c58707-b06e-499e-9c43-91a90be602b0",1);
Transform(Player_Placeholder_Elf_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Elves_Hero_Male_19913083-924e-45ec-8b5b-119d5913722f",1);
Transform(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"Elves_Hero_Female_7ef846f5-34dc-450c-815e-a58dfc190a7b",1);

IF
TextEventSet("animpartyhumanlizard")
THEN
Transform(Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Humans_Hero_Male_25611432-e5e4-482a-8f5d-196c9e90001e",1);
Transform(Player_Jean_Pyke_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Humans_Hero_Female_de8ea39b-6989-4b93-b34a-81e549c540f2",1);
Transform(Player_Placeholder_Elf_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Lizards_Hero_Male_fa12e21f-0a10-47dd-af46-ab2c9a53cf6d",1);
Transform(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"Lizards_Hero_Female_e4a6bcfa-ecd6-4e56-8592-cd16b85a1c50",1);

IF
TextEventSet("animpartycustom")
THEN
Transform(Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Humans_Hero_Male_25611432-e5e4-482a-8f5d-196c9e90001e",1);
Transform(Player_Jean_Pyke_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Humans_Hero_Female_de8ea39b-6989-4b93-b34a-81e549c540f2",1);
Transform(Player_Placeholder_Elf_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Elves_Hero_Female_7ef846f5-34dc-450c-815e-a58dfc190a7b",1);
Transform(Player_Red_Prince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"Lizards_Hero_Male_fa12e21f-0a10-47dd-af46-ab2c9a53cf6d",1);

IF
TextEventSet("DHan")
THEN
SetStoryEvent(S_FTJ_CapturedChild_53d4aa5c-dd91-4e12-9ca8-d66879cc6ffb,"FTJ_SW_TeleportToShelter");

IF
TextEventSet("PrintReserved")
AND
CharacterGetHostCharacter(_Player)
THEN
CharacterLaunchIteratorAroundObject(_Player,30.0,"Loop_PrintReserved");

IF
StoryEvent(_Player,"Loop_PrintReserved")
AND
IsSpeakerReserved(_Player,1)
THEN
DebugText(_Player,"RESERVED");

IF
StoryEvent(_Player,"Loop_PrintReserved")
AND
IsSpeakerReserved(_Player,0)
THEN
DebugText(_Player,"AVAILABLE");

IF
TextEventSet("tut")
THEN
DB_InitialTutorialsShown(1);

IF
TextEventSet("tut")
AND
GetTextEventParamString(1,_Tut)
THEN
PROC_CheckPlayTut(_Tut);


IF
TextEventSet("movie")
THEN
ProcStartMovie("DOS Cutscene 1.bik");

IF
TextEventSet("2ap")
AND
CharacterGetHostCharacter(_Player)
THEN
CharacterAddActionPoints(_Player,2);


IF
TextEventSet("add_henchman")
AND
CharacterGetHostCharacter(_Player)
THEN
CharacterMakePlayer(CHARACTERGUID_Slava_TestSummmon_96121647-6c23-4aa4-a964-171b763ec7b2, _Player);

IF
TextEventSet("add_to_char")
AND
CharacterGetHostCharacter(_Player)
THEN
CharacterAddToPlayerCharacter(CHARACTERGUID_Slava_TestSummmon_96121647-6c23-4aa4-a964-171b763ec7b2,_Player);

IF
TextEventSet("hpp")
AND
GetTextEventParamReal(1,_HP)
THEN
CharacterSetHitpointsPercentage(CHARACTERGUID_S_GLO_Meistr_01ae5541-cef7-4d3a-8799-cee7f3d3c34d,_HP);

IF
TextEventSet("charflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
ObjectSetFlag(_Player,_Flag);

IF
TextEventSet("userflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
UserSetFlag(_Player,_Flag);

IF
TextEventSet("partyflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
PartySetFlag(_Player,_Flag);

IF
TextEventSet("globalflag")
AND
GetTextEventParamString(1,_Flag)
THEN
GlobalSetFlag(_Flag);


IF
TextEventSet("ccharflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
ObjectClearFlag(_Player,_Flag);

IF
TextEventSet("cuserflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
UserClearFlag(_Player,_Flag,0);

IF
TextEventSet("cpartyflag")
AND
GetTextEventParamString(1,_Flag)
AND
CharacterGetHostCharacter(_Player)
THEN
PartyClearFlag(_Player,_Flag,0);

IF
TextEventSet("cglobalflag")
AND
GetTextEventParamString(1,_Flag)
THEN
GlobalClearFlag(_Flag);

IF
TextEventSet("sendevent")
AND
GetTextEventParamUUID(1, _Object)
AND
GetTextEventParamString(2, _Event)
THEN
SetStoryEvent(_Object, _Event);

IF
TextEventSet("objectflag")
AND
GetTextEventParamUUID(1, _Object)
AND
GetTextEventParamString(2, _Flag)
THEN
ObjectSetFlag(_Object, _Flag);

IF
TextEventSet("cobjectflag")
AND
GetTextEventParamUUID(1, _Object)
AND
GetTextEventParamString(2, _Flag)
THEN
ObjectClearFlag(_Object, _Flag);

IF
TextEventSet("weaken")
THEN
PartySetFlag(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"GLO_Lohse_KnowDemonName");
Proc_ARX_TheCrash_NPCLeave();

IF
TextEventSet("cd2")
THEN
NOT DB_OriginInPartyDialog(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Ifan");
DB_OriginInPartyDialog((CHARACTERGUID)CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Ifan2");
NOT DB_OriginInPartyDialog(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Lohse");
DB_OriginInPartyDialog((CHARACTERGUID)CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Lohse2");
NOT DB_OriginInPartyDialog(CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Sebille");
DB_OriginInPartyDialog((CHARACTERGUID)CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Sebille2");
NOT DB_OriginInPartyDialog(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"RedPrince");
DB_OriginInPartyDialog((CHARACTERGUID)CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"RedPrince2");
PROC_GLO_PartyMembers_SetInpartyDialog(CHARACTERGUID_S_Player_Ifan_ad9a3327-4456-42a7-9bf4-7ad60cc9e54f,"Ifan2");
PROC_GLO_PartyMembers_SetInpartyDialog(CHARACTERGUID_S_Player_Lohse_bb932b13-8ebf-4ab4-aac0-83e6924e4295,"Lohse2");
PROC_GLO_PartyMembers_SetInpartyDialog(CHARACTERGUID_S_Player_Sebille_c8d55eaf-e4eb-466a-8f0d-6a9447b5b24c,"Sebille2");
PROC_GLO_PartyMembers_SetInpartyDialog(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"RedPrince2");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Start"
