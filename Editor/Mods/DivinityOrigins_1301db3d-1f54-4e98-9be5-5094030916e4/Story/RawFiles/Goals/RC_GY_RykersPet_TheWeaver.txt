Version 1
SubGoalCombiner SGC_AND
INITSECTION
// https://sites.google.com/a/larian.com/larian-wikisite/home/quest-design-documentation/the-weaver
// https://www.lucidchart.com/documents/edit/05b9934f-4b8b-4e80-8f9b-135e86014709

DB_Dialogs(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"RC_GY_RykersPet_Spider");
// DB_RC_GY_RykerHouse_Spider_Doors(_Door, _Id, _TeleportPoint)
// Doors are paired
DB_RC_GY_RykerHouse_Spider_Doors((ITEMGUID)ITEMGUID_S_RC1_GY_RykerHouse_Stairs_ToSpider_1_2cd835f0-e601-415a-a398-b354377feb3c,1,(TRIGGERGUID)TRIGGERGUID_S_RC_GY_TP_RykerHouse_ToSpider_1_ea284e39-88a8-4298-91f5-5ab1095e494b);DB_RC_GY_RykerHouse_Spider_Doors(ITEMGUID_S_RC_GY_RykerHouse_Stairs_ToSpider_2_0c6172ec-9b11-424c-befc-9d5fbfcc231a,2,TRIGGERGUID_S_RC_GY_TP_RykerHouse_ToSpider_2_60c3a08a-d98e-4353-8049-98f2cfaabdcd);
DB_RC_GY_RykerHouse_Spider_Doors(ITEMGUID_S_RC_GY_RykerHouse_Stairs_ToSpider_3_73991f0b-f29d-46e2-94bb-60db7ea3e610,3,TRIGGERGUID_S_RC_GY_TP_RykerHouse_ToSpider_3_2bcafc4b-adeb-48a1-a63e-3bb7f1f2c28d);
DB_RC_GY_RykerHouse_Spider_Doors(ITEMGUID_S_RC_GY_RykerHouse_Hatch_FromSpider_1_a4bb562f-59e9-4fdd-96de-365433f68c3e,1,TRIGGERGUID_S_RC_GY_TP_RykerHouse_FromSpider_1_7fd80de0-ac96-4f77-bf23-e9f3d6da1433);
DB_RC_GY_RykerHouse_Spider_Doors(ITEMGUID_S_RC_GY_RykerHouse_Hatch_FromSpider_2_d6a1a523-5b30-4fc4-b132-ce1297b85264,2,TRIGGERGUID_S_RC_GY_TP_RykerHouse_FromSpider_2_5c45d1a9-856b-41fd-b622-49bc1e89033f);
DB_RC_GY_RykerHouse_Spider_Doors(ITEMGUID_S_RC_GY_RykerHouse_Hatch_FromSpider_3_5f015a44-dc4c-4158-ba5f-65590352c670,3,TRIGGERGUID_S_RC_GY_TP_RykerHouse_FromSpider_3_2d34b930-afa5-4328-9272-1fcc2d93e144);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(1,(ITEMGUID)ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_1_4ec62b9c-42f4-4db9-818a-08750cd252da);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(1,ITEMGUID_S_RC_GY_RykerHouse_Door_FromSpider_1_2dd04f44-7269-4401-886a-8f504ad30d86);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(2,ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_2_5b69e1f9-b834-4291-a979-73419de5a27e);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(2,ITEMGUID_S_RC_GY_RykerHouse_Door_FromSpider_2_13112f85-6849-4c19-944c-d9df428e8d63);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(3,ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_3_38fcb987-9b6f-4479-ba9f-464864e953f6);
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(3,ITEMGUID_S_RC_GY_RykerHouse_Door_FromSpider_3_3a98a8ce-e0ef-4ff1-9ea7-9d5a137559e6);

ObjectSetFlag(ITEMGUID_S_RC_GY_RykerHouse_Stairs_ToSpider_1_2cd835f0-e601-415a-a398-b354377feb3c,"RC_GY_RykerHouse_SpiderRoom_Entrance");
ObjectSetFlag(ITEMGUID_S_RC_GY_RykerHouse_Stairs_ToSpider_2_0c6172ec-9b11-424c-befc-9d5fbfcc231a,"RC_GY_RykerHouse_SpiderRoom_Entrance");
ObjectSetFlag(ITEMGUID_S_RC_GY_RykerHouse_Stairs_ToSpider_3_73991f0b-f29d-46e2-94bb-60db7ea3e610,"RC_GY_RykerHouse_SpiderRoom_Entrance");

DB_RC_GY_RykerHouse_Spider_BlockedDoors(1);
DB_RC_GY_RykerHouse_Spider_BlockedDoors(2);
DB_RC_GY_RykerHouse_Spider_BlockedDoors(3);

// Strength needed to open the door
DB_RC_GY_RykerHouse_Spider_DoorsStrength(1,"Normal");
DB_RC_GY_RykerHouse_Spider_DoorsStrength(2,"Hard");
DB_RC_GY_RykerHouse_Spider_DoorsStrength(3,"Hard");

DB_RC_GY_RykerHouse_SpiderEggs((ITEMGUID)ITEMGUID_S_RC_GY_SpiderEgg_000_d697fe39-a3f4-4294-a559-9d00eb475727);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_001_9166bb6a-6409-4e9a-927f-e273890b8952);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_002_a8053e00-170a-4176-8fc2-ad64920f3204);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_003_60c4e93d-396e-4ee0-8857-a2502a3d45c3);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_004_0b2be0ef-df27-4e65-8abd-a0fde5e674c9);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_005_65af8bfc-e8ea-4781-8845-04eac191a6f8);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_006_d299db4c-0f11-42ca-9f56-22ae2ca29d69);
DB_RC_GY_RykerHouse_SpiderEggs(ITEMGUID_S_RC_GY_SpiderEgg_007_68142a87-1dd3-4119-9eda-eb09b070f108);

SetOnStage(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,0);

ProcTriggerRegisterForPlayers(TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_b650d3eb-7a69-412f-9634-3c56cd60adb3);
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_000_e0a4191d-3284-4ef2-96c9-ccc4775e20b0);
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_001_d5573c3d-c2c5-4490-a666-56b5e7f6010d);

//DB_RC_GY_RykersSpider_Bodyparts(_Item);
//DB_RC_GY_RykersSpider_LimbGiver(_Character);


DB_Ghosts(CHARACTERGUID_S_RC_GY_RykerHouse_SpiderRoom_Ghost_5fe8bc92-3c67-464a-ad18-b2a5ab4b9bb4,"RC_GY_RykerHouse_SpiderRoom_Ghost");
DB_HasStoryEvent(ITEMGUID_S_RC_GY_RykersHouse_SpiderRoom_Bodypart_62e5400a-cb82-4b34-b128-60211179f0b7,"RC_GY_RykerHouse_SpiderRoom_HasBodypart");
KBSECTION
//REGION DEBUG
IF
TextEventSet("rcgyweavertal")
AND
CharacterGetHostCharacter(_Player)
THEN
CharacterAddTalent(_Player,"Quest_SpidersKiss_Str");

IF
TextEventSet("playsoundspidertrigger")
AND
GetTextEventParamString(1,_Sound)
THEN
PlaySound(TRIGGERGUID_S_RC_GY_RykersSpider_Spot_3b5bea69-4ae4-4dbf-8154-4c3a135e1178,_Sound);

IF
TextEventSet("playsoundspider")
AND
GetTextEventParamString(1,_Sound)
THEN
PlaySound(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Sound);

IF
TextEventSet("playsoundcouch")
AND
GetTextEventParamString(1,_Sound)
THEN
PlaySound(ITEMGUID_FUR_Rich_Couch_B_007_7f63b465-0555-4f0e-bbc4-0aea6f5d15a3,_Sound);

IF
TextEventSet("playsoundhelper")
AND
GetTextEventParamString(1,_Sound)
THEN
PlaySound(ITEMGUID_S_RC_GY_Ryker_WeaverSoiundHelper_fb41a2f4-0e87-4a11-961c-7f2fe676055e,_Sound);


//END_REGION

//REGION ENTRANCES
// Side stairs
PROC
ProcBlockUseOfItem(_Character,_Door)
AND
DB_RC_GY_RykerHouse_Spider_Doors(_Door,_Id,_)
AND
DB_RC_GY_RykerHouse_Spider_BlockedDoors(_Id)
AND
DB_IsPlayer(_Character)
THEN
DB_CustomUseItemResponse(_Character,_Door,0);
Proc_StartDialog(0,"RC_GY_RykerHouse_SpiderRoom_Blocked",_Door,_Character);

PROC
Proc_DialogFlagSetup("RC_GY_RykerHouse_SpiderRoom_Blocked",_Door,(CHARACTERGUID)_Character)
AND
DB_RC_GY_RykerHouse_Spider_Doors((ITEMGUID)_Door,_Id,_)
AND
DB_RC_GY_RykerHouse_Spider_DoorsStrength(_Id,_Difficulty)
THEN
DB_GLO_Attribute_Check_AgainstLevel("RC_GY_RykerHouse_SpiderRoom_Blocked",1,"Strength",_Difficulty,2,11);

IF
DialogEnded("RC_GY_RykerHouse_SpiderRoom_Blocked",_DlgInst)
AND
DialogGetInvolvedNPC(_DlgInst,1,(ITEMGUID)_Door)
AND
ObjectGetFlag(_Door,"RC_GY_RykerHouse_SpiderRoom_Opened",1)
AND
DialogGetInvolvedPlayer(_DlgInst,1,(CHARACTERGUID)_Character)
AND
DB_RC_GY_RykerHouse_Spider_Doors(_Door,_Id,_TPTrigger)
THEN
ObjectClearFlag(_Door,"RC_GY_RykerHouse_SpiderRoom_Opened",0);
NOT DB_RC_GY_RykerHouse_Spider_BlockedDoors(_Id);
Proc_RC_GY_RykerHouse_Spider_OpenDoors(_Id);
TeleportTo(_Character,_TPTrigger);

PROC
ProcBlockUseOfItem(_Player,_Door)
AND
DB_RC_GY_RykerHouse_Spider_Doors(_Door,_Id,_)
AND
NOT DB_RC_GY_RykerHouse_Spider_BlockedDoors(_Id)
AND
DB_IsPlayer(_Player)
THEN
Proc_RC_GY_RykerHouse_Spider_OpenDoors(_Id);

PROC
Proc_RC_GY_RykerHouse_Spider_OpenDoors((INTEGER)_Id)
AND
DB_RC_GY_RykerHouse_Spider_OpenOnTeleport(_Id,_OpenDoor)
THEN
ItemOpen(_OpenDoor);


// Main Door
PROC
ProcBlockUseOfItem(_Character,ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_0_ff408a81-7b73-42df-bd54-163db8a88d7b)
AND
DB_IsPlayer(_Character)
AND
ItemIsLocked(ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_0_ff408a81-7b73-42df-bd54-163db8a88d7b,1)
AND
NOT DB_InRegion(_Character,TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_000_e0a4191d-3284-4ef2-96c9-ccc4775e20b0)
THEN
DB_CustomUseItemResponse(_Character,ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_0_ff408a81-7b73-42df-bd54-163db8a88d7b,0);
Proc_StartDialog(0,"RC_GY_RykerHouse_SpiderRoom_Locked",ITEMGUID_S_RC_GY_RykerHouse_Door_ToSpider_0_ff408a81-7b73-42df-bd54-163db8a88d7b,_Character);
//END_REGION


//REGION Appear
PROC
Proc_RC_GY_RykersSpider_Appear()
AND
NOT DB_GlobalFlag("RC_GY_RykersSpider_Appeared")
THEN
CharacterSetAnimationSetOverride(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"Spawn_02");
CharacterAppear(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,1,"RC_GY_RykersSpider_Appear");
PlaySound(ITEMGUID_S_RC_GY_Ryker_WeaverSoiundHelper_fb41a2f4-0e87-4a11-961c-7f2fe676055e,"RC_Scripted_GiantSpider_Appear");

IF
StoryEvent(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"RC_GY_RykersSpider_Appear")
THEN
CharacterSetAnimationSetOverride(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"");
GlobalSetFlag("RC_GY_RykersSpider_Appeared");
Proc_RC_GY_RykersSpider_Appeared();

PROC
Proc_RC_GY_RykersSpider_Appeared()
THEN
DB_NOOP(1);
//END_REGION


//REGION Room trigger
IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_b650d3eb-7a69-412f-9634-3c56cd60adb3)
AND
DB_IsPlayer(_Player)
AND
PartyGetFlag(_Player,"RC_GY_RykersSpider_Knows",0)
THEN
Proc_RC_GY_RykersSpider_Intruder();

PROC
Proc_RC_GY_RykersSpider_Intruder()
AND
DB_GLobalFlag("RC_GY_RykersSpider_Appeared")
THEN
Proc_RC_GY_RykersSpider_Appeared();

PROC
Proc_RC_GY_RykersSpider_Intruder()
AND
NOT DB_GLobalFlag("RC_GY_RykersSpider_Appeared")
THEN
Proc_RC_GY_RykersSpider_Appear();

PROC
Proc_RC_GY_RykersSpider_Appeared()
AND
DB_InRegion(_Player,TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_b650d3eb-7a69-412f-9634-3c56cd60adb3)
AND
DB_IsPlayer(_Player)
AND
CharacterIsEnemy(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player,0)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,1)
THEN
Proc_StartDialog(0,"RC_GY_RykersPet_Spider",CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player);

PROC
Proc_RC_GY_RykersSpider_Appeared()
AND
DB_InRegion(_Player,TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_001_d5573c3d-c2c5-4490-a666-56b5e7f6010d)
AND
DB_IsPlayer(_Player)
AND
CharacterIsEnemy(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player,0)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,1)
THEN
Proc_StartDialog(0,"RC_GY_RykersPet_Spider",CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player);

PROC
Proc_RC_GY_RykersSpider_Appeared()
AND
DB_InRegion(_Player,TRIGGERGUID_S_RC_GY_RykerHouse_SpiderRoom_001_d5573c3d-c2c5-4490-a666-56b5e7f6010d)
AND
DB_IsPlayer(_Player)
AND
CharacterIsEnemy(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player,1)
THEN
EnterCombat(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Player);
//END_REGION


//REGION Dialog, trades, flags
IF
DialogEnded("RC_GY_RykersPet_Spider",_DlgInst)
AND
DB_DialogPlayers(_DlgInst,_Player,1)
AND
DB_IsPlayer((CHARACTERGUID)_Player)
THEN
PartySetFlag(_Player,"RC_GY_RykersSpider_Knows");

IF
DialogEnded("RC_GY_RykersPet_Spider",_DlgInst)
AND
Query_CharacterIsAliveAndNotInCombat(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be)
THEN
ProcCharacterMoveTo(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,TRIGGERGUID_S_RC_GY_RykersSpider_Spot_3b5bea69-4ae4-4dbf-8154-4c3a135e1178,0,"RC_GY_RykersSpider_Spot");

IF
StoryEvent(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"RC_GY_RykersSpider_Spot")
THEN
CharacterLookFromTrigger(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,TRIGGERGUID_S_RC_GY_RykersSpider_Spot_3b5bea69-4ae4-4dbf-8154-4c3a135e1178,0);

IF
StoryEvent(_Item,"RC_GY_RykersSpider_ItemIter")
AND
ObjectIsOnStage(_Item,1)
AND
ItemGetAmount((ITEMGUID)_Item,_Count)
THEN
ProcIncreaseCounter("RC_GY_RykersSpider_LimbCounter",_Count);
DB_RC_GY_RykersSpider_Bodyparts((ITEMGUID)_Item);


IF
TradeEnds(_Character,CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be)
AND
ObjectGetFlag(_Character,"RC_GY_RykersSpider_1stTrade",1)
THEN
DB_RC_GY_RykersSpider_LimbGiver(_Character);
ProcDeclareCounter("RC_GY_RykersSpider_LimbCounter");
InventoryLaunchTagIterator(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"BODYPART","","RC_GY_RykersSpider_ItemIter","RC_GY_RykersSpider_ItemIter1stComplete");


IF
GlobalFlagSet("RC_GY_RykersSpider_ItemIter1stComplete")
THEN
Proc_RC_GY_RykersSpider_CheckLimbCount1st();

PROC
Proc_RC_GY_RykersSpider_CheckLimbCount1st()
THEN
GlobalClearFlag("RC_GY_RykersSpider_ItemIter1stComplete");

PROC
Proc_RC_GY_RykersSpider_CheckLimbCount1st()
AND
DB_GlobalCounter("RC_GY_RykersSpider_LimbCounter",_Count)
AND
_Count >= 1
AND
DB_RC_GY_RykersSpider_LimbGiver(_Character)
THEN
ObjectSetFlag(_Character,"RC_GY_RykersSpider_GaveFood");
CharacterSetRelationIndivFactionToIndivFaction(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_Character,100);
CharacterSetRelationIndivFactionToIndivFaction(_Character,CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,100);

PROC
Proc_RC_GY_RykersSpider_CheckLimbCount1st()
AND
DB_RC_GY_RykersSpider_Bodyparts(_Bodypart)
THEN
NOT DB_RC_GY_RykersSpider_Bodyparts(_Bodypart);
SetOnStage(_Bodypart,0);


IF
TradeEnds(_Character,CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be)
AND
ObjectGetFlag(_Character,"RC_GY_RykersSpider_2ndTrade",1)
THEN
DB_RC_GY_RykersSpider_LimbGiver(_Character);
ProcDeclareCounter("RC_GY_RykersSpider_LimbCounter");
InventoryLaunchTagIterator(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,"BODYPART","","RC_GY_RykersSpider_ItemIter","RC_GY_RykersSpider_ItemIter2ndComplete");

IF
GlobalFlagSet("RC_GY_RykersSpider_ItemIter2ndComplete")
THEN
GlobalClearFlag("RC_GY_RykersSpider_ItemIter2ndComplete");
Proc_RC_GY_RykersSpider_CheckLimbCount2nd();


PROC
Proc_RC_GY_RykersSpider_CheckLimbCount2nd()
AND
DB_GlobalCounter("RC_GY_RykersSpider_LimbCounter",_Count)
AND
_Count >= 3
AND
DB_RC_GY_RykersSpider_LimbGiver(_Character)
THEN
NOT DB_RC_GY_RykersSpider_LimbGiver(_Character);
ObjectSetFlag(_Character,"RC_GY_RykersSpider_GaveMoreFood");

PROC
Proc_RC_GY_RykersSpider_CheckLimbCount2nd()
AND
DB_RC_GY_RykersSpider_Bodyparts(_Bodypart)
THEN
NOT DB_RC_GY_RykersSpider_Bodyparts(_Bodypart);
SetOnStage(_Bodypart,0);

PROC
Proc_RC_GY_RykersSpider_CheckLimbCount2nd()
THEN
ProcRemoveCounter("RC_GY_RykersSpider_LimbCounter");
SysClear("DB_RC_GY_RykersSpider_Bodyparts",1);
SysClear("DB_RC_GY_RykersSpider_LimbGiver",1);

IF
TradeEnds(_Character,CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be)
THEN
ObjectClearFlag(_Character,"RC_GY_RykersSpider_1stTrade");
ObjectClearFlag(_Character,"RC_GY_RykersSpider_2ndTrade");


IF
ObjectFlagSet("QuestUpdate_RC_GY_RykersSpider_RecievedGift",_Character,_DlgInst)
AND
ObjectIsCharacter(_Character,1)
THEN
CharacterGiveReward((CHARACTERGUID)_Character,"RC_GY_RykersSpider_Reward");

IF
ObjectFlagSet("QuestUpdate_RC_GY_RykersSpider_RecievedGift",_Character,_DlgInst)
AND
ObjectIsCharacter(_Character,1)
THEN
ObjectSetFlag(_Character,"RC_GY_RykersSpider_QuestComplete");

IF
ObjectFlagSet("QuestUpdate_RC_GY_RykersSpider_NoGift",_Character,_DlgInst)
AND
ObjectIsCharacter(_Character,1)
THEN
ObjectSetFlag(_Character,"RC_GY_RykersSpider_QuestComplete");

IF
ObjectFlagSet("QuestUpdate_RC_GY_RykersSpider_FooledSpider",_Character,_DlgInst)
AND
ObjectIsCharacter(_Character,1)
THEN
ObjectSetFlag(_Character,"RC_GY_RykersSpider_QuestComplete");
//END_REGION


// Attack on eggs
IF
AttackedByObject(_SpiderEggs,(CHARACTERGUID)_Character,_Summon,_,_)
AND
ObjectIsCharacter(_SpiderEggs,1)
AND
DB_RC_GY_RykerHouse_SpiderEggs((ITEMGUID)_SpiderEggs)
AND
DB_IsPlayer(_Character)
THEN
ProcSetFactionHostileToIndivPlayer("RC_GY_RykersSpider",_Character);
Proc_RC_GY_RykersSpider_Appear();


// SPIDERLINGS ENTER SAME COMBAT AS MOTHER
IF
StoryEvent((CHARACTERGUID)_Spiderling,"RC_GY_RykersSpider_HelpMotherSpider")
AND
CharacterIsInCombat(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,1)
AND
CombatGetIDForCharacter(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be,_CombatID)
AND
CombatGetInvolvedPlayer(_CombatID,1,_Character)
THEN
EnterCombat(_Spiderling,_Character);


// IF MOTHER DIES, SPIDERLINGS ATTACK EVERYONE
IF
CharacterDied(CHARACTERGUID_S_RC_GY_RykersSpider_bdc57d81-43fb-4592-8387-efd757a9b3be)
THEN
SetRelationFactionToPlayers("RC_GY_RykersSpider",0);


// Magister ghost things
IF
ObjectFlagSet("RC_GY_RykerHouse_SpiderRoom_Chill",_Player,_)
THEN
ObjectClearFlag(_Player,"RC_GY_RykerHouse_SpiderRoom_Chill");
ApplyStatus(_Player,"CHILLED",60.0,1);
EXITSECTION
SysClear("DB_RC_GY_RykerHouse_Spider_Doors",2);
SysClear("DB_RC_GY_RykerHouse_Spider_OpenOnTeleport",2);
SysClear("DB_RC_GY_RykerHouse_Spider_BlockedDoors",1);
SysClear("DB_RC_GY_RykerHouse_Spider_DoorsStrength",2);
SysClear("DB_RC_GY_RykerHouse_SpiderEggs",1);
ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
