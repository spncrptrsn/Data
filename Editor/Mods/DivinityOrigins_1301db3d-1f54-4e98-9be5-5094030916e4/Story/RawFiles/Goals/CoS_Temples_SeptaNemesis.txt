Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"CoS_Temples_Animal_002");
KBSECTION
IF
ObjectFlagSet("CoS_Temples_SeptaNemesisReward",(CHARACTERGUID)_Player,_)
THEN
CharacterGiveReward(_Player,"COS_CrabShield");
ObjectSetFlag(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"CoS_Temples_SeptaNemesisLeave");

IF
DialogEnded("CoS_Temples_Animal_002",_)
AND
ObjectGetFlag(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"CoS_Temples_SeptaNemesisLeave",1)
THEN
SetHasDialog(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,0);
ProcCharacterDisappearOutOfSight(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c, 0, 1, "", 0);

IF
ObjectEnteredCombat(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,_)
AND
QueryOnlyOnce("CoS_Temples_SeptaNemesis_Transformation")
THEN
JumpToTurn(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c);
Proc_CoS_Temples_SeptaNemesis_Transformation();

PROC
Proc_CoS_Temples_SeptaNemesis_Transformation()
THEN
PlayEffect(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"RS3_FX_Skills_Water_Cast_Ground_01");
PlayAnimation(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"Animals_Crab_ABC_Dodge_01","DoTransformation_GiantCrab");

IF
StoryEvent(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"DoTransformation_GiantCrab")
THEN
PlayEffect(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"RS3_FX_Skills_Water_Ice_Shout_Ground_01");
PlayAnimation(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"Animals_Crab_ABC_Attack_1H_03");
//Transform(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"Quest_CoS_SeptaNemesis_Animals_Crab_A_Giant_a360f2c5-92e4-426e-8856-d42d7ec6467f",1);
CharacterTransform(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"Quest_CoS_SeptaNemesis_Animals_Crab_A_Giant_a360f2c5-92e4-426e-8856-d42d7ec6467f",1,1,1,0,1,0,0);
ApplyStatus(CHARACTERGUID_S_CoS_Temples_Animal_002_ab1ba23b-227b-4315-a096-b6c0b4bc8a5c,"MEND_METAL",-1.0);

PROC
ProcRegionEnded("CoS_Main")
THEN
GoalCompleted;

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "CoS_Temples"
