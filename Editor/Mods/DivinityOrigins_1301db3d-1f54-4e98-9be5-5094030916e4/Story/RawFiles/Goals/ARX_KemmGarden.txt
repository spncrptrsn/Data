Version 1
SubGoalCombiner SGC_AND
INITSECTION
// https://sites.google.com/a/larian.com/projecttest/home/wiki-articles/quest-design-documentation/kemm-s-garden
// https://docs.google.com/document/d/1GCGB2qRDe94uu23okthZS6Ta1wg2Qn3KqgV4Tjgx9vo/edit#bookmark=id.i62fwkshavxa

DB_ARX_TalkingFlower((ITEMGUID)ITEMGUID_S_ARX_TalkingFlower1_6f2f90d9-2195-4db1-afb9-c114f7acbf52,"ARX_TalkingFlower1");
DB_ARX_TalkingFlower(ITEMGUID_S_ARX_TalkingFlower2_46a74598-0a86-47b3-a265-f0c6e94d3009,"ARX_TalkingFlower2");
DB_ARX_TalkingFlower(ITEMGUID_S_ARX_TalkingFlower3_c5b22973-1fde-454e-b272-aeb430bc2cfe,"ARX_TalkingFlower3");

DB_Dialogs(CHARACTERGUID_S_RC_ARX_KemmMansion_GardenFrog_e053e8cd-3c79-4788-8105-80056b35504a,"RC_ARX_KemmMansion_GardenFrog");
DB_Dialogs(ITEMGUID_S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f,"ARX_KemmGarden_ScreamerContainer");

DB_ShovelArea(TRIGGERGUID_S_ARX_YarrowShovel_0ca1323f-9f10-430e-97f4-584cb0eba50b,"ARX_YarrowShovel",ITEMGUID_S_ARX_YarrowPile_f9fb6c43-5427-4839-a5c0-553eb8b48f23);
DB_ShovelRewardItemSpawn("ARX_YarrowShovel",ITEMGUID_S_ARX_YatrrowDrudanae_32bcf5c7-1d5b-4779-bab3-b535ed0ee456);
DB_ShovelRewardItemScatter("ARX_YarrowShovel",ITEMGUID_S_ARX_YatrrowDrudanae_Reward_55182707-3415-464f-8a73-d9b87a71f6fa);

DB_OneShot_VoiceBarkTrigger(TRIGGERGUID_S_ARX_Box_GardenYarrow_253ab6ce-52bd-460f-9c4d-ec747c520da7,"ARX_VB_KemmMansion_Yarrow");
DB_OneShot_VoiceBarkTrigger(TRIGGERGUID_S_ARX_Box_GardenBloodRose_523fc590-3e81-4722-804f-ad475817bdcb,"ARX_VB_KemmMansion_BloodRose");

ItemSetCanInteract(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,0);

DB_ARX_KemmsGarden_HotKettle((ITEMGUID)ITEMGUID_S_ARX_KemmGarden_HotKettle1_6ac9eb77-ba70-4716-b7c8-67da15baf0ea);
DB_ARX_KemmsGarden_HotKettle(ITEMGUID_S_ARX_KemmGarden_HotKettle2_c5da22ae-7cb4-45db-966a-95d8fc95b8bb);
DB_ARX_KemmsGarden_HotKettle(ITEMGUID_S_ARX_KemmGarden_HotKettle3_423fd987-a2b8-40ad-800b-9ebae2aea4b2);
DB_ARX_KemmsGarden_HotKettle(ITEMGUID_S_ARX_KemmGarden_HotKettle4_7e8811d2-6bff-44af-8a16-cc6b1190679b);



DB_ARX_KemmsGarden_Cobmat_HiddenPlants((CHARACTERGUID)CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_01_f971c19e-4fbb-45fb-a57e-2d7991aade88,ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_01_Bush_92daeded-9b63-44d0-9378-f87406b417d9);
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_02_67ea8705-133f-42d6-b8fe-32065f6c45c2,ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_02_Bush_8dafc15a-9e02-4a48-896b-ac8da73a6890);
//DB_ARX_KemmsGarden_Cobmat_HiddenPlants(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_03_4f986330-bb18-4ecf-84b3-ee0adc683de9,ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_03_Bush_59cd0cd2-3584-4e0d-b1f5-e1aa55c4ffc7);
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_02_cddc80f7-32dd-4cd4-bdf4-0cf29b531ece,ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_02_Trunk_30ebca4b-33bb-4da8-82c7-734165f01242);
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_01_cb26f904-3b70-4d1b-b36d-aee47955f8f3,ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_01_Trunk_0f10ec6c-f8d0-4218-af8f-b657a1864c03);


DB_ARX_KemmsGarden_Cobmat((CHARACTERGUID)CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099);
DB_ARX_KemmsGarden_Cobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_01_f971c19e-4fbb-45fb-a57e-2d7991aade88);
DB_ARX_KemmsGarden_Cobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_02_67ea8705-133f-42d6-b8fe-32065f6c45c2);
//DB_ARX_KemmsGarden_Cobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Caster_03_4f986330-bb18-4ecf-84b3-ee0adc683de9);
DB_ARX_KemmsGarden_Cobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_02_cddc80f7-32dd-4cd4-bdf4-0cf29b531ece);
DB_ARX_KemmsGarden_Cobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Ranger_01_cb26f904-3b70-4d1b-b36d-aee47955f8f3);

ProcTriggerRegisterForPlayers(TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998);
KBSECTION
//REGION Screamer 

IF
DialogEnded("ARX_KemmGarden_ScreamerContainer",_ID)
AND
GlobalGetFlag("ARX_KemmGarden_PickScreamer",1)
AND
DialogGetInvolvedPlayer(_ID,1,(CHARACTERGUID)_Player)
AND
GetPosition(ITEMGUID_S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f,_X,_Y,_Z)
AND
RealSum(_Y,2.0,_NewY)
THEN
PlaySound(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"Items_Objects_Destroy_SwitchBypass_ClayGlass_Hvy");
ObjectSetFlag(_Player,"ARX_KemmGarden_PlayerDestroyedContainer");
PlayEffectAtPosition("RS3_FX_GP_Impacts_Glass_Ice_Big_01",_X,_NewY,_Z);
ItemDestroy(ITEMGUID_S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f);
PlayEffect(_Player,"RS3_FX_GP_Combat_CameraShake_A");
ItemSetCanInteract(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,1);


IF
CharacterDestroyedItem(_Player,S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f)
AND
DB_IsPlayer(_Player)
THEN
ObjectSetFlag(_Player,"ARX_KemmGarden_PlayerDestroyedContainer");
PlayEffect(_Player,"RS3_FX_GP_Combat_CameraShake_A");


IF
ItemDestroying(S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f)
AND
GetPosition(ITEMGUID_S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f,_X,_Y,_Z)
AND
RealSum(_Y,2.0,_NewY)
THEN
PlaySound(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"Items_Objects_Destroy_SwitchBypass_ClayGlass_Hvy");
ItemSetCanInteract(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,1);
PlayEffectAtPosition("RS3_FX_GP_Impacts_Glass_Ice_Big_01",_X,_NewY,_Z);
ObjectSetFlag(S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"ARX_Scremer_StartScreaming");
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_Screamer_Plant_01",S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"S_ARX_Screamer_LoopFX","__ANY__","");
//DB_S_ARX_Screamer_Looping_FX(S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,_Handle);
//PlaySound(S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"SE_ARX_ScreamingPlant_Loop_Start");
Proc_ARX_AD_Screamer_Plant_StartAD();

IF
ItemMoved(S_ARX_ScreamerContainer_401a262d-a6b1-4227-864a-412b54d3d68f)
THEN
ItemSetCanInteract(ITEMGUID_S_ARX_KemmGarden_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,1);

PROC
Proc_ARX_AD_Screamer_Plant_StartAD()
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"ARX_KemmGarden_PlayerDestroyedContainer",1)
AND
QueryOnlyOnce("ARX_KemmGarden_PlayerDestroyedContainer")
THEN
Proc_StartDialog(1,"ARX_AD_Screamer",S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,_Player);


PROC
Proc_ARX_AD_Screamer_Plant_StartAD()
AND
QueryOnlyOnce("ARX_KemmGarden_PlayerDestroyedContainer")
THEN
Proc_StartDialog(1,"ARX_AD_Screamer",S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb);

IF
CanPickupItem(_Player,S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,_ID)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"ARX_ScreamerInInventory",0)
THEN
PROC_StopLoopEffect(S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"S_ARX_Screamer_LoopFX");

/*
IF
ItemTemplateAddedToCharacter(PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c,_Item,_Player)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"ARX_ScreamerInInventory",0)
THEN
PROC_StopLoopEffect(_Item,"S_ARX_Screamer_LoopFX");
*/

IF
ItemTemplateAddedToCharacter(PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c,_Item,_Player)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"ARX_ScreamerInInventory",0)
THEN
ObjectSetFlag(_Player,"ARX_ScreamerInInventory");
//PlaySound(_Item,"SE_ARX_ScreamingPlant_Loop_Stop");
ApplyStatus(_Player,"DEAF",-1.0,1);
ApplyStatus(_Player,"MUTED",-1.0,1);
Proc_StartDialog(1,"ARX_AD_Screamer_AddedTo_PlayerInventory",_Player);
CharacterRegisterCrime(_Player,"LoudContinuousNoise",NULL_00000000-0000-0000-0000-000000000000,NULL_00000000-0000-0000-0000-000000000000,0);
PlaySound(_Player,"SE_ARX_ScreamingPlant_Loop_Start"); 
PlaySound(_Player,"SE_ARX_ScreamingPlant_AddedToInventory");

IF
ItemTemplateAddedToContainer("PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",_Item,_Container)
AND
ObjectGetFlag(_Container,"ARX_ScreamerInInventory",0)
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_Screamer_Plant_01",_Container,"S_ARX_Screamer_LoopFX_Container","__ANY__","");
PlaySound(_Container,"SE_ARX_ScreamingPlant_AddedToInventory");
ObjectSetFlag(_Container,"ARX_ScreamerInInventory");
proc_ARX_Screamer_CheckFor_ContainerHelper_Add(_Container);

PROC
proc_ARX_Screamer_CheckFor_ContainerHelper_Add((ITEMGUID)_Container)
AND
NOT DB_GlobalFlag("ARX_Screamer_ContainerHelper_DoesntExist")
THEN
SetOnStage(ITEMGUID_S_ARX_KemmGarden_Screamer_Helper_bba16abb-f727-45ae-9d1d-9e7045193f70,1);
TeleportTo(ITEMGUID_S_ARX_KemmGarden_Screamer_Helper_bba16abb-f727-45ae-9d1d-9e7045193f70,_Container);
ObjectSetFlag(ITEMGUID_S_ARX_KemmGarden_Screamer_Helper_bba16abb-f727-45ae-9d1d-9e7045193f70,"ARX_Scremer_StartScreaming");


IF
ItemTemplateRemovedFromContainer("PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",_Item,_Container)
AND
ItemTemplateIsInContainer(_Container,"PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",0)
AND
ObjectGetFlag(_Container,"ARX_ScreamerInInventory",1)
THEN
ObjectClearFlag(_Container,"ARX_ScreamerInInventory");
PlaySound(_Container,"SE_ARX_ScreamingPlant_RemovedFromInventory");
PROC_StopLoopEffect(_Container,"S_ARX_Screamer_LoopFX_Container");
proc_ARX_Screamer_CheckFor_ContainerHelper_Remove();

IF
ItemTemplateRemovedFromContainer("PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",_Item,_Container)
AND
ItemIsInInventory(_Item,0)
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_Screamer_Plant_01",S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"S_ARX_Screamer_LoopFX","__ANY__","");

PROC
proc_ARX_Screamer_CheckFor_ContainerHelper_Remove()
AND
NOT DB_GlobalFlag("ARX_Screamer_ContainerHelper_DoesntExist")
THEN
ObjectClearFlag(ITEMGUID_S_ARX_KemmGarden_Screamer_Helper_bba16abb-f727-45ae-9d1d-9e7045193f70,"ARX_Scremer_StartScreaming");
SetOnStage(ITEMGUID_S_ARX_KemmGarden_Screamer_Helper_bba16abb-f727-45ae-9d1d-9e7045193f70,0);

IF
ItemTemplateAddedToCharacter(PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c,_Item,_NPC)
AND
NOT DB_IsPlayer(_NPC)
THEN
PlayAnimation(_NPC,"cower");
Proc_StartDialog(1,"GEB_ARX_AD_DropScreamer",_NPC);
ItemDrop(_Item);
Proc_StartDialog(1,"ARX_AD_Screamer",_Item);

IF
ItemTemplateRemovedFromCharacter("PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",_Item,_Player)
AND
DB_IsPlayer(_Player)
AND
ItemTemplateIsInCharacterInventory(_Player,"PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",0)
AND
ObjectGetFlag(_Player,"ARX_ScreamerInInventory",1)
THEN
ObjectClearFlag(_Player,"ARX_ScreamerInInventory");
RemoveStatus(_Player,"MUTED");
RemoveStatus(_Player,"DEAF");
PlaySound(_Player,"SE_ARX_ScreamingPlant_Loop_Stop");
PlaySound(_Player,"SE_ARX_ScreamingPlant_RemovedFromInventory");
CharacterStopCrime(_Player,"LoudContinuousNoise",NULL_00000000-0000-0000-0000-000000000000);

IF
ItemTemplateRemovedFromCharacter("PUZ_Plant_Screamer_9bedc21f-eb84-46f6-b902-d119a6a5aa3c",_Item,_Player)
AND
ItemIsInInventory(_Item,0)
THEN
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_Screamer_Plant_01",S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"S_ARX_Screamer_LoopFX","__ANY__","");

IF
CharacterUsedItem(_Player,ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb)
AND
ItemIsInCharacterInventory(ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,_Player,1)
THEN
CloseUI(_Player,"Inventory");
Proc_StartDialog(1,"ARX_AD_ScreamerSquash",_Player);
PlaySound(_Player,"SE_ARX_ScreamingPlant_Loop_Stop");


IF
CharacterUsedItem(_Player,ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb)
AND
ItemIsInCharacterInventory(ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,_Player,0)
THEN
Proc_StartDialog(1,"ARX_AD_ScreamerSquash",_Player);

IF
CharacterUsedItem(_Player,ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb)
THEN
PROC_StopLoopEffect(ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"S_ARX_Screamer_LoopFX");
CharacterAddSkill(_Player,"Shout_Deafen");
PlaySound(_Player,"SE_ARX_ScreamingPlant_AddedToInventory");

//PlaySound(ITEMGUID_S_ARX_Screamer_9981fb6c-72d3-45ec-8529-fc1c240503eb,"SE_ARX_ScreamingPlant_Loop_Stop");
//END_REGION

//REGION Hot Kettle

PROC
ProcBlockPickupOfItem(_Player,_KettlePlant)
AND
DB_ARX_KemmsGarden_HotKettle(_KettlePlant)
THEN
Proc_StartDialog(1,"ARX_AD_HotKettleStuck",_Player);
DB_CustomPickupItemResponse(_Player,_KettlePlant,0);

IF
StoryEvent(_Plant,"GEN_RedKettleTransform")
AND
GetPosition(_Plant,_X,_Y,_Z)
THEN
PlayEffectAtPosition("RS3_FX_GP_ScriptedEvent_KettlePlantTransfom_01",_X,_Y,_Z);
Transform(_Plant,"PUZ_Red_Kettle_104712bc-6757-4253-a71d-b1749d693a1c",0);

//END_REGION

//REGION Parrot plant

IF
DB_ARX_TalkingFlower(_Plant,_Dialog)
THEN
DB_Dialogs(_Plant,_Dialog);

/*
IF
ItemTemplateAddedToCharacter(PUZ_Parrotplant_Growing_4f8264f2-c53c-48d9-8e0e-a9d787e6b7da,_Plant,_Player)
THEN
Proc_StartDialog(1,"ARX_AD_Parrotplant_Pickup",_Player);
ItemRemove(_Plant);
ItemTemplateAddTo("PUZ_Parrotplant_Sear_dc741db7-e39d-416b-b0ff-b46044310a1a",_Player,1);
*/

IF
DialogStarted(_Dialog,_)
AND
DB_ARX_TalkingFlower(_Plant,_Dialog)
THEN
PROC_LoopEffect("RS3_FX_Surface_Clouds_Petals_01_Blue",_Plant,"FX_ParrotPlant","Arx_Main","");

IF
ObjectFlagSet("ARX_TalkingFlower_Touch",_Plant,_)
THEN
ObjectClearFlag(_Plant,"ARX_TalkingFlower_Touch",0);
PROC_LoopEffect("RS3_FX_GP_Status_BlindingRadiance_01",_Plant,"FX_ParrotPlant","Arx_Main","");

IF
DialogEnded(_Dialog,_)
AND
DB_ARX_TalkingFlower(_Plant,_Dialog)
THEN
PROC_StopLoopEffect(_Plant,"FX_ParrotPlant");

IF
ObjectFlagSet("ARX_TalkingFlower_Pickup_Freeze",_Player,_ID)
THEN
ApplyStatus(_Player,"FROZEN",2.0,1);
ObjectClearFlag(_Player,"ARX_TalkingFlower_Pickup_Freeze");

//END_REGION

//REGION Yarrow

IF
ItemAddedToCharacter(ITEMGUID_S_ARX_BigYarrow_ac9ec8a8-12e3-4c4f-a3b1-78393d564638,_Player)
AND
QueryOnlyOnce("ARX_VB_BeautifulYarrow")
THEN
StartVoiceBark("ARX_VB_BeautifulYarrow",_Player);

IF
CharacterUsedItem(_Player,ITEMGUID_S_ARX_BigYarrow_ac9ec8a8-12e3-4c4f-a3b1-78393d564638)
AND
QueryOnlyOnce("ARX_VB_BeautifulYarrow")
THEN
StartVoiceBark("ARX_VB_BeautifulYarrow",_Player);

PROC
ProcShovelRewards(_Player,"ARX_YarrowShovel")
THEN
StartVoiceBark("ARX_VB_DrudanaeYarrow",_Player);

//END_REGION

//REGION Flower Combat
//Init
IF
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(_CobmatFlower,_Bush)
THEN
TeleportTo(_Bush,_CobmatFlower);

IF
DB_ARX_KemmsGarden_Cobmat(_CombatFlower)
THEN
SetOnStage(_CombatFlower,0);


//Dialog
IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998)
AND
DB_IsPlayer(_Player)
AND
HasActiveStatus(_Player, "INVISIBLE", 0)
AND
HasActiveStatus(_Player, "SNEAKING", 0)
AND
CharacterIsDeadOrFeign(_Player,0)
AND
QRY_SpeakerIsAvailable(_Player)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_ShamblingMound_StartDialog")
THEN
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog(_Player);

IF
CharacterStatusRemoved(_Player, "INVISIBLE",_)
AND
DB_InRegion(_Player, TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998)
AND
QRY_SpeakerIsAvailable(_Player)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_ShamblingMound_StartDialog")
THEN
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog(_Player);

IF
CharacterResurrected(_Player)
AND
DB_InRegion(_Player, TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998)
AND
QRY_SpeakerIsAvailable(_Player)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_ShamblingMound_StartDialog")
THEN
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog(_Player);

IF
CharacterStatusRemoved(_Player, "PLAY_DEAD",_)
AND
DB_InRegion(_Player, TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_ShamblingMound_StartDialog")
THEN
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog(_Player);

IF
CharacterStatusRemoved(_Player, "SNEAKING",_)
AND
DB_InRegion(_Player, TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_ShamblingMound_StartDialog")
THEN
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog(_Player);

PROC
proc_ARX_KemmMansion_Garden_ShamblingMound_StartDialog((CHARACTERGUID)_Player)
THEN
Proc_StartDialog(0,"ARX_KemmMansion_Garden_ShamblingMound",ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,_Player);
ProcTriggerUnregisterForPlayers(TRIGGERGUID_S_ARX_KemmMansion_Garden_Shamb_BoxT_9741375d-99f9-4240-8a79-97b575abe998);

IF
ObjectFlagSet("ARX_KemmMansion_Garden_ShamblingMound_Tree_PlayFX",ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,_ID)
THEN
PROC_LoopEffect("RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_Loop_01",ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,"ARX_KemmMansion_Garden_ShamblingMound_Tree_PlayFX","ARX_Main","");

IF
DialogEnded("ARX_KemmMansion_Garden_ShamblingMound",_ID)
THEN
PROC_StopLoopEffect(ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,"ARX_KemmMansion_Garden_ShamblingMound_Tree_PlayFX");
PlayEffect(ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,"RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_01");
CharacterAppear(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,1,"ARX_KemmsGarden_TreeAppeared");
PlayEffect(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_01"); 
PlaySound(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"FX_Char_Animals_Bear_A_VoidTransform_01_Part1");
ProcObjectTimer(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"Play_FX_Char_Animals_Bear_A_VoidTransform_01_Part2",1100);

PROC
ProcObjectTimerFinished(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"Play_FX_Char_Animals_Bear_A_VoidTransform_01_Part2")
THEN
PlaySound(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"FX_Char_Animals_Bear_A_VoidTransform_01_Part2");

IF
StoryEvent(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"ARX_KemmsGarden_TreeAppeared")
THEN
SetOnStage(ITEMGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_Tree_c59116f2-0c7e-49ad-84f8-b00ca1bdba98,0);


//Combat logic
IF
CharacterUsedSkill(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,"Rain_EnemySunshine",_,_)
AND
ObjectIsInTrigger(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,TRIGGERGUID_ATM_ARX_KemmGarden_Sunshine_14603675-9941-4b9f-b092-e90cabe0c073,1)
AND
QueryOnlyOnce("ARX_KemmMansion_Garden_Shambl_Tank_Rain_EnemySunshine")
THEN
TriggerSetAtmosphere(TRIGGERGUID_ATM_ARX_KemmGarden_Sunshine_14603675-9941-4b9f-b092-e90cabe0c073,"cd367a1b-5845-4fb2-acf2-c9b4d2d123bd");

IF
ObjectEnteredCombat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID)
THEN
DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID);

IF
ObjectSwitchedCombat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_OldId,_NewId)
THEN
NOT DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_OldId);
DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_NewId);

IF
ObjectTurnStarted((CHARACTERGUID)_Player)
AND
DB_IsPlayer(_Player)
AND
DB_CombatCharacters(_Player,_ID)
AND
DB_ARX_KemmsGarden_Cobmat(_Flower)
AND
DB_CombatCharacters(_Flower,_ID)
AND
QueryOnlyOnce("ARX_VB_KemmsMansion_Garden_CombatFlower_PlayerReact")
THEN
StartVoiceBark("ARX_VB_KemmsMansion_Garden_CombatFlower_PlayerReact",_Player);

IF
VoiceBarkFailed("ARX_VB_KemmsMansion_Garden_CombatFlower_PlayerReact")
AND
DB_OnlyOnce("ARX_VB_KemmsMansion_Garden_CombatFlower_PlayerReact")
THEN
NOT DB_OnlyOnce("ARX_VB_KemmsMansion_Garden_CombatFlower_PlayerReact");

IF
CombatEnded(_ID)
AND
DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID)
AND
CharacterIsDead(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,1)
THEN
TriggerSetAtmosphere(TRIGGERGUID_ATM_ARX_KemmGarden_Sunshine_14603675-9941-4b9f-b092-e90cabe0c073,"f83b1ab1-8367-4add-84b0-5b9b6b55aa5c");

IF
CombatEnded(_ID)
AND
DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID)
THEN
NOT DB_ARX_KemmMansion_Garden_Shamb_SunShineInCobmat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID);

IF
ObjectEnteredCombat(CHARACTERGUID_S_RC_ARX_KemmMansion_Garden_Shambl_Tank_01_0b0b9920-64e4-4b29-b465-0c578916a099,_ID)
AND
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(_CombatFlower,_Bush)
THEN
CharacterAppear(_CombatFlower,0,"ARX_KemmsMansion_Garden_CombatFlowerAppeared");
PlayEffect(_Bush,"RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_01");
PlayEffect(_CombatFlower,"RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_01");
ProcObjectTimer(_Bush,"ARX_KemmsMansion_Garden_CombatFlower_BushOffStage",1000); 


PROC
ProcObjectTimerFinished(_Bush,"ARX_KemmsMansion_Garden_CombatFlower_PlayEffect")
AND
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(_CombatFlower,_Bush)
THEN
PlayEffect(_CombatFlower,"RS3_FX_ScriptedEvent_ARX_KemmsGarden_Transform_01");

PROC
ProcObjectTimerFinished(_Bush,"ARX_KemmsMansion_Garden_CombatFlower_BushOffStage")
AND
DB_ARX_KemmsGarden_Cobmat_HiddenPlants(_CombatFlower,_Bush)
THEN
SetOnStage(_Bush,0);
NOT DB_ARX_KemmsGarden_Cobmat_HiddenPlants(_CombatFlower,_Bush);

//READING DOCTOR LETTER
IF
GameBookInterfaceClosed(S_ARX_KemmsGarden_Doctor_Letter_11d0b435-b0b3-4cec-a100-0594b8f1e934,_Player)
AND
DB_IsPlayer(_Player)
THEN
ObjectSetFlag(_Player,"QuestUpdate_ARX_TheDoctor_KemmGarden_Doctor");


//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ARX"
