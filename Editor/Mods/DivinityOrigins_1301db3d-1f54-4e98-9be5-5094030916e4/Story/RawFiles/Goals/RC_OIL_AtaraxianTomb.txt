Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"RC_OIL_Tomb_Ataraxian");
DB_RC_OIL_TombEternal(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d);
DB_RC_OIL_TombEternal(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_01_84213369-e09e-4589-b4d5-7e8bbbba8d18);
DB_RC_OIL_TombEternal(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_02_6ed136a3-0f28-4b58-a9df-82f6c9d949dd);
DB_RC_OIL_TombEternal(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_03_efa12e2c-a6b8-4bd7-a3cb-bc161940f306);
DB_RC_OIL_TombEternal(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_04_753d4374-ec3c-4d1f-ba60-c8d8c350baed);

DB_RC_OIL_TombContainer((ITEMGUID)ITEMGUID_S_RC_OIL_Tomb_Container1_5c8337fb-5756-c77f-df22-c9f87db7cff1);
DB_RC_OIL_TombContainer(ITEMGUID_S_RC_OIL_Tomb_Container2_0de639fc-d402-4f44-9b73-908a538c6caf);

DB_OneShotPlayerTrigger(TRIGGERGUID_S_RC_OIL_Tomb_Init_6ace20f3-492a-4bb7-a658-9d82e608dc6a);

ItemSetCanInteract(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,0);

DB_KilledEvent(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"QuestUpdate_RC_OIL_Main_EternalKilled");
KBSECTION
IF
TextEventSet("ppp")
THEN
ItemMoveToTrigger(ITEMGUID_S_RC_OIL_Cave_HumanStatue_de08b287-3dd5-4114-8234-0fd8ec8909a2,TRIGGERGUID_S_RC_OIL_Cave_HumanStatue_Point_07b53116-66f4-435b-8d08-32ecbbecc8c5,2.5,1.1,0);

IF 
ObjectEnteredCombat((CHARACTERGUID)_Enemy,_) 
AND 
DB_RC_OIL_TombEternal(_Enemy) 
AND 
QueryOnlyOnce("RC_OIL_CombatSave_Ataraxian") 
THEN 
AutoSave();

IF
DB_RC_OIL_TombEternal(_Eternal)
THEN
SetOnStage(_Eternal,0);

PROC
ProcOneShotTriggerEntered(_Player,TRIGGERGUID_S_RC_OIL_Tomb_Init_6ace20f3-492a-4bb7-a658-9d82e608dc6a)
THEN
Proc_StartDialog(1,"RC_OIL_AD_TombInit",_Player);
Proc_ShakeCameraForTime(_Player,4800);

PROC
ProcOneShotTriggerEntered(_Player,TRIGGERGUID_S_RC_OIL_Tomb_Init_6ace20f3-492a-4bb7-a658-9d82e608dc6a)
AND
DB_RC_OIL_TombContainer(_Container)
THEN
PlayEffect(_Container,"RS3_FX_GP_ScriptedEvent_Source_Absorb_01");
TimerLaunch("Timer_RC_OIL_Puzzle_TombTransform",4800);

IF
TimerFinished("Timer_RC_OIL_Puzzle_TombTransform")
THEN
ItemSetCanInteract(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,1);

IF
CharacterUsedItem(_Player,ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec)
AND
QueryOnlyOnce("RC_OIL_Cave_Sarcofagus")
THEN
PartySetFlag(_Player,"QuestUpdate_RC_OIL_Main_OpenTomb");
DB_RC_OIL_Cave_EternalAwaker(_Player);
PlayEffect(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,"RS3_FX_GP_ScriptedEvent_PuzzlePillars_01");
GlobalSetFlag("RC_OIL_Tomb_StartSouceLeak");
CharacterAppear(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,1,"RC_OIL_EternalAppeared");
CharacterAppear(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_01_84213369-e09e-4589-b4d5-7e8bbbba8d18,1,"");
CharacterAppear(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_03_efa12e2c-a6b8-4bd7-a3cb-bc161940f306,1,"");
Transform(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,"PUZ_Ataraxian_Sarcophagus_26ee75d9-4a0d-4e24-af47-506e8d189489",0);
ItemSetCanInteract(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,0);
CreateSurface(ITEMGUID_RC_OIL_Puzzle_Sarcofagus1_7644f7e9-1358-4433-9800-e7d1363290ec,"SurfaceSource",2.5,-1.0);
TimerLaunch("RC_OIL_Tomb_SecondHoundAppears",400);

IF
StoryEvent(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"RC_OIL_EternalAppeared")
AND
GetPosition(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_X,_Y,_Z)
THEN
PlayAnimation(S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"cast_target_cast");
TeleportTo(S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,RC_EternalBoss_SpawnTeleport_01_59824763-52df-4cea-be06-771196c8f4f9,"RC_OIL_EternalTp",1);

IF
StoryEvent(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"RC_OIL_EternalTp")
AND
GetPosition(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_X,_Y,_Z)
THEN
PlayEffectAtPosition("RS3_FX_Char_Ghosts_Teleport_in_01",_X,_Y,_Z);

IF
StoryEvent(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"RC_OIL_EternalTp")
AND
DB_RC_OIL_Cave_EternalAwaker(_Player)
THEN
Proc_StartDialog(0,"RC_OIL_Tomb_Ataraxian",CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_Player);

IF
TimerFinished("RC_OIL_Tomb_SecondHoundAppears")
THEN
CharacterAppear(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_02_6ed136a3-0f28-4b58-a9df-82f6c9d949dd,1,"");
CharacterAppear(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_04_753d4374-ec3c-4d1f-ba60-c8d8c350baed,1,"");

IF
CharacterReceivedDamage(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d, _, _)
AND
QueryOnlyOnce("RC_OIL_EternalCombat")
THEN
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_01_84213369-e09e-4589-b4d5-7e8bbbba8d18,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_02_6ed136a3-0f28-4b58-a9df-82f6c9d949dd,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_03_efa12e2c-a6b8-4bd7-a3cb-bc161940f306,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_04_753d4374-ec3c-4d1f-ba60-c8d8c350baed,"Evil NPC");

IF
DialogEnded("RC_OIL_Tomb_Ataraxian",_ID)
AND
DB_DialogPlayers(_ID,_Player,1)
THEN
Proc_RC_OIL_AtaraxianDialogEnded((CHARACTERGUID)_Player);

PROC
Proc_RC_OIL_AtaraxianDialogEnded((CHARACTERGUID)_Player)
THEN
ProcShowMarker((CHARACTERGUID)_Player,"RC_OIL_Ruins");

PROC
Proc_RC_OIL_AtaraxianDialogEnded((CHARACTERGUID)_Player)
AND
QueryOnlyOnce("RC_OIL_EternalCombat")
THEN
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_01_84213369-e09e-4589-b4d5-7e8bbbba8d18,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_02_6ed136a3-0f28-4b58-a9df-82f6c9d949dd,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_03_efa12e2c-a6b8-4bd7-a3cb-bc161940f306,"Evil NPC");
SetFaction(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_Doggy_04_753d4374-ec3c-4d1f-ba60-c8d8c350baed,"Evil NPC");

PROC
Proc_ObjectLeftCombat((CHARACTERGUID)_Player,_ID)
AND
DB_IsPlayer(_Player)
AND
DB_WasInCombat(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_ID)
AND
PartyGetFlag(_Player,"RC_OIL_Tomb_GodRDDFired",0)
THEN
PartySetFlag(_Player,"RC_OIL_Tomb_GodRDDFired");
ProcDefineReflectionDialog("RC_OIL_RD_GodsWereEternals",_Player);

IF
AttackedByObject(_Eternal,_,_Attacker,_,_)
AND
_Eternal != _Attacker
AND
DB_RC_OIL_TombEternal(_Eternal)
AND
GetFaction(_Eternal,"Good NPC")
AND
QueryOnlyOnce("RC_OIL_EternalCombat")
AND
DB_RC_OIL_TombEternal(_Eternals)
THEN
SetFaction(_Eternals,"Evil NPC");

//REGION Combat updates
IF
ObjectEnteredCombat(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_CombatID)
AND
DB_IsPlayer(_Player)
AND
CharacterIsEnemy(_Player, CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d, 1)
AND
DB_CombatCharacters(_Player,_CombatID)
THEN
PartySetFlag(_Player,"QuestUpdate_RC_OIL_Main_EternalFight");


//END_REGION

IF
DB_OnlyOnce("RC_OIL_EternalCombat")
AND
DB_DialogNpcs(_,CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d,_)
THEN
DialogRequestStop(CHARACTERGUID_S_RC_OIL_Tomb_Ataraxian_b844294c-62c2-4ff8-82f1-f874b9e4352d);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
