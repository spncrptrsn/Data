Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"RC_DW_UnderTavern_Dorotya");

SetOnStage(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,0);

DB_RC_DW_DorotyaForm(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
DB_RC_DW_DorotyaForm(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);

ItemTemplateAddTo("Quest_Resurrection_Idol_6b70e6e1-855e-4295-b79b-d87ebd6bd4af",CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,1);

DB_SharedObjectFlags("RC_DW_Dorotya_Mask");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_CameAlone");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_WaitingForMe");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_Outcome_Knowledge");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_Outcome_Money");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_Outcome_Power");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_Outcome_Strength");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_Outcome_EndlessLife");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_RefusedDeal");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Quiz_ReceiveReward");
DB_SharedObjectFlags("RC_DW_UT_Dorotya_Stoodup");
DB_SharedObjectFlags("RC_DW_Dorotya_UserKissed");
KBSECTION
//REGION Dorotya ResurrectionIdol
IF
CharacterDied(_Dorotya)
AND
DB_RC_DW_DorotyaForm(_Dorotya)
AND
ItemTemplateIsInCharacterInventory(_Dorotya,"Quest_Resurrection_Idol_6b70e6e1-855e-4295-b79b-d87ebd6bd4af",1)
THEN
ProcObjectTimer(_Dorotya,"ResurrectionIdol",1000);

IF
CharacterDied(_Dorotya)
AND
DB_RC_DW_DorotyaForm(_Dorotya)
AND
ItemTemplateIsInCharacterInventory(_Dorotya,"Quest_Resurrection_Idol_6b70e6e1-855e-4295-b79b-d87ebd6bd4af",0)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"QuestAdd_RC_DW_SpidersKiss",1)
THEN
ObjectSetFlag(_Player,"QuestUpdate_RC_DW_SpidersKiss_SpiderDead");
//ObjectSetFlag(_Player,"QuestClose_RC_DW_SpidersKiss");

IF
CharacterResurrected(_Dorotya)
AND
DB_RC_DW_DorotyaForm(_Dorotya)
THEN
Proc_StartDialog(1,"RC_DW_AD_UnderTavern_Dorotya_Resurrects",_Dorotya);
//END_REGION

//REGION Walk To Kiss Spot
IF
ObjectFlagSet("RC_DW_UT_Dorotya_WaitingForMe",_Player,_)
THEN
DB_RC_DW_Dorotya_WaitingFor(_Player);

IF
DialogEnded("RC_DW_UnderTavern_Dorotya",_)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
ProcCharacterDisableAllCrimes(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
ProcCharacterEnableCrime(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"Assault");
ObjectSetFlag(_Player,"QuestAdd_RC_DW_SpidersKiss");
ObjectSetFlag(_Player,"QuestUpdate_RC_DW_SpidersKiss_Start");
ObjectClearFlag(_Player,"RC_DW_UT_Dorotya_Stoodup",0);
ProcRemoveAllDialogEntriesForSpeaker(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
SetHasDialog(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,0);
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_KissSpot_fd0080f1-517b-4faf-beff-0e87b9616e2c,0,"Dorotya_AtKissSpot");
SetVarInteger(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"AtBar",0);

IF
StoryEvent(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"Dorotya_AtKissSpot")
THEN
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_RC_DW_UT_Dorotya_KissArea_362d76d9-fc04-447f-ae54-8826216e9ad3);
CharacterLookFromTrigger(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_KissSpot_fd0080f1-517b-4faf-beff-0e87b9616e2c,0);
DB_Dialogs(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"RC_DW_UnderTavern_Dorotya_Kiss");
TimerLaunch("Dorotya_AtKissSpot_Timeout",60000);
//END_REGION

//REGION Combat Ended - Return to normal
IF
ObjectLeftCombat(_Dorotya,_)
AND
DB_RC_DW_DorotyaForm(_Dorotya)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
NOT DB_RC_DW_Dorotya_WaitingFor(_Player);
ObjectClearFlag(_Player,"RC_DW_UT_Dorotya_WaitingForMe",0);
ObjectSetFlag(_Player,"RC_DW_UT_Dorotya_Stoodup",0);

IF
ObjectLeftCombat(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,_)
AND
CharacterIsDead(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,0)
THEN
Poof(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
TeleportTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
Foop(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
MoveAllItemsTo(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);

IF
ObjectLeftCombat(_Dorotya,_)
AND
DB_RC_DW_DorotyaForm(_Dorotya)
AND
CharacterIsDead((CHARACTERGUID)_Dorotya,0)
THEN
ProcRemoveAllDialogEntriesForSpeaker(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
SetHasDialog(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,0);
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_BarSpot_4180d1e6-5de9-4aa7-b8d8-cfafc66247eb,0,"Dorotya_BackAtBar");
//END_REGION

//REGION Waiting For Kiss Timeout
IF
TimerFinished("Dorotya_AtKissSpot_Timeout")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
NOT DB_RC_DW_Dorotya_WaitingFor(_Player);
ObjectClearFlag(_Player,"RC_DW_UT_Dorotya_WaitingForMe",0);
ProcRemoveAllDialogEntriesForSpeaker(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
SetHasDialog(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,0);
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_BarSpot_4180d1e6-5de9-4aa7-b8d8-cfafc66247eb,0,"Dorotya_BackAtBar");
ObjectSetFlag(_Player,"RC_DW_UT_Dorotya_Stoodup",0);

IF
StoryEvent(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"Dorotya_BackAtBar")
THEN
ProcTriggerRegisterForPlayers(TRIGGERGUID_S_RC_DW_UT_Dorotya_KissArea_362d76d9-fc04-447f-ae54-8826216e9ad3);
CharacterLookFromTrigger(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_BarSpot_4180d1e6-5de9-4aa7-b8d8-cfafc66247eb,0);
DB_Dialogs(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"RC_DW_UnderTavern_Dorotya");
SetVarInteger(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,"AtBar",1);
ProcCharacterEnableAllCrimes(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);


IF
DialogStarted("RC_DW_UnderTavern_Dorotya_Kiss",_Inst)
AND
DB_DialogPlayers(_Inst,_Player,1)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
TimerCancel("Dorotya_AtKissSpot_Timeout");

IF
DialogEnded("RC_DW_UnderTavern_Dorotya_Kiss",_)
AND
NOT DB_GlobalFlag("RC_DW_UT_Dorotya_Kisses")
THEN
TimerLaunch("Dorotya_AtKissSpot_Timeout",60000);
//END_REGION

//REGION Kissing - Check if alone
PROC
PROC_GLOBAL_DialogStartRequested(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_Player)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
AND
DB_InRegion(_Player2,TRIGGERGUID_S_RC_DW_UT_Dorotya_KissArea_362d76d9-fc04-447f-ae54-8826216e9ad3)
AND
_Player != _Player2
THEN
DB_RC_DW_Dorotya_NotAlone(_Player);

PROC
PROC_GLOBAL_DialogStartRequested(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_Player)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
AND
NOT DB_RC_DW_Dorotya_NotAlone(_Player)
THEN
ObjectSetFlag(_Player,"RC_DW_UT_Dorotya_CameAlone",0);

PROC
PROC_GLOBAL_DialogStartRequested(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_Player)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
AND
DB_RC_DW_Dorotya_NotAlone(_Player)
THEN
ObjectClearFlag(_Player,"RC_DW_UT_Dorotya_CameAlone",0);
NOT DB_RC_DW_Dorotya_NotAlone(_Player);
//END_REGION

//REGION Morphing to Spider and fake attacking
IF
GlobalFlagSet("RC_DW_UT_Dorotya_Turn")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
Poof(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
TeleportTo(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
CharacterLookAt(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,(CHARACTERGUID)_Player);
Foop(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,_Player,0,"");
GlobalClearFlag("RC_DW_UT_Dorotya_Turn");
MoveAllItemsTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);

IF
GlobalFlagSet("RC_DW_UT_Dorotya_Turn")
AND
DB_DialogNPCs(_Inst,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,1)
THEN
DialogAddActorAt(_Inst,CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,2);

IF
GlobalFlagSet("RC_DW_UT_Dorotya_Kisses")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
CharacterLookAt(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,(CHARACTERGUID)_Player);
PlayAnimation(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,"Bite","Spidrotya_AttackDone");
TimerLaunch("SpidrotyaKnocksPlayerDown",500);
ObjectSetFlag(_Player,"QuestUpdate_RC_DW_SpidersKiss_Completed");
ObjectSetFlag(_Player,"QuestClose_RC_DW_SpidersKiss");

IF
TimerFinished("SpidrotyaKnocksPlayerDown")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
SetStoryEvent(_Player,"GEN_FallAndGetUp");

IF
StoryEvent(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,"Spidrotya_AttackDone")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
Poof(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
TeleportTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
CharacterLookAt(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,(CHARACTERGUID)_Player);
Foop(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
MoveAllItemsTo(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);

IF
ItemAddedToCharacter(_Item,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069)
AND
GetTemplate(_Item,"WPN_Lizards_Dagger_1H_A_2f7e5bf9-fd51-4747-8b20-9f1c9b5a2fd3")
THEN
CharacterEquipItem(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_Item);

IF
ItemTemplateAddedToCharacter(WPN_Dummy_For_Equipment_28e00823-2ba4-43bb-be10-e4d6d89e179f, _Item, CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa)
THEN
CharacterEquipItem(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,_Item);
//END_REGION

//REGION Rewards
IF
DialogEnded("RC_DW_UnderTavern_Dorotya_Kiss",_)
AND
DB_GlobalFlag("RC_DW_UT_Dorotya_Kisses")
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
GlobalClearFlag("RC_DW_UT_Dorotya_Kisses");
NOT DB_RC_DW_Dorotya_WaitingFor(_Player);
ObjectClearFlag(_Player,"RC_DW_UT_Dorotya_WaitingForMe",0);
ProcRemoveAllDialogEntriesForSpeaker(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
SetHasDialog(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,0);
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,TRIGGERGUID_S_RC_DW_UT_Dorotya_BarSpot_4180d1e6-5de9-4aa7-b8d8-cfafc66247eb,0,"Dorotya_BackAtBar");
OpenMessageBox((CHARACTERGUID)_Player,"RC_DW_Dorotya_TalentReceived");

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_Strength",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Str");

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_Knowledge",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Int");

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_Power",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Per");

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_EndlessLife",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Null");
ItemTemplateAddTo("Quest_Resurrection_Idol_6b70e6e1-855e-4295-b79b-d87ebd6bd4af",_Player,1);

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_Money",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Null");
CharacterAddGold((CHARACTERGUID)_Player,2000);

IF
ObjectFlagSet("RC_DW_UT_Dorotya_Quiz_ReceiveReward",_Player,_)
AND
ObjectGetFlag(_Player,"RC_DW_UT_Dorotya_Quiz_Outcome_Love",1)
THEN
CharacterAddTalent((CHARACTERGUID)_Player,"Quest_SpidersKiss_Null");
Proc_Dorotya_BoostRelationships(_Player);

PROC
Proc_Dorotya_BoostRelationships((CHARACTERGUID)_Player)
AND
DB_CompanionAvatarBond(_Companion,_Player)
AND
CharacterGetAttitudeTowardsPlayer(_Companion,_Player,_CurrentAttitude)
AND
IntegerSum(_CurrentAttitude,40,_NewAttitude)
THEN
DB_SetCompanionAttitude(_Companion,_Player,_NewAttitude);
//END_REGION

//REGION Combat
IF
ObjectEnteredCombat(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_)
AND
DB_RC_DW_Dorotya_WaitingFor(_Player)
THEN
TimerCancel("Dorotya_AtKissSpot_Timeout");

IF
CharacterReceivedDamage(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069, _, _)
AND
CharacterGetHitpointsPercentage(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,_Percentage)
AND
_Percentage < 50.0
AND
CharacterIsDead(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,0)
THEN
Poof(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
TeleportTo(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069);
Foop(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);
SetFaction(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa,"Evil NPC");
MoveAllItemsTo(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069,CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa);

IF
CharacterDied(CHARACTERGUID_S_RC_DW_UnderTavern_Dorotya_6fa62a51-5ac2-4b51-b3a8-0d7bf8e4b069)
THEN
GlobalSetFlag("RC_DW_UT_DorotyaDied");

IF
CharacterDied(CHARACTERGUID_S_RC_DW_Dorotya_UnderTavern_Spiderform_878d311d-a68d-4965-afe3-621a9430a6fa)
THEN
GlobalSetFlag("RC_DW_UT_DorotyaDied");
//END_REGION

IF
ObjectFlagSet("RC_DW_UnderTavern_Dorotya_Kiss_Kissed",_,_)
THEN
GlobalSetFlag("RC_DW_DorotyaKissed");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
