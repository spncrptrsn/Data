Version 1
SubGoalCombiner SGC_AND
INITSECTION
//	Salt mines are a part of GrandMaster Situation it is mainly a Combat Area 
//	http://fileserver-dmz/mediawiki/index.php/Grandmasters_Arrest
/*
//Dialogs
SetHasDialog(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,1);
SetHasDialog(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,1);
DB_Dialogs(S_RC_DW_Saltmine_Magister_Grunt01_1a5734da-f98c-43c6-97c3-abce814529e8,"RC_DW_Saltmines_MagisterGhost01");
DB_Dialogs(S_RC_DW_Saltmine_Dwarf_Ghost_62dafa28-5660-4fff-8af2-b1b915b2c294,"RC_DW_Saltmines_DwarfGhost");

//Triggers
ProcTriggerRegisterForPlayers(S_RC_DW_Saltmine_IntroTrigger01_46ea2d37-4535-4a53-afc3-d45b1597988f); // VB on entrence 
ProcTriggerRegisterForPlayers(S_RC_DW_Saltmine_IntroTrigger02_21562a63-9e16-4297-b8e7-9e0b0f61d5b3); // VB on entrence
ProcTriggerRegisterForPlayers(RC_DW_Saltmine_SaltConveyer_Trigger_a066bea0-5f80-4537-89c2-9db587679796); // Gold Satter on the Salt Conveyer

//Items
ItemToInventory(RC_DW_SaltMines_DwarfChestKey_94b7fd39-d578-4133-8581-e4fb16dae003,RC_DW_SaltMine_DwarfCorpse_7cb35265-05c0-41ef-b943-2bdb515e0317); //Key in the the Saltmines

//Piles
DB_ShovelArea(RC_DW_SandPile_PointTrigger_62ffd671-517b-4eb2-97e8-260430c1af63,"RC_DW_SaltMineSandPile",RC_DW_SaltMine_SandPlie_403695df-7c87-4203-bb75-813a5d98f9d5);
DB_ShovelRewardItemAppear("RC_DW_SaltMineSandPile",RC_DW_SaltMineTravlerBackpack_feb4d38b-f1fb-4f4a-a95e-f78def580355,RC_DW_SandPile_PointTrigger_62ffd671-517b-4eb2-97e8-260430c1af63);

DB_ShovelArea(RC_DW_Saltmine_SandPile2_PointTrigger_1f89d46a-2471-43a4-bd07-abc27ab5bad4,"RC_DW_SaltMineSandPile2",RC_DW_Saltmine_SandPile2_00da578f-a828-4bdd-bef5-5b868460ff23);
DB_ShovelRewardItemAppear("RC_DW_SaltMineSandPile2",RC_DW_Saltmine_WorkerCorpse_b36cfb3b-8798-46ec-a0b8-1166fcdfce8f,RC_DW_Saltmine_SandPile2_PointTrigger_1f89d46a-2471-43a4-bd07-abc27ab5bad4);

//TODO: Remove this Hacky Chest and replace wiht Proper  Scatter Item at 
ItemToInventory(RC_DW_SaltMine_Ruby_ccc11c26-8a77-43ab-bb1c-026963d564a4,RC_DW_SaltMine_HackDwarfDropItem1_de9ffafa-b6ef-4074-867f-c7613831405a);
SetOnStage(RC_DW_SaltMine_HackDwarfDropItem_de9ffafa-b6ef-4074-867f-c7613831405a,0);
//TODO: Remove this Hacky Chest and replace wiht Proper  Scatter Item at 
ItemToInventory(RC_DW_SaltMine_Diamond_9bc67806-ba31-4113-88af-467385fa628a,RC_DW_SaltMine_HackDwarfDropItem2_1b4a2794-f4ab-4084-870f-4435ce1fa6e6);
SetOnStage(RC_DW_SaltMine_HackDwarfDropItem2_1b4a2794-f4ab-4084-870f-4435ce1fa6e6,0);

//Water Mashrooms DB
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom1_c9263cc7-52e5-4f70-87f6-b964f40869a7,RC_DW_WaterMashroom1Trigger_510ae7d9-4b68-44d5-abe8-a2ddcf8f3a93);
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom2_41f4dc28-6610-44a9-9687-1f98bd7359d0,RC_DW_WaterMashroom2Trigger_ee45b398-4862-451b-826d-0d3560646250);
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom3_9ab57439-a946-4a2f-8568-8c0a57962b1b,RC_DW_WaterMashroom3Trigger_f45cda83-0caf-42df-aea3-659a71578327);
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom4_adfe4da4-6180-4fcd-9719-a72b7c6bc118,RC_DW_WaterMashroom4Trigger_e751ed9e-fd6c-4d15-9cbe-9b0becdd5d3d);
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom5_1198c4be-a5e2-4a50-bb90-17e83121956c,RC_DW_WaterMashroom5Trigger_468a1363-fa76-4412-86a4-a2f6ead1d20a);
DB_RC_DW_WaterMashrooms(RC_DW_WaterMashroom6_c79926a9-13aa-409d-aa9b-8cdca96230db,RC_DW_WaterMashroom6Trigger_9e92fcc0-77df-4cd0-8f90-fb2643fab4f3);
*/
KBSECTION
/*
//REGION Fight on the way to the salt mines - WaterMashrooms
IF
DB_RC_DW_WaterMashrooms(_Mashroom,_Trigger)
THEN
ProcTriggerRegisterForPlayers((TRIGGERGUID)_Trigger);

IF
CharacterEnteredTrigger(_Char,_Trigger)
AND
DB_RC_DW_WaterMashrooms(_Mashroom,_Trigger)
THEN
PlayAnimation(_Mashroom,"attack1");
CreatePuddle(_Mashroom,"SurfaceWater", 1, 10,4,9,2.0);
//CreateSurface(_Mashroom,"SurfaceWaterFrozen",20.0,200.0); 
//END_REGION

//REGION SaltMine Entrence
IF // Entrence VoiceBark
CharacterEnteredTrigger(_Char,S_RC_DW_Saltmine_IntroTrigger01_46ea2d37-4535-4a53-afc3-d45b1597988f)
THEN
Proc_RC_DW_Saltmines_Entrece(_Char);

IF // Entrence VoiceBark
CharacterEnteredTrigger(_Char,S_RC_DW_Saltmine_IntroTrigger02_21562a63-9e16-4297-b8e7-9e0b0f61d5b3)
THEN
Proc_RC_DW_Saltmines_Entrece(_Char);

PROC
Proc_RC_DW_Saltmines_Entrece((CHARACTERGUID)_Char)
THEN
StartVoiceBark("RC_DW_VB_SaltMine_Entrence",_Char);
ProcTriggerUnregisterForPlayers(S_RC_DW_Saltmine_IntroTrigger01_46ea2d37-4535-4a53-afc3-d45b1597988f);
ProcTriggerUnregisterForPlayers(S_RC_DW_Saltmine_IntroTrigger02_21562a63-9e16-4297-b8e7-9e0b0f61d5b3);
//END_REGION

//REGION Filler Ghosts
IF
ObjectFlagSet("GLO_Ghost_Visible",S_RC_DW_Saltmine_Magister_Grunt01_1a5734da-f98c-43c6-97c3-abce814529e8,_) //First Magister Ghost
THEN
Proc_StartDialog(1,"RC_DW_AD_SaltMines_GhostMagister01",S_RC_DW_Saltmine_Magister_Grunt01_1a5734da-f98c-43c6-97c3-abce814529e8);

IF
ObjectFlagSet("GLO_Ghost_Visible",S_RC_DW_Saltmine_Dwarf_Ghost_62dafa28-5660-4fff-8af2-b1b915b2c294,_) //First Magister Ghost
AND
DB_OnlyOnce("RC_DW_AD_Saltmines_DwarfGhostOnlyOnce")
THEN
Proc_StartDialog(1,"RC_DW_AD_SaltMines_DwarfGhost",S_RC_DW_Saltmine_Dwarf_Ghost_62dafa28-5660-4fff-8af2-b1b915b2c294);
//END_REGION

//REGION Arguing Ghosts
IF
ObjectFlagSet("GLO_Ghost_Visible",S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,_)
AND
QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac)
AND
QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca)
THEN
Proc_StartDialog(1,"RC_DW_AD_SaltMinesGhostArgue",S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca);

//REGION Agruing Ghosts alive checks
//Magister Check
PROC
PROC_GLOBAL_DialogStartRequested(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,_Player)
AND
NOT QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac)
THEN
ObjectClearFlag(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,"RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable",0);
Proc_StartDialog(0,"RC_DW_Saltmines_MagisterGhost02",S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,_Player);

PROC
PROC_GLOBAL_DialogStartRequested(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,_Player)
AND
QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac)
THEN
ObjectSetFlag(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,"RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable");
//GlobalSetFlag("RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable");
Proc_StartDialog(0,"RC_DW_Saltmines_MagisterGhost02",S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,_Player,S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac);
DebugText(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,"This is now a 3 way Dialog");

//Paladin Check
PROC
PROC_GLOBAL_DialogStartRequested(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,_Player)
AND
NOT QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca)
THEN
ObjectClearFlag(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,"RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable",0);
Proc_StartDialog(0,"RC_DW_Saltmines_PaladinGhost",S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,_Player);

PROC
PROC_GLOBAL_DialogStartRequested(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,_Player)
AND
QRY_SpeakerIsAvailable(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca)
THEN
ObjectSetFlag(S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,"RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable");
//GlobalSetFlag("RC_DW_Saltmines_ArguingGhosts_OppositePartnerAvailable");
Proc_StartDialog(0,"RC_DW_Saltmines_PaladinGhost",S_RC_DW_Saltmine_GhostPaladin_ce43b54d-509f-43fb-952f-aa6f82e923ac,_Player,S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca);
DebugText(S_RC_DW_Saltmine_GhostMagister_4548e17c-ae39-42ee-a23e-62baf23317ca,"This is now a 3 way Dialog");
//END_REGION
//END_REGION

//REGION Hidden Chest 
IF
ItemAddedToCharacter(RC_DW_SaltMines_DwarfChestKey_94b7fd39-d578-4133-8581-e4fb16dae003,_Char)
THEN
ObjectSetFlag(_Char,"RC_DW_SaltMine_TookDwarfKeyFromCorpse");

IF
ItemAddedToCharacter(RC_DW_SaltMines_DwarfChestKey_94b7fd39-d578-4133-8581-e4fb16dae003,_Char)
AND
ObjectGetFlag(S_RC_DW_Saltmine_Dwarf_Ghost_62dafa28-5660-4fff-8af2-b1b915b2c294,"GLO_Ghost_Visible",1)
THEN
Proc_StartDialog(1,"RC_DW_AD_SaltMines_DwarfGhost",S_RC_DW_Saltmine_Dwarf_Ghost_62dafa28-5660-4fff-8af2-b1b915b2c294,_Char);
//END_REGION

//REGION  Ghost Ambush

IF
ObjectFlagSet("GLO_Ghost_Visible",RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228,_) //Ghost Lure
AND
GlobalGetFlag("RC_DW_SaltMine_GhostAmbush_Start",0)
THEN
ProcTriggerRegisterForPlayers(RC_DW_SaltMine_GhostAmbush_14b70486-359d-436d-8194-3ea36024755d); // Ghost that lures you to ambush 
DebugText(RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228,"I am Visible");
Proc_StartDialog(1,"RC_DW_AD_SaltMine_GhostAmbushLure",RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228);

IF
ObjectFlagCleared("GLO_Ghost_Visible",RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228,_) //Ghost Lure
AND
GlobalGetFlag("RC_DW_SaltMine_GhostAmbush_Start",0)
THEN
ProcTriggerUnregisterForPlayers(RC_DW_SaltMine_GhostAmbush_14b70486-359d-436d-8194-3ea36024755d); // Ghost that lures you to ambush 

IF
CharacterEnteredTrigger(_Char,RC_DW_SaltMine_GhostAmbush_14b70486-359d-436d-8194-3ea36024755d)
AND
DB_IsPlayer(_Char)
THEN
GlobalSetFlag("RC_DW_SaltMine_GhostAmbush_Start");
Proc_StartDialog(1,"RC_DW_AD_SaltMine_GhostAmbushLure",RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228);
ProcTriggerUnregisterForPlayers(RC_DW_SaltMine_GhostAmbush_14b70486-359d-436d-8194-3ea36024755d); // Ghost that lures you to ambush 

IF
AutomatedDialogEnded("RC_DW_AD_SaltMine_GhostAmbushLure",_)
AND
GlobalGetFlag("RC_DW_SaltMine_GhostAmbush_Start",1)
THEN
Proc_GhostHacks_GhostPoof(RC_DW_Ghost_LureToAmbush_8e84b974-4ffc-4aec-b834-74363e41f228);
//END_REGION

//REGION  Salt Convoyer
IF
CharacterEnteredTrigger(_Char,RC_DW_Saltmine_SaltConveyer_Trigger_a066bea0-5f80-4537-89c2-9db587679796)
AND
DB_IsPlayer(_Char)
THEN
ItemDrop(RC_DW_SaltMine_Ruby_ccc11c26-8a77-43ab-bb1c-026963d564a4);
ItemClearOwner(RC_DW_SaltMine_Ruby_ccc11c26-8a77-43ab-bb1c-026963d564a4);
//ScatterAtTrigger(RC_DW_SaltMine_ScatterGoldSaltConveyer_7db2d3f6-03d7-452b-85a5-b312c5084a91,"I will drop Gold"); //TODO: DANI: Add the Scatter Gold when I get the call
ProcTriggerUnregisterForPlayers(RC_DW_Saltmine_SaltConveyer_Trigger_a066bea0-5f80-4537-89c2-9db587679796); 

IF
CharacterUsedItem(_Char,MINE_Salt_Funnel_A_007_90e37f9a-bcde-424c-9c3e-efe9ebaf0801)
AND
QueryOnlyOnce("RC_DW_Saltmine_DropJewelFromSaltOnce")
THEN
ItemDrop(RC_DW_SaltMine_Diamond_9bc67806-ba31-4113-88af-467385fa628a);
ItemClearOwner(RC_DW_SaltMine_Diamond_9bc67806-ba31-4113-88af-467385fa628a);
//END_REGION
*/
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
