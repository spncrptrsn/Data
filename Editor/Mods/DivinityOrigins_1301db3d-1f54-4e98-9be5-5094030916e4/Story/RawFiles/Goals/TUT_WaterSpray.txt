Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_TutorialSprayHelper((ITEMGUID)ITEMGUID_S_TUT_SplashHelper_Bottom_Front_Left_ea674494-3701-43f9-b0a4-ee6f7b92a4ea, "Bottom", "Front", "Left", 0);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_Front_1_e1b8a5f0-c610-4799-b437-dc3f20abca39 , "Bottom", "Front", "Left", 1);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_1_eb0bae13-2093-4ef1-b408-b61b2e0b9121, "Bottom", "Side", "Left", 1);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_2_b252ee1f-bb67-4737-a2f2-7312f89c6fb1, "Bottom", "Side", "Left", 2);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_3_4be9ec49-ade3-4358-b47c-2671f7965156, "Bottom", "Side", "Left", 3);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_4_4231ba46-f242-4bd5-87f5-03c146e3b872, "Bottom", "Side", "Left", 4);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_5_98d07cc6-e8a8-4f9a-96c5-f35c0854e93b, "Bottom", "Side", "Left", 5);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_6_0889d94b-6ff8-4820-8c42-97379d017be5, "Bottom", "Side", "Left", 6);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_7_952601b8-2ab8-4281-9ba4-1dab897a2472, "Bottom", "Side", "Left", 7);

DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_Front_5aa87f82-6644-4a11-a739-a3eb53c54e7b, "Bottom", "Front", "Right", 0);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_1_f1aaf58c-1cc5-44d8-ae0b-9995a32a77ba, "Bottom", "Side", "Right", 1);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_2_116c58ff-7eb6-4095-b8f8-2c3c41caa2e5, "Bottom", "Side", "Right", 2);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_3_59a4e7ca-48d2-40fa-a234-f11ad41cc6e5, "Bottom", "Side", "Right", 3);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_4_2b94f6c1-67e1-495a-9252-7b3cec9c4acb, "Bottom", "Side", "Right", 4);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_5_6ca96e6b-0a84-4b50-920d-38d58341044b, "Bottom", "Side", "Right", 5);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_6_413b0f20-70d0-4f1d-a265-6db54c0ce6bd, "Bottom", "Side", "Right", 6);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_7_b1081260-7436-4b8d-b9f4-72e016f19aa3, "Bottom", "Side", "Right", 7);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_8_6771010a-1ac6-47d9-aa07-1a7f2db1a673, "Bottom", "Side", "Right", 8);

DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_1_f68c1be8-46b5-46a3-ae6e-64c3d9fcd0ab, "Middle", "Side", "Left", 1);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_2_f6b97876-3542-4ad9-8670-563cdef209f8, "Middle", "Side", "Left", 2);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_3_e54764e0-0f06-4406-b1a7-bc315803c36a, "Middle", "Side", "Left", 3);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_4_199b95f8-58ad-4c59-9ce1-742f1ca162e2, "Middle", "Side", "Left", 4);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_5_c42d7bef-4c63-4ae5-a9ff-903c49e149bc, "Middle", "Side", "Left", 5);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_6_e42eb3cd-d227-486b-8fd7-50f1509841ce, "Middle", "Side", "Left", 6);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_7_60c848a8-11ea-408a-87fc-f320d8cfa4b4, "Middle", "Side", "Left", 8);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Left_8_d351cdd4-fc41-4339-bc19-98c3307c9507, "Middle", "Side", "Left", 9);

DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_1_8bdd91b1-9c81-432f-8282-e1eca8e0d9bd, "Middle", "Side", "Right", 1);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_2_4557d940-2d19-4297-a554-5d29125d9112, "Middle", "Side", "Right", 2);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_3_fdb4fce3-4a92-4abc-baa5-da6a61c19fc0, "Middle", "Side", "Right", 3);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_4_7733caf7-0a00-446e-b84e-399ac864f154, "Middle", "Side", "Right", 4);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_5_2f467213-62f2-40de-b437-58e0011c1c0b, "Middle", "Side", "Right", 5);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_6_ded99fdd-fc7f-4586-89a3-bfe1e58fecd7, "Middle", "Side", "Right", 6);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_7_cc3e50aa-1c59-4209-b11a-b6bdf8f3a3fb, "Middle", "Side", "Right", 7);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_8_4711ea71-2b18-43eb-86b3-247c0c0a749c, "Middle", "Side", "Right", 8);
DB_TutorialSprayHelper(ITEMGUID_S_TUT_SplashHelper_Middle_Right_9_355668c5-129f-43ee-9fce-c549b7dcbb1c, "Middle", "Side", "Right", 9);

DB_TUT_Splashes_Wave_Timer("Bottom", "Right", "TUT_Splashes_FrontalWave_Bottom_Right", 1);
DB_TUT_Splashes_Wave_Timer("Bottom", "Left", "TUT_Splashes_FrontalWave_Bottom_Left", 1);
DB_TUT_Splashes_Wave_Timer("Middle", "Right", "TUT_Splashes_FrontalWave_Middle_Right", 1);
DB_TUT_Splashes_Wave_Timer("Middle", "Left", "TUT_Splashes_FrontalWave_Middle_Left", 1);
DB_TUT_Splashes_Wave_Timer("Bottom", "Right", "TUT_Splashes_SideWave_Bottom_Right", 0);
DB_TUT_Splashes_Wave_Timer("Bottom", "Left", "TUT_Splashes_SideWave_Bottom_Left", 0);
DB_TUT_Splashes_Wave_Timer("Middle", "Right", "TUT_Splashes_SideWave_Middle_Right", 0);
DB_TUT_Splashes_Wave_Timer("Middle", "Left", "TUT_Splashes_SideWave_Middle_Left", 0);

DB_TUT_Splashes_TotalLength("Bottom", 8);
DB_TUT_Splashes_TotalLength("Middle", 10);

/*DB_TUT_Splashes_Triggers((TRIGGERGUID)TRIGGERGUID_S_TUT_Splashes_Box_Bottom_008bc620-5067-46bf-8634-932444a86d50, "TUT_Splashes_Tick_Bottom", "Bottom");
DB_TUT_Splashes_Triggers(TRIGGERGUID_S_TUT_Splashes_Box_Middle_da62f999-9547-4763-bf4a-1b862c870d59, "TUT_Splashes_Tick_Middle", "Middle");*/
KBSECTION
/*IF
TextEventSet("TestLeftWave")
THEN
PROC_TUT_Splashes_Wave("Bottom", "Left");

IF
TextEventSet("TestFrontalWave")
THEN
PROC_TUT_Splashes_FrontalWave("Bottom");

IF
TextEventSet("TestSideWave")
AND
DB_TUT_Splashes_TotalLength("Bottom", _Length)
AND
Random(_Length, _Index)
THEN
PROC_TUT_Splashes_SideWave("Bottom", "Left", _Index);*/
IF
DB_TutorialSprayHelper(_Helper, "Middle", _, _, _)
THEN
SetVarFloat(_Helper, "Range", 5.0);


//REGION Setup
IF
DB_TUT_Splashes_Triggers(_Trigger, _, _)
THEN
ProcTriggerRegisterForPlayers(_Trigger);

IF
CharacterEnteredTrigger(_Character, _Trigger)
AND
DB_TUT_Splashes_Triggers(_Trigger, _Timer, _)
AND
QueryOnlyOnce(_Timer)
THEN
TimerLaunch(_Timer, 2000);
//END_REGION

//REGION Global tick
IF
TimerFinished(_Timer)
AND
DB_TUT_Splashes_Triggers(_Trigger, _Timer, _Deck)
AND
DB_InRegion(_, _Trigger)
AND
Random(2000, _RandomOffset)
AND
IntegerSum(6000, _RandomOffset, _TimerLength)
AND
Random(2, _Mode)
THEN
TimerLaunch(_Timer, _TimerLength);
PROC_TUT_Splashes_Wave(_Mode, _Deck);

IF
TimerFinished(_Timer)
AND
DB_TUT_Splashes_Triggers(_Trigger, _Timer, _)
AND
NOT DB_InRegion(_, _Trigger)
THEN
NOT DB_OnlyOnce(_Timer);

PROC
PROC_TUT_Splashes_Wave((INTEGER)_Index, (STRING)_Deck)
AND
DB_TUT_Splashes_Wave_Timer(_Deck, "Right", _RightTimer, _Index)
AND
DB_TUT_Splashes_Wave_Timer(_Deck, "Left", _LeftTimer, _Index)
AND
Random(1500, _RightLength)
AND
Random(1500, _LeftLength)
THEN
TimerLaunch(_RightTimer, _RightLength);
TimerLaunch(_LeftTimer, _LeftLength);

PROC
PROC_TUT_Splashes_Wave((INTEGER)_Index,  "Bottom")
AND
Random(2, 0)
AND
Random(500, _Length)
THEN
ProcObjectTimer(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_Front_ea674494-3701-43f9-b0a4-ee6f7b92a4ea, "TUT_Splashes_DoSplash", _Length);

PROC
PROC_TUT_Splashes_Wave((INTEGER)_Index,  "Bottom")
AND
Random(2, 0)
AND
Random(700, _Length)
THEN
ProcObjectTimer(ITEMGUID_S_TUT_SplashHelper_Bottom_Left_Front_1_e1b8a5f0-c610-4799-b437-dc3f20abca39, "TUT_Splashes_DoSplash", _Length);


PROC
PROC_TUT_Splashes_Wave((INTEGER)_Index,  "Bottom")
AND
Random(2, 0)
AND
Random(500, _Length)
THEN
ProcObjectTimer(ITEMGUID_S_TUT_SplashHelper_Bottom_Right_Front_5aa87f82-6644-4a11-a739-a3eb53c54e7b, "TUT_Splashes_DoSplash", _Length);

PROC
PROC_TUT_Splashes_Wave((INTEGER)_Index,  "Middle")
AND
DB_DestroyedItems(ITEMGUID_S_TUT_MiddleDeck_BreakingWall3_68777f9c-bd1c-4cf9-884e-5f0641b11ca4)
THEN
PlayEffect(ITEMGUID_S_TUT_SplashHelper_Middle_Middle_81da13a8-98e5-47fa-b47d-2398bccbbe20, "RS3_FX_Environment_Water_Splash_TutorialShip_TentacleAttackFront_01");

//END_REGION

//REGION Waves running along ship
IF
TimerFinished(_Timer)
AND
DB_TUT_Splashes_Wave_Timer(_Deck, _Side, _Timer, 1)
THEN
PROC_TUT_Splashes_LengthWave(_Deck, _Side);

IF
TimerFinished(_Timer)
AND
DB_TUT_Splashes_Wave_Timer(_Deck, _Side, _Timer, 1)
AND
DB_TutorialSprayHelper(_Helper, _Deck, "Side", _Side, 1)
THEN
PlaySound(_Helper, "SE_TutoLevel_InteriorWaveCrash_Big");

PROC
PROC_TUT_Splashes_LengthWave((STRING)_Deck, (STRING)_Side)
AND
DB_TutorialSprayHelper(_Helper, _Deck, "Side", _Side, _Index)
AND
IntegerProduct(_Index, 200, _IndexOffset)
AND
IntegerSum(_IndexOffset, 2000, _Timer)
AND
Random(50, _RandomOffset)
AND
IntegerSum(_Timer, _RandomOffset, _FinalTimer)
THEN
ProcObjectTimer(_Helper, "TUT_Splashes_DoSplash", _FinalTimer);

//END_REGION

//REGION Waves hitting side of boat
IF
TimerFinished(_Timer)
AND
DB_TUT_Splashes_Wave_Timer(_Deck, _Side, _Timer, 0)
AND
DB_TUT_Splashes_TotalLength(_Deck, _Length)
AND
Random(_Length, _Index)
THEN
PROC_TUT_Splashes_SideWave(_Deck, _Side, _Index);

PROC
PROC_TUT_Splashes_SideWave((STRING)_Deck, (STRING)_Side, (INTEGER)_Index)
AND
IntegerSubtract(_Index, 1, _NewIndex)
AND
DB_TutorialSprayHelper(_Helper, _Deck, "Side", _Side, _NewIndex)
AND
Random(50, _RandomOffset)
AND
IntegerSum(2000, _RandomOffset, _Timer)
THEN
ProcObjectTimer(_Helper, "TUT_Splashes_DoSplash", _Timer);
PlaySound(_Helper, "SE_TutoLevel_InteriorWaveCrash_Small");

PROC
PROC_TUT_Splashes_SideWave(_Deck, _Side, _Index)
AND
IntegerSum(_Index, 1, _NewIndex)
AND
DB_TutorialSprayHelper(_Helper, _Deck, "Side", _Side, _NewIndex)
AND
Random(50, _RandomOffset)
AND
IntegerSum(3300, _RandomOffset, _Timer)
THEN
ProcObjectTimer(_Helper, "TUT_Splashes_DoSplash_Tiny", _Timer);

PROC
PROC_TUT_Splashes_SideWave(_Deck, _Side, _Index)
AND
DB_TutorialSprayHelper(_Helper, _Deck, "Side", _Side, _Index)
AND
Random(50, _RandomOffset)
AND
IntegerSum(2500, _RandomOffset, _Timer)
THEN
ProcObjectTimer(_Helper, "TUT_Splashes_DoSplash_Tiny", _Timer);

//END_REGION


//REGION Actual spawning of effects
PROC
ProcObjectTimerFinished(_Helper, "TUT_Splashes_DoSplash")
AND
NOT QRY_TUT_HelpersWallIsBroken(_Helper)
THEN
PlayEffect(_Helper, "RS3_FX_Environment_Water_Splash_Direction_Small_01");
SetStoryEvent(_Helper, "ApplyStatusInRange");
ProcObjectTimer(_Helper, "TUT_Splashes_MakeSurface", 1000);

QRY
QRY_TUT_HelpersWallIsBroken((ITEMGUID)_Helper)
AND
DB_TUT_BreakingWalls_Windows((ITEMGUID)_Wall, _Helper)
AND
DB_DestroyedItems(_Wall)
THEN
PlayEffect(_Helper, "RS3_FX_Environment_Water_Splash_Sea_02");
SetStoryEvent(_Helper, "ApplyStatusInRange");
ProcObjectTimer(_Helper, "TUT_Splashes_MakeSurface", 1000);

IF
DB_DestroyedItems(_Wall)
AND
DB_TUT_BreakingWalls_Windows((ITEMGUID)_Wall, (ITEMGUID)_Helper)
THEN
SetVarFloat(_Helper, "Range", 5.0);
SetVarInteger(_Helper, "Duration", 3);

PROC
ProcObjectTimerFinished(_Helper, "TUT_Splashes_MakeSurface")
AND
NOT GetSurfaceGroundAt(_Helper, "SurfaceWaterElectrified")
AND
NOT GetSurfaceGroundAt(_Helper, "SurfaceBloodElectrified")
AND
NOT GetSurfaceGroundAt(_Helper, "SurfaceWaterElectrifiedCursed")
AND
NOT GetSurfaceGroundAt(_Helper, "SurfaceBloodElectrifiedCursed")
THEN
CreateSurface(_Helper, "SurfaceWater", 2.0, 5.0);

PROC
ProcObjectTimerFinished(_Helper, "TUT_Splashes_DoSplash_Tiny")
THEN
PlayEffect(_Helper, "RS3_FX_Environment_Water_Splash_Direction_Tiny_01");

//END_REGION

PROC
ProcRegionEnded("TUT_Tutorial_A")
AND
DB_TutorialSprayHelper(_Helper, _Deck, _Position, _Side, _Index)
THEN
NOT DB_TutorialSprayHelper(_Helper, _Deck, _Position, _Side, _Index);

PROC
ProcRegionEnded("TUT_Tutorial_A")
THEN
GoalCompleted;
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Tutorial_PrisonShip"
