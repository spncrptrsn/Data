Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_000_00205480-514f-4c46-9d47-a85326d60e46,CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_001_32356b36-44ca-4fc2-81b9-dbe82729ad63,"RC_DF_RainbowLovers");

DB_RC_DF_RainbowLovers((CHARACTERGUID)CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_000_00205480-514f-4c46-9d47-a85326d60e46,"RC_DF_RainbowLover_000","RC_DF_RainbowLover_SuckedGhost_000");
DB_RC_DF_RainbowLovers((CHARACTERGUID)CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_001_32356b36-44ca-4fc2-81b9-dbe82729ad63,"RC_DF_RainbowLover_001","RC_DF_RainbowLover_SuckedGhost_001");

DB_Ghosts(CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_000_00205480-514f-4c46-9d47-a85326d60e46,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,"RC_DF_RainbowLover_Ghost_000");
DB_Ghosts(CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_001_32356b36-44ca-4fc2-81b9-dbe82729ad63,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,"RC_DF_RainbowLover_Ghost_001");

// Shovel area in Farmlands
DB_ShovelArea(TRIGGERGUID_S_RC_FL_RainbowLovers_ForestPile_Box_9e5743d1-163e-47d0-8258-5b70824ab200,"RC_FL_RainbowLovers_RewardChestPile",ITEMGUID_S_RC_FL_RainbowLovers_ForestPile_b1d78e4c-9498-4c02-a244-e4c10200a373);
DB_ShovelRewardItemAppear("RC_FL_RainbowLovers_RewardChestPile",ITEMGUID_S_RC_FL_RainbowLovers_Chest_2db254c1-9ea5-4507-86b0-2c9aa28b6f08,TRIGGERGUID_S_RC_FL_RainbowLovers_Chest_Point_fe818268-93ad-40e8-a14a-e6d41850beb8);
KBSECTION
IF
DB_Dead(_Char)
AND
DB_RC_DF_RainbowLovers(_Char,_Dialog,_)
AND
DB_RC_DF_RainbowLovers(_OtherChar,_OtherDialog,_)
AND
_OtherChar != _Char
AND
NOT DB_Dead(_OtherChar)
THEN
NOT DB_Dialogs(CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_000_00205480-514f-4c46-9d47-a85326d60e46,CHARACTERGUID_S_RC_DF_RainbowLovers_Lover_001_32356b36-44ca-4fc2-81b9-dbe82729ad63,"RC_DF_RainbowLovers");
PROC_RemoveDialogFromCharacter(_OtherChar);
ClearVarObject(_OtherChar,"BedUse");
ClearVarObject(_OtherChar,"talkTo_NPC");
SetVarString(_OtherChar,"talkTo_AD","");
SetVarInteger(_OtherChar,"CanWander",1);
SetVarInteger(_OtherChar,"allow_DoNothing",1);
RemoveStatus(_OtherChar,"LYING");
SetVarFixedString(_OtherChar,"AnimationStanding","Crying_01");
SetVarString(_OtherChar,"AD","RC_DF_AD_RainbowLover_Mourning");
DB_Dialogs(_OtherChar,_OtherDialog);
TriggerSetItemOwner(TRIGGERGUID_S_RC_DF_RainbowLover_Ownership_Box_f192c3b7-6b2a-4d64-b13c-e07e9c539ffd,_OtherChar);


IF
DB_Dead(_Char)
AND
DB_RC_DF_RainbowLovers(_Char,_Dialog,_)
AND
DB_RC_DF_RainbowLovers(_OtherChar,_OtherDialog,_OtherFlag)
AND
_OtherChar != _Char
AND
QRY_RC_DF_RainbowLovers_BothGhostAvailable()
AND
DB_Dead(_OtherChar)
AND
DB_Ghosts(_Char,_Ghost,_)
AND
DB_Ghosts(_OtherChar,_OtherGhost,_)
THEN
PROC_RemoveDialogFromCharacter(_Ghost);
PROC_RemoveDialogFromCharacter(_OtherGhost);
DB_Dialogs(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,"RC_DF_RainbowLoverGhosts");


QRY
QRY_RC_DF_RainbowLovers_BothGhostAvailable()
AND
NOT DB_GoneGhosts(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b)
AND
NOT DB_GoneGhosts(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6)
THEN
DB_NOOP(1);


IF
CharacterGhostDestroyed(_Char,_Ghost)
AND
DB_RC_DF_RainbowLovers(_Char,_,_SuckedFlag)
THEN
GlobalSetFlag(_SuckedFlag);
NOT DB_Dialogs(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,"RC_DF_RainbowLoverGhosts");

IF
CharacterGhostDestroyed(_AnyChar,_)
AND
DB_RC_DF_RainbowLovers(_AnyChar,_,_)
AND
DB_RC_DF_RainbowLovers(_Char,_,_)
AND
DB_Ghosts(_Char,_Ghost,_Dialog)
THEN
PROC_RemoveDialogFromCharacter(_Ghost);
DB_Dialogs(_Ghost,_Dialog);


/*
IF
CharacterGhostDestroyed(_Char,_Ghost)
AND
DB_RC_DF_RainbowLovers(_Char,_,_)
AND
DB_RC_DF_RainbowLovers(_OtherChar,_,_)
AND
_OtherChar != _Char
AND
DB_Ghosts(_OtherChar,_OtherGhost,_OtherDialog)
THEN
PROC_RemoveDialogFromCharacter(_OtherGhost);
NOT DB_Dialogs(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,"RC_DF_RainbowLoverGhosts");
DB_Dialogs(_OtherGhost,_OtherDialog);
*/


IF
DialogStarted("RC_DF_RainbowLoverGhosts",_)
AND
GetDistanceTo(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,_Dist)
AND
_Dist <= 12.0
AND
_Dist > 2.0
THEN
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,0,"");
ProcCharacterMoveTo(CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_001_b9fea77d-66f2-489c-aca0-c2d74b7208f6,CHARACTERGUID_S_RC_DF_RainbowLovers_LoverGhost_000_f437b0c9-b0aa-43bc-bc26-f69be4a5066b,0,"");



EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
