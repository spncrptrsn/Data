Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION DB_Dialogs

DB_Dialogs(RC_DW_Docks_Fisherman_02_03943f14-efc2-49aa-8ffd-03b95d3cfa4d,"RC_DW_Docks_Fisherman_02");

//Fish factory
DB_Dialogs(CHARACTERGUID_S_RC_DW_FishFactory_Worker_01_9f5cfac1-772c-4301-a4b8-0c214682259c,"RC_DW_FishFactory_Worker_01");

DB_Dialogs(RC_DW_FishFactory_Worker_04_864b0421-7c39-4861-8799-04c23d28466f,"RC_DW_FishFactory_Worker_04");

//TAVERN
DB_Dialogs(CHARACTERGUID_S_RC_DW_Tavern_Innkeeper_dcb4b072-d7b2-410f-884d-42553937382a,"RC_DW_Innkeeper");
DB_DeadEvent(CHARACTERGUID_S_RC_DW_Tavern_Innkeeper_dcb4b072-d7b2-410f-884d-42553937382a,"RC_DW_Innkeeper_IsDead");

DB_Dialogs(CHARACTERGUID_S_RC_DW_Tavern_ArenaFan_58f292b9-90d2-4e6b-918b-e172a6bc3c84,"RC_DW_Tavern_ArenaFan");
DB_DialogMoneyTransfer(1,"RC_DW_Tavern_ArenaFan",1);



//TAVERN 2nd Floor
DB_Dialogs(CHARACTERGUID_S_RC_DW_Tavern_ExMagister_2c1dba6f-dd37-4bd0-a249-d390338715cd,"RC_DW_Tavern_ExMagister");
DB_Dialogs(CHARACTERGUID_S_RC_DW_DT_Tavern_Traveler_ae3b396f-b064-48ac-b9e2-c3fcf720bd29,"RC_DW_Tavern_Traveler");
DB_DialogMoneyTransfer(1,"RC_DW_Tavern_Traveler",150); 
DB_Dialogs(CHARACTERGUID_S_GLO_MerchantRich_1e1cec76-eab1-4af3-b5f3-b9b18002b8f5,"RC_DW_Tavern_RichMerchant");
DB_Dialogs(CHARACTERGUID_S_RC_DW_Tavern_MerchantGuard_001_e66da9c3-201a-4bd6-8a4d-bd478cbedad1,"RC_DW_Tavern_RichMerchant_Guard1");
DB_Dialogs(CHARACTERGUID_S_RC_DW_Tavern_MerchantGuard_002_7c681b24-6ba9-4bae-977c-4a3f28d0a0c4,"RC_DW_Tavern_RichMerchant_Guard2");


//Marketplace
DB_Dialogs(CHARACTERGUID_S_RC_DW_TraderFish_81f4cd7e-0c93-4fcb-9aa6-23500e3d2c4d,"RC_DW_TraderFish");
DB_Dialogs(CHARACTERGUID_S_RC_DW_TraderSkill_b22c2335-d5b2-46ca-aaaf-2787c4dbc172,"RC_DW_TraderSkill");
DB_Dialogs(CHARACTERGUID_S_RC_DW_TraderGeneral_29ca04c1-430a-4ec4-a80d-c4c2af122d2c,"RC_DW_TraderGeneral");
DB_Dialogs(CHARACTERGUID_S_RC_DW_TraderHunter_88ea209d-d5e6-465d-bebe-2f10b1fd2861,"RC_DW_TraderHunter");
DB_Dialogs(CHARACTERGUID_S_RC_DW_CommonerDwarf_01_120558a6-9149-4e8b-80e2-24aad856d3c9,"RC_DW_CommonerDwarf_01");
DB_Dialogs(CHARACTERGUID_S_RC_DW_CommonerDwarf_02_08d6c522-8a1f-4ee7-b39b-a355314c0825,"RC_DW_CommonerDwarf_02");
DB_Dialogs(CHARACTERGUID_S_RC_DW_CommonerDwarf_03_6a2b0a63-5146-4217-8af7-91eaf48b0e7f,"RC_DW_CommonerDwarf_03");
DB_Dialogs(CHARACTERGUID_S_RC_DW_CommonerDwarf_04_84d75e92-e4dd-4e64-894a-f42721e34f0a,"RC_DW_CommonerDwarf_04");
DB_Dialogs(CHARACTERGUID_RC_DW_Patrol_Magister_002_7fcc2037-383c-4660-94ff-965adaaae0ff,"RC_DW_Patrol_Magister_002");

// Marketplace Shoppers
DB_Dialogs(CHARACTERGUID_S_RC_DW_Shopper1_a15846bc-303b-4673-85ab-a4308d1fe3f3, "RC_DW_Shopper1");
DB_Dialogs(CHARACTERGUID_S_RC_DW_Shopper2_c5cc6fc5-9a03-43d7-aef4-6b72e9bec9af, "RC_DW_Shopper2");

//DB_Dialogs(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,"RC_DW_Barracks_Magister_Officer");
SetHasDialog(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,1);
DB_Dialogs(CHARACTERGUID_RC_DW_Patrol_Magister_001_1643a994-6159-4132-b2ec-0307a35cf9bc,"RC_DW_Patrol_Magister_001");

DB_Dialogs(CHARACTERGUID_S_RC_DW_SilentWatcher_01_76b0a811-35f3-4c22-b31e-22f4b92ae0e1, "RC_DW_SilentWatcher_01");
DB_Dialogs(CHARACTERGUID_S_RC_DW_SilentWatcher_02_a2e1fd70-cd62-4b63-99f7-6290253b378d, "RC_DW_SilentWatcher_02");
DB_DoNotFace(CHARACTERGUID_S_RC_DW_SilentWatcher_01_76b0a811-35f3-4c22-b31e-22f4b92ae0e1);
DB_DoNotFace(CHARACTERGUID_S_RC_DW_SilentWatcher_02_a2e1fd70-cd62-4b63-99f7-6290253b378d);
//UnderTavern
DB_Dialogs(RC_DW_UnderTavern_Bartender_cb016e2c-2e96-4dd7-bf78-aa1fdefb5424,"RC_DW_UnderTavern_Bartender");
DB_Dialogs(RC_DW_UnderTavern_Conall_f1ce12ed-3a56-4a99-9a62-4932a8e2fbdb,"RC_DW_UnderTavern_Conall");
DB_Dialogs(RC_DW_UnderTavern_Grisha_004b4242-7fbd-4c64-9cb4-a2477b2bd026,"RC_DW_UnderTavern_Grisha");
DB_Dialogs(CHARACTERGUID_S_RC_DW_UnderTavern_LizardDreamer_8088cb3f-b975-48b5-997b-ff136a7d1651,"RC_DW_UnderTavern_LizardDreamer");
DB_Dialogs(CHARACTERGUID_S_RC_DW_UnderTavern_UndeadOblivion_ffc85d2b-fc78-4083-b794-6d2ea3aa7fe6,"RC_DW_UnderTavern_UndeadOblivion");

DB_Dialogs(CHARACTERGUID_S_RC_DW_Bull_02_f5ba689a-ba65-4c72-bd0a-4e58f08525ac,"RC_DW_Bull_02");
DB_Dialogs(CHARACTERGUID_S_RC_DW_Bull_01_22e8ac93-cd21-4e01-a968-94bfb727da7a,"RC_DW_Bull_01");

//END_REGION
//REGION TEMP OR TAG CHECKS



DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","DIPLOMATIC","TEMP_TAGS_DIPLOMATIC_RATIONAL");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","RATIONAL","TEMP_TAGS_DIPLOMATIC_RATIONAL");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","MANIPULATIVE","TEMP_TAGS_MANIPULATIVE_DRAMATIC");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","DRAMATIC","TEMP_TAGS_MANIPULATIVE_DRAMATIC");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","INTIMIDATING","TEMP_TAGS_INTIMIDATING_AGGRESSIVE");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Kemm","AGGRESSIVE","TEMP_TAGS_INTIMIDATING_AGGRESSIVE");


DB_TEMP_OrTagCheck_Dialog("RC_DW_Tavern_ExMagister","DIPLOMATIC","TEMP_TAGS_DIPLOMATIC_RATIONAL_WISE");
DB_TEMP_OrTagCheck_Dialog("RC_DW_Tavern_ExMagister","RATIONAL","TEMP_TAGS_DIPLOMATIC_RATIONAL_WISE");
DB_TEMP_OrTagCheck_Dialog("RC_DW_Tavern_ExMagister","WISE","TEMP_TAGS_DIPLOMATIC_RATIONAL_WISE");

DB_TEMP_OrTagCheck_Dialog("RC_DW_Tavern_Patron_01","AGGRESSIVE","TEMP_TAGS_AGGRESSIVE_OBNOXIOUS");
DB_TEMP_OrTagCheck_Dialog("RC_DW_Tavern_Patron_01","OBNOXIOUS","TEMP_TAGS_AGGRESSIVE_OBNOXIOUS");

DB_TEMP_OrTagCheck_Dialog("RC_DW_Innkeeper","ADVENTURER","TEMP_TAGS_ADVENTURER_OUTLAW");
DB_TEMP_OrTagCheck_Dialog("RC_DW_Innkeeper","OUTLAW","TEMP_TAGS_ADVENTURER_OUTLAW");

DB_TEMP_OrTagCheck_Dialog("RC_ARX_Gates_PaladinGuard_02","AGGRESSIVE","TEMP_TAGS_AGGRESSIVE_MANIACAL");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_Gates_PaladinGuard_02","MANIACAL","TEMP_TAGS_AGGRESSIVE_MANIACAL");

DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","OBNOXIOUS","TEMP_TAGS_OBNOXIOUS_JOKESTER");
DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","JOKESTER","TEMP_TAGS_OBNOXIOUS_JOKESTER");
DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","DIPLOMATIC","TEMP_TAGS_DIPLOMATIC_RATIONAL");
DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","RATIONAL","TEMP_TAGS_DIPLOMATIC_RATIONAL");
DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","AGGRESSIVE","TEMP_TAGS_AGGRESSIVE_MANIACAL");
DB_TEMP_OrTagCheck_Dialog("RC_DW_TraderHunter","MANIACAL","TEMP_TAGS_AGGRESSIVE_MANIACAL");


DB_TEMP_OrTagCheck_Dialog("RC_ARX_NobleLizard","MYSTIC","TEMP_TAGS_LIZARD_SCHOLAR_MYSTIC");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_NobleLizard","LIZARD","TEMP_TAGS_LIZARD_SCHOLAR_MYSTIC");
DB_TEMP_OrTagCheck_Dialog("RC_ARX_NobleLizard","SCHOLAR","TEMP_TAGS_LIZARD_SCHOLAR_MYSTIC");

//END_REGION

//REGION IsSign
DB_IsSign(ITEMGUID_S_RC_DW_TavernSign_b13b32e5-334f-44c6-b59f-60caf7ee3b99,"RC_DW_Signs","RC_DW_Signs_TavernSign");
DB_IsSign(S_RC_DW_Signpost_774e9cf1-cade-431a-b835-c15794ab1c58,"RC_DW_Signs","RC_DW_Signs_Signpost");
DB_IsSign(S_RC_DW_Signpost_000_9deb451f-f933-4254-8d05-14b5771c5300,"RC_DW_Signs","RC_DW_Signs_Entrence");
//END_REGION
KBSECTION
IF
DB_TEMP_OrTagCheck_Dialog(_,_Tag,_Flag)
AND
DB_IsPlayer(_Char)
AND
IsTagged(_Char,_Tag,1)
THEN
ObjectSetFlag(_Char,_Flag);

PROC
PROC_GLOBAL_DialogStartRequested(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,(CHARACTERGUID)_Player)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4)
AND
GetDistanceTo(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76,_Dist)
AND
_Dist < 8.0
THEN
GlobalSetFlag("RC_DW_Barracks_InvestigatorInDialog");
Proc_StartDialog(0,"RC_DW_Barracks_Magister_Officer",
					CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,
					CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76,
					_Player);

IF
DialogEnded("RC_DW_Barracks_Magister_Officer",_)
AND
GlobalGetFlag("RC_DW_Barracks_InvestigatorInDialog",1)
THEN
GlobalClearFlag("RC_DW_Barracks_InvestigatorInDialog");

PROC
PROC_GLOBAL_DialogStartRequested(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,_Player)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4)
THEN
Proc_StartDialog(0,"RC_DW_Barracks_Magister_Officer",CHARACTERGUID_S_RC_DW_Barracks_Magister_Officer_e8e89cb2-f4b7-4066-a3cb-e04422dcdfa4,NULL_00000000-0000-0000-0000-000000000000,_Player);

IF
ObjectFlagSet("RC_DW_Barracks_SmashPlayer",_Player,_)
THEN
CharacterMoveTo(CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76,_Player,1,"RC_DW_Barracks_SmashPlayer",1);
DB_RC_DW_BarrackSmash(_Player);

IF
StoryEvent(CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76,"RC_DW_Barracks_SmashPlayer")
AND
DB_RC_DW_BarrackSmash(_Player)
THEN
PlayAnimation(CHARACTERGUID_S_RC_DW_Magister_Barracks_Investigator_f19a8674-160b-4907-b97d-7a15ee53dd76,"attack1");
ApplyStatus(_Player,"KNOCKED_DOWN",1.0,1);
NOT DB_RC_DW_BarrackSmash(_Player);


// StopTrade if Bad monthing Kniles
IF
ObjectFlagSet("RC_DW_Innkeeper_KnilesConvo",_Player,_Id)
AND
DialogGetInvolvedNPC(_Id,1,_NPC)
THEN
DB_PreventTradeBetween(_NPC,_Player);
DB_ManualTradeNPC(_NPC);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
