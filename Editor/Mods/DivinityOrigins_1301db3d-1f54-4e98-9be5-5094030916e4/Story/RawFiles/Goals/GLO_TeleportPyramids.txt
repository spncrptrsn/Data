Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_TeleporterPyramid((ITEMGUID)ITEMGUID_S_GLO_TeleportPyramid_001_fd45268f-5953-47c4-ba2f-255a05e2ce0e);
DB_TeleporterPyramid(ITEMGUID_S_GLO_TeleportPyramid_002_34810bdd-1185-468b-a5af-3298d0a861cf);
DB_TeleporterPyramid(ITEMGUID_S_GLO_TeleportPyramid_003_74f7068e-d388-4ffe-9e68-89406a6049d1);
DB_TeleporterPyramid(ITEMGUID_S_GLO_TeleportPyramid_004_e90a55e7-973e-4c77-b4b3-65f87808791c);

DB_TeleporterPyramidFlag((ITEMGUID)ITEMGUID_S_GLO_TeleportPyramid_001_fd45268f-5953-47c4-ba2f-255a05e2ce0e,"GLO_FoundTeleportPyramid_001");
DB_TeleporterPyramidFlag(ITEMGUID_S_GLO_TeleportPyramid_002_34810bdd-1185-468b-a5af-3298d0a861cf,"GLO_FoundTeleportPyramid_002");
DB_TeleporterPyramidFlag(ITEMGUID_S_GLO_TeleportPyramid_003_74f7068e-d388-4ffe-9e68-89406a6049d1,"GLO_FoundTeleportPyramid_003");
DB_TeleporterPyramidFlag(ITEMGUID_S_GLO_TeleportPyramid_004_e90a55e7-973e-4c77-b4b3-65f87808791c,"GLO_FoundTeleportPyramid_004");
// Flag-counter how many pyramids found so far:
//   GLO_TotalTeleportPyramidsFound_N
KBSECTION
IF
TextEventSet("tp")
AND
CharacterGetHostCharacter(_Player)
THEN
ObjectSetFlag(_Player,"Debug_AddPyramids");

IF
TextEventSet("blockTP")
THEN
Proc_PyramidGlobalBlockerOn();

IF
TextEventSet("enableTP")
THEN
Proc_PyramidGlobalBlockerOff();

IF
ObjectFlagSet("Debug_AddPyramids",(CHARACTERGUID)_Player,_)
AND
DB_TeleporterPyramid((ITEMGUID)_Pyramid)
THEN
ItemToInventory(_Pyramid,_Player);
DB_TeleporterPyramidUnlocked(_Pyramid);
ObjectClearFlag(_Player,"Debug_AddPyramids",0);

IF
TextEventSet("givepyramids")
AND
CharacterGetHostCharacter(_Player)
THEN
TeleportTo(ITEMGUID_S_GLO_TeleportPyramid_001_fd45268f-5953-47c4-ba2f-255a05e2ce0e,_Player);
TeleportTo(ITEMGUID_S_GLO_TeleportPyramid_002_34810bdd-1185-468b-a5af-3298d0a861cf,_Player);
TeleportTo(ITEMGUID_S_GLO_TeleportPyramid_003_74f7068e-d388-4ffe-9e68-89406a6049d1,_Player);
TeleportTo(ITEMGUID_S_GLO_TeleportPyramid_004_e90a55e7-973e-4c77-b4b3-65f87808791c,_Player);


IF
ItemAddedToCharacter(_Pyramid,_Player)
AND
DB_TeleporterPyramidFlag(_Pyramid,_Flag)
AND
DB_IsPlayer(_Player)
AND
PartyGetFlag(_Player,_Flag,0)
THEN
PartySetFlag(_Player,_Flag);
Proc_IncFoundPyramidsCounterFlag(_Player);
StartVoiceBark("GEN_VB_TeleportPyramids",_Player);

PROC
Proc_IncFoundPyramidsCounterFlag((CHARACTERGUID)_Player)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_3",1)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_4",0)
THEN
PartySetFlag(_Player,"GLO_TotalTeleportPyramidsFound_4");

PROC
Proc_IncFoundPyramidsCounterFlag((CHARACTERGUID)_Player)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_2",1)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_3",0)
THEN
PartySetFlag(_Player,"GLO_TotalTeleportPyramidsFound_3");

PROC
Proc_IncFoundPyramidsCounterFlag((CHARACTERGUID)_Player)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_1",1)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_2",0)
THEN
PartySetFlag(_Player,"GLO_TotalTeleportPyramidsFound_2");

PROC
Proc_IncFoundPyramidsCounterFlag((CHARACTERGUID)_Player)
AND
PartyGetFlag(_Player,"GLO_TotalTeleportPyramidsFound_1",0)
THEN
PartySetFlag(_Player,"GLO_TotalTeleportPyramidsFound_1");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Start"
