Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_OriginMomentTag("ARX_HorrorSleep_WarZone_LizardDreamer_1","RED PRINCE","ARX_HorrorSleep_WarZone_LizardDreamer_1_COM_RedPrince");
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Dialogs("ARX_HorrorSleep_WarZone_LizardDreamer_1");
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Dialogs("ARX_HorrorSleep_WarZone_LizardDreamer_1_COM_RedPrince");

Proc_PyramidBlockerTriggerAdd(TRIGGERGUID_S_ARX_HorrorSleep_WarZone_59391e6d-a22d-4f33-982b-a5b65c023e21);
DB_ARX_HorrorSleep_Warzone_Dreamer((CHARACTERGUID)CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_4_d1aa71d7-4d75-4c47-baec-b7077426b627);
DB_ARX_HorrorSleep_Warzone_Dreamer(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_2_cb0fd13b-6719-47ea-b660-8b858940eb1b);
DB_ARX_HorrorSleep_Warzone_Dreamer(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_5_90e70559-d9de-465c-9a07-86009e6f6a21);
DB_ARX_HorrorSleep_Warzone_Dreamer(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270);
DB_ARX_HorrorSleep_Warzone_Dreamer(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_3_cf0cf358-d803-44e0-a742-922152950472);

DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_5_90e70559-d9de-465c-9a07-86009e6f6a21,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_5_9f78fdb9-40b9-486a-a7c3-c4bc7adb98bf);
DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_2_cb0fd13b-6719-47ea-b660-8b858940eb1b,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_2_f7c97c11-62c4-4581-a427-498ed4b6c189);
DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_4_d1aa71d7-4d75-4c47-baec-b7077426b627,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_4_cd41b2a0-b774-4621-be0a-125c0adc8703);
DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_3_cf0cf358-d803-44e0-a742-922152950472,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_3_50eeb55c-00ff-4ed9-926c-278f478ede69);

DB_Dialogs(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_2_cb0fd13b-6719-47ea-b660-8b858940eb1b,"ARX_HorrorSleep_WarZone_LizardDreamer_Sleeping");
DB_Dialogs(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_3_cf0cf358-d803-44e0-a742-922152950472,"ARX_HorrorSleep_WarZone_LizardDreamer_Sleeping_3");
DB_Dialogs(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_4_d1aa71d7-4d75-4c47-baec-b7077426b627,"ARX_HorrorSleep_WarZone_LizardDreamer_Sleeping_4");
DB_Dialogs(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_5_90e70559-d9de-465c-9a07-86009e6f6a21,"ARX_HorrorSleep_WarZone_LizardDreamer_Sleeping_5");



DB_Dialogs(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,"ARX_HorrorSleep_WarZone_LizardDreamer_1");

//KeyToExit
ItemToInventory(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Key_469b0747-140c-47eb-bb04-895290a95f7a,CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270);
DB_GiveItemToEvent(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Key_469b0747-140c-47eb-bb04-895290a95f7a,"ARX_HorrorSleep_WarZone_GiveGlowingKey");
DB_HasStoryEvent(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Key_469b0747-140c-47eb-bb04-895290a95f7a,"ARX_HorrorSleep_WarZone_HasGlowingKey");

//shovel area
DB_ShovelArea(TRIGGERGUID_S_ARX_HorrorSleep_WarZone_Pile_BoxTrigger_2427c522-9f87-4296-a82d-b9870549a139,"ARX_HorrorSleep_WarZone_Pile",ITEMGUID_S_ARX_HorrorSleep_WarZone_Pile_25366344-98b8-46f6-85d5-91dd12715df4);
DB_ShovelRewardItemAppear("ARX_HorrorSleep_WarZone_Pile",ITEMGUID_S_ARX_HorrorSleep_WarZone_Pile_Chest_a74175ae-7a15-4b25-b18d-c8604d9063a1,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_Pile_PointT_4813e47b-b550-4e3d-94f1-6cc57f4065dd); 

TeleportTo(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270, TRIGGERGUID_S_ARX_HorrorSleep_WarZone_Brahmos_Destination_747d093d-ae55-44b8-a59a-e7aec69f1015);

DB_OneShotPlayerTrigger(TRIGGERGUID_S_ARX_HorrorSleep_WarZone_AD_SeesDreamer_c219e13e-8543-44ef-8397-2223b65c65fa);
SetOnStage(ITEMGUID_S_ARX_HorrorSleep_WarZone_Brahmos_Chair_f556102e-ca67-47d3-b51e-5c6f60a10672,0);
SetOnStage(ITEMGUID_S_ARX_WPN_Brahmos_Sword_2H_8b263e13-2793-4f1e-ab0a-68b991b23c2b,0);

CharacterLevelUpTo(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,19);
KBSECTION
//REGION Init Dreamers
PROC
ProcRegionStarted("ARX_Main")
AND
DB_Ghosts(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,_Ghost,_Dialog)
AND
QueryOnlyOnce("ARX_HorrorSleep_WarZone_Dreamer_IsInARX")
THEN
NOT DB_Ghosts(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,_Ghost,_Dialog);
DestroyGhost(_Ghost);
DB_Ghosts(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,CHARACTERGUID_S_GLO_Brahmos_Ghost_91150062-5d00-4b96-a61f-e2b808b50680,"ARX_HorrorSleep_WarZone_LizardDreamer_1_Ghost");

PROC
ProcRegionStarted("ARX_Main")
AND
NOT DB_Ghosts(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,_,_)
AND
QueryOnlyOnce("ARX_HorrorSleep_WarZone_Dreamer_IsInARX")
THEN
DB_Ghosts(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,CHARACTERGUID_S_GLO_Brahmos_Ghost_91150062-5d00-4b96-a61f-e2b808b50680,"ARX_HorrorSleep_WarZone_LizardDreamer_1_Ghost");

IF
DB_ARX_HorrorSleep_Warzone_Dreamer(_NPC)
AND
_NPC != CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270
THEN
//ApplyStatus(_NPC,"SLEEPING",-1.0,1); Added through script
PROC_LoopEffect("RS3_FX_GP_ScriptedEvent_FJ_RedPrinceO_DreamerStatus_01",_NPC,"ARX_HorrorSleep_Warzone_DreamerStatus","ARX_Main","Dummy_BodyFX"); 

IF
CharacterEnteredTrigger(_Player,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_59391e6d-a22d-4f33-982b-a5b65c023e21)
AND
DB_IsPlayer(_Player)
AND
QueryOnlyOnce("ARX_HorrorSleep_WarZone_LizardDreamer_Effect")
AND
PlayLoopEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,"RS3_FX_GP_ScriptedEvent_HorrorSleep_Portal_DreamLizard_01","",_Handle)
THEN
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);



//END_REGION

//REGION Brahmos Death

IF
CharacterDying(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270)
THEN
SetOnStage(ITEMGUID_S_ARX_WPN_Brahmos_Sword_2H_8b263e13-2793-4f1e-ab0a-68b991b23c2b,1);
ItemToInventory(ITEMGUID_S_ARX_WPN_Brahmos_Sword_2H_8b263e13-2793-4f1e-ab0a-68b991b23c2b,CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,1);

//END_REGION

//REGION Main Dreamer Start dialog
PROC
ProcOneShotTriggerEntered(_Player,TRIGGERGUID_S_ARX_HorrorSleep_WarZone_AD_SeesDreamer_c219e13e-8543-44ef-8397-2223b65c65fa)
THEN
StartVoiceBark("ARX_HorrorSleep_WarZone_VB_SeesDreamers",_Player);

IF
CharacterCharacterEvent(_Dreamer,_Player,"ARX_HorrorSleep_Warzone_MainDreamerStartDialog")
THEN
PROC_StartDialog_WithVisibleTag(_Dreamer,_Player,"ARX_HorrorSleep_WarZone_LizardDreamer_1","RED PRINCE","LIZARD",1);

IF
DB_Sees(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f)
AND
DB_DialogNPCs(_ID,CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_)
AND
DB_DialogPlayers(_ID,_Player,_)
AND
ObjectGetFlag(_Player,"HostileAlignmentAfterDialog",0)
AND
GlobalGetFlag("ARX_HorrorSleep_WarZone_LizardDreamer_1_EndedOnce",0)
THEN
ProcForceStopDialog(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270);
ProcForceStopDialog(_Player);
DB_PROC_StartDialog_WithVisibleTag_AddPlayers(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,"ARX_HorrorSleep_WarZone_LizardDreamer_1");
Proc_StartDialog(0,"ARX_HorrorSleep_WarZone_LizardDreamer_1",CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f);

IF
DialogEnded("ARX_HorrorSleep_WarZone_LizardDreamer_1",_ID)
THEN
GlobalSetFlag("ARX_HorrorSleep_WarZone_LizardDreamer_1_EndedOnce");

IF
DialogStarted(_Dialog,_ID)
AND
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Dialogs(_Dialog)
AND
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle)
THEN
StopLoopEffect(_Handle);
NOT DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);

IF
DialogEnded(_Dialog,_ID)
AND
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Dialogs(_Dialog)
AND
NOT DB_GlobalFlag("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass")
AND
DB_DialogPlayers(_ID,_Player,_)
AND
ObjectGetFlag(_Player,"ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass",1)
THEN
GlobalSetFlag("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass");

IF
ObjectFlagSet("ARX_HorrorSleep_WarZone_WalkToPrince",CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,_ID)
THEN
CharacterMoveTo(CHARACTERGUID_S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,CHARACTERGUID_S_Player_RedPrince_a26a1efb-cdc8-4cf3-a7b2-b2f9544add6f,0,"",0);

IF
GlobalFlagSet("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass")
AND
DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(_LizardDreamer,_TeleportTrigger)
THEN
PROC_StopLoopEffect(_LizardDreamer,"ARX_HorrorSleep_Warzone_DreamerStatus");
//This is where they stay awake and need new dialogs part of ARX2-260

IF
GlobalFlagSet("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass")
THEN
Foop(ITEMGUID_S_ARX_HorrorSleep_WarZone_Brahmos_Chair_f556102e-ca67-47d3-b51e-5c6f60a10672);

IF
DialogEnded(_Dialog,_ID)
AND
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Dialogs(_Dialog)
AND
GlobalGetFlag("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass",0)
AND
DB_DialogNPCs(_ID,CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_)
AND
CharacterIsInCombat(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,0)
AND
NOT DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_)
AND
PlayLoopEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,"RS3_FX_GP_ScriptedEvent_HorrorSleep_Portal_DreamLizard_01","",_Handle)
THEN
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);


//END_REGION

//REGION Exit The WarZone
PROC
ProcBlockUseOfItem(_Player,ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d)
AND
ItemIsLocked(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,1)
AND
ItemIsInPartyInventory(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Key_469b0747-140c-47eb-bb04-895290a95f7a,_Player,0,1)
THEN
ItemUnLock(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d);
DB_CustomUseItemResponse(_Player,ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,0);
Proc_ARX_HorrorSleep_TeleportToSunSet(_Player,1);

PROC
//CharacterUsedItem(_Player,ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d)
ProcBlockUseOfItem(_Player,ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d)
AND
ItemIsLocked(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,0)
THEN
DB_CustomUseItemResponse(_Player,ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,0);
Proc_ARX_HorrorSleep_TeleportToSunSet(_Player,1);

PROC
Proc_ARX_HorrorSleep_TeleportToSunSet((CHARACTERGUID)_Char,1)
AND
ItemIsOpened(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,0)
THEN
ItemOpen(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d);

PROC
Proc_ARX_HorrorSleep_TeleportToSunSet((CHARACTERGUID)_Char,1)
AND
DB_IsPlayer(_Player)
AND
CharactersAreGrouped(_Char,_Player,1)
THEN
ApplyStatus(_Char,"BLIND",3.0,1);

PROC
Proc_ARX_HorrorSleep_TeleportToSunSet((CHARACTERGUID)_Char,1)
THEN
FadeToWhite(_Char,2.0,0,"ARX_HorrorSleep_TeleportToSunSet");
ProcObjectTimer(_Char,"ARX_HorrorSleep_TeleportToSunSet",3000);

PROC
Proc_ARX_HorrorSleep_TeleportToSunSet((CHARACTERGUID)_Char,0)
THEN
ProcObjectTimer(_Char,"ARX_HorrorSleep_TeleportToSunSet",200);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Char,"ARX_HorrorSleep_TeleportToSunSet")
THEN
TeleportTo(_Char,TRIGGERGUID_S_ARX_HorrorSleep_SunSetStart_c62f811c-a9a9-49b2-be96-76a0c2781039,"ARX_HorrorSleep_TeleportToSunSet",1);
PlayEffect(_Char,"RS3_FX_GP_ScriptedEvent_FJ_RedPrinceO_DarknessFadeIn_01");
FadeToWhite(_Char,2.0,1,"ARX_HorrorSleep_TeleportToSunSet");


PROC
ProcObjectTimerFinished((CHARACTERGUID)_Char,"ARX_HorrorSleep_TeleportToSunSet")
AND
DB_IsPlayer(_Other)
AND
CharactersAreGrouped(_Other,_Char,1)
THEN
CharacterRemoveSummons(_Other,0);
LeaveCombat(_Other);


PROC
ProcObjectTimerFinished(_Char,"ARX_HorrorSleep_TeleportToSunSet")
AND
QueryOnlyOnce("ARX_VB_HorrorSleep_SunSet_Enter")
THEN
ProcObjectTimer(_Char,"ARX_VB_HorrorSleep_SunSet_Enter",4000);

PROC
ProcObjectTimerFinished(_Char,"ARX_HorrorSleep_TeleportToSunSet")
AND
ItemIsOpened(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d,1)
THEN
ItemClose(ITEMGUID_S_ARX_HorrorSleep_Warzone_ExitDoor_Door_6accb524-03a0-41cb-984b-aecc007ccf3d);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Char,"ARX_VB_HorrorSleep_SunSet_Enter")
THEN
StartVoiceBark("ARX_VB_HorrorSleep_SunSet_Enter",_Char);
//END_REGION

//REGION Start Combat 


IF
ObjectEnteredCombat(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_ID)
AND
DB_ARX_HorrorSleep_Warzone_Dreamer_CombatTeleport_Point(_LizardDreamer,_TeleportTrigger)
THEN
Foop(_LizardDreamer);
TeleportTo(_LizardDreamer,_TeleportTrigger);
PlayEffect(_LizardDreamer,"RS3_FX_GP_ScriptedEvent_Teleport_GenericSmoke_01");

IF
ObjectEnteredCombat(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_ID)
AND
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle)
THEN
StopLoopEffect(_Handle);
NOT DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);

IF
ObjectLeftCombat(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_ID)
AND
GlobalGetFlag("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass",0)
AND
CharacterIsDead(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,0)
AND
NOT DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_)
AND
PlayLoopEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,"RS3_FX_GP_ScriptedEvent_HorrorSleep_Portal_DreamLizard_01","",_Handle)
THEN
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);

IF
CharacterDied(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270)
AND
DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle)
THEN
StopLoopEffect(_Handle);
NOT DB_ARX_HorrorSleep_WarZone_LoopingEffect(ITEMGUID_S_ARX_HorrorSleep_WarZone_LoopingEffect_a5b98d67-c00e-4a11-aaf2-cca261314b20,_Handle);

IF
CharacterKilledBy(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_AttackerOwner,_Attacker)
AND
DB_IsPlayer(_AttackerOwner)
THEN
PartySetFlag(_AttackerOwner,"ARX_HorrorSleep_WarZone_Killed_LizardDreamer1");


IF
ObjectEnteredCombat(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_ID)
THEN
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Combat(_ID);

IF
CombatEnded(_ID)
AND
DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Combat(_ID)
AND
DB_IsPlayer(_Player)
AND
DB_WasInCombat(_Player,_ID)
AND
QueryOnlyOnce("ARX_HorrorSleep_WarZone_AD_Player_PostCombat_LizardDreamer")
THEN
Proc_StartDialog(1,"ARX_HorrorSleep_WarZone_AD_Player_PostCombat_LizardDreamer",_Player);
NOT DB_ARX_HorrorSleep_WarZone_LizardDreamer_1_Combat(_ID);

//END_REGION

//REGION Journal 

IF
ObjectFlagSet("ARX_HorrorSleep_WarZone_LizardDreamer_LetPlayerPass",_Player,_ID)
THEN
ObjectSetFlag(_Player,"QuestUpdate_ARX_LizardConsulate_HorrorSleepWarzone_Dreamer_LetMePass",_ID);

PROC
ProcObjectTimerFinished(_Player,"ARX_HorrorSleep_TeleportToSunSet")
THEN
ObjectSetFlag(_Player,"QuestUpdate_ARX_LizardConsulate_HorrorSleepSunset_Start",0);


IF
CharacterDied(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270)
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(_Player,"QuestUpdate_ARX_LizardConsulate_HorrorSleepWarzone_Enter",1)
THEN
ObjectSetFlag(_Player,"QuestUpdate_ARX_LizardConsulate_HorrorSleepWarzone_DreamerDead");



//END_REGION 

//REGION Debug 
IF 
TextEventSet("StartDialogDremer")
AND
GetClosestAlivePlayer(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_Player,_Dist)
THEN
PROC_StartDialog_WithVisibleTag(CHARACTERGUID_S_ARX_HorrorSleep_WarZone_LizardDreamer_1_d4064352-33f9-49df-b208-09fd822d2270,_Player,"ARX_HorrorSleep_WarZone_LizardDreamer_1","RED PRINCE","LIZARD",1);
//END_REGION

IF
DialogEnded("ARX_HorrorSleep_WarZone_LizardDreamer_1",_)
THEN
ObjectClearFlag(S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,"talkAboutConsulate");
ObjectClearFlag(S_GLO_Brahmos_d4064352-33f9-49df-b208-09fd822d2270,"talkAboutHorrorsleep");
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ARX"
