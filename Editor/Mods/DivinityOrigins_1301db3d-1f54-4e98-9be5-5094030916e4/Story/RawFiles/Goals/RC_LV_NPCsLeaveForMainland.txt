Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_GLO_LVNPCsLeaving_LVTriggers("RC_Main",(TRIGGERGUID)S_RC_LV_OnBoard_3d5b3e43-2126-464e-81d1-3c0b60841276,S_RC_LV_Entrance_5d830273-0215-4be4-96ce-8a1122f01bb0,(TRIGGERGUID)S_RC_LV_Exit_07c3b04e-f9d4-469d-b498-d9dab649084a,70);
// River leaves immediately
// DB_GLO_LVNPCsLeaving_NPC("RC_Main",CHARACTERGUID_S_GLO_River_f4931ebe-10b0-43c4-9182-640cf052717e);
// Gareth
DB_GLO_LVNPCsLeaving_NPC("RC_Main",(CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54);
// Han stays on the boat
//DB_GLO_LVNPCsLeaving_NPC("RC_Main",CHARACTERGUID_S_FTJ_CapturedChild_53d4aa5c-dd91-4e12-9ca8-d66879cc6ffb);
// Tarquin
DB_GLO_LVNPCsLeaving_NPC("RC_Main",CHARACTERGUID_S_GLO_Tarquin_a3d0cdcc-d0b0-464d-9ad7-43b38baed620);

DB_GLO_LVNPCsLeaving_NPC_ProximityTrigger("RC_Main",(CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,(TRIGGERGUID)TRIGGERGUID_S_RC_DW_GarethJonathanScene_ProximityBox_c81e959a-c9a7-4532-a27c-30f17c171cf6,"GarethJonathanScene",500);
DB_GLO_LVNPCsLeaving_NPC_EmergencyTrigger("RC_Main",(CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,(TRIGGERGUID)TRIGGERGUID_S_RC_DW_GarethJonathanScene_EmergencyBox_b12aa523-2f2a-477d-b79a-fe439fa671ba,"GarethJonathanScene",500);
DB_GLO_LVNPCsLeaving_NPC_ProximityTrigger("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,TRIGGERGUID_S_RC_FL_GarethFarm_Setup_da4c6510-e2fb-4aa5-b978-bbc8797e6c32,"GarethFarm",700);
DB_GLO_LVNPCsLeaving_NPC_EmergencyTrigger("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,TRIGGERGUID_S_RC_FL_GarethFarm_Setup_2_bfa27265-ddc6-42c3-a6ee-33dbc7ec6e3b,"GarethFarm",700);

DB_GLO_LVNPCsLeaving_NPC_ProximityTrigger("RC_Main",CHARACTERGUID_S_GLO_Tarquin_a3d0cdcc-d0b0-464d-9ad7-43b38baed620,S_RC_GY_TarquinProximityBox_99ca2b43-33b6-40d1-a43d-c55b8eb4736b,"",0);
DB_GLO_LVNPCsLeaving_NPC_EmergencyTrigger("RC_Main",CHARACTERGUID_S_GLO_Tarquin_a3d0cdcc-d0b0-464d-9ad7-43b38baed620,S_RC_GY_TarquinEmergencyBox_af785a5f-20eb-43a6-a33e-dd695eec2035,"",0);
KBSECTION
//REGION Fallback in case players (almost) learn location of CoS before quest NPCs have left the LV after arrival
// Meistr
IF
ObjectFlagSet("GLO_Has3MaxMP",_,_)
THEN
PROC_GLO_LVNPCsLeaving_LeaveForMainland("RC_Main");

// Demon on Blood Island (begin of quest, but it's far in RC_Main so that's fine
IF
GlobalFlagSet("RC_BI_RiverInCamp")
THEN
PROC_GLO_LVNPCsLeaving_LeaveForMainland("RC_Main");

// Debug events whereby you learn the location of CoS right away
IF
ObjectFlagSet("RC_DW_KnowCos",_,_)
THEN
PROC_GLO_LVNPCsLeaving_LeaveForMainland("RC_Main");
//END_REGION

//REGION Handle individual NPC setups

//REGION Gareth
// Always set up the Gareth & Jonathan scene, since the original code did that too
IF
StoryEvent((CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GLO_LVNPCsLeaving_OutOfSight")
AND
DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,_,_Priority)
AND
QueryOnlyOnce("RC_FL_GarethAndJonathanSetUp")
THEN
PROC_Setup_GarethAndJonathan();

IF
StoryEvent((CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GLO_LVNPCsLeaving_OutOfSight")
AND
DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethJonathanScene",_Priority)
THEN
NOT DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethJonathanScene",_Priority);

IF
StoryEvent((CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GLO_LVNPCsLeaving_OutOfSight")
AND
DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethFarm",_Priority)
AND
QueryOnlyOnce("RC_FL_GarethAndJonathanSetUp")
THEN
PROC_Setup_GarethAndJonathan();

IF
StoryEvent((CHARACTERGUID)CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GLO_LVNPCsLeaving_OutOfSight")
AND
DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethFarm",_Priority)
THEN
NOT DB_GLO_LVNPCsLeaving_NPC_LeavingFor("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethFarm",_Priority);
PROC_RC_DF_EmergencyJonathanSceneStop();
//END_REGION

//REGION Emergency exit for Gareth
PROC
PROC_GLO_LVNPCsLeaving_EmergencyExit("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,_)
AND
QueryOnlyOnce("RC_FL_GarethAndJonathanSetUp")
THEN
PROC_Setup_GarethAndJonathan();

PROC
PROC_GLO_LVNPCsLeaving_ProximityAlert("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethFarm",_)
THEN
PROC_RC_DF_EmergencyJonathanSceneStop();

PROC
PROC_GLO_LVNPCsLeaving_EmergencyExit("RC_Main",CHARACTERGUID_S_FTJ_SW_Warrior_SeekerCaptain_1329f018-23e4-4717-9bc8-074b28d04c54,"GarethFarm")
THEN
PROC_RC_DF_GarethAndJonathanSetupNextScene();
//END_REGION

//REGION Tarquin
// Nothing special needed, his own goal (RC_GY_NecromancerDynamocEvent) will teleport him to the correct small/subtrigger
// when a player gets near and make him appear out of sight
//END_REGION

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ReapersCoast"
