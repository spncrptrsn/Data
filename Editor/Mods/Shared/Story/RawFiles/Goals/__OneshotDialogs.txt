Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
//REGION One Shot Normal Dialogs
IF
DB_OneShot_PlayerOnlyDialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC)
THEN
DB_OneShotPlayerOnlyTrigger(_Trigger);
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,1);
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1);

IF
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,1);
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1);

IF
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,2);
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1);
DB_OneShot_DialogSpeakers(_Trigger,_Npc2,2);

IF
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2,(CHARACTERGUID)_NPC3)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,3);
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1);
DB_OneShot_DialogSpeakers(_Trigger,_Npc2,2);
DB_OneShot_DialogSpeakers(_Trigger,_Npc3,3);

IF
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2,(CHARACTERGUID)_NPC3,(CHARACTERGUID)_NPC4)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,4);
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1);
DB_OneShot_DialogSpeakers(_Trigger,_Npc2,2);
DB_OneShot_DialogSpeakers(_Trigger,_Npc3,3);
DB_OneShot_DialogSpeakers(_Trigger,_Npc4,4);

PROC
ProcCheckIfNPCsBusy((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,_)
AND
NOT QRY_SpeakerIsAvailable(_Npc,1)
THEN
DB_OneShot_BusyNPC(_Trigger);

PROC
ProcDoStartOneShotDialog((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,1)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1)
THEN
Proc_StartDialog(0,_Dialog,_Npc,_Player);

PROC
ProcDoStartOneShotDialog((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,2)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc2,2)
THEN
Proc_StartDialog(0,_Dialog,_Npc,_Npc2,_Player);

PROC
ProcDoStartOneShotDialog((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,3)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,1)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc2,2)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc3,3)
THEN
Proc_StartDialog(0,_Dialog,_Npc,_Npc2,_Npc3,_Player);

PROC
ProcStartOneShotDialog((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
NOT DB_OneShot_BusyNPC(_Trigger)
THEN
ProcDoStartOneShotDialog(_Player,_Trigger);

PROC
ProcClearOneShotCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,1)
AND
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC)
THEN
NOT DB_OneShot_DialogTrigger(_Trigger,_Dialog,_NPC);

PROC
ProcClearOneShotCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,2)
AND
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2)
THEN
NOT DB_OneShot_DialogTrigger(_Trigger,_Dialog,_NPC,_NPC2);

PROC
ProcClearOneShotCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,3)
AND
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2,(CHARACTERGUID)_NPC3)
THEN
NOT DB_OneShot_DialogTrigger(_Trigger,_Dialog,_NPC,_NPC2,_NPC3);


PROC
ProcClearOneShotCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,4)
AND
DB_OneShot_DialogTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2,(CHARACTERGUID)_NPC3,(CHARACTERGUID)_NPC4)
THEN
NOT DB_OneShot_DialogTrigger(_Trigger,_Dialog,_NPC,_NPC2,_NPC3,_NPC4);

PROC
ProcClearOneShotCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,_Count)
THEN
NOT DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,_Count);

PROC
ProcClearOneShotSpeakers((TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,_Count)
THEN
NOT DB_OneShot_DialogSpeakers(_Trigger,_Npc,_Count);

PROC
ProcOneShotDialogCleanup((TRIGGERGUID)_Trigger)
THEN
ProcClearOneShotCount(_Trigger);
ProcClearOneShotSpeakers(_Trigger);

PROC
RemoveOneShotDialog((TRIGGERGUID)_Trigger)
THEN
ProcOneShotDialogCleanup(_Trigger);
ProcTriggerUnregisterForPlayers(_Trigger);
NOT DB_OneShotPlayerTrigger(_Trigger);

IF
DB_Dead(_Npc)
AND
DB_OneShot_DialogSpeakers(_Trigger,_Npc,_)
THEN
RemoveOneShotDialog(_Trigger);

PROC
ProcOneShotTriggerEntered((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_,_)
AND
QRY_SpeakerIsAvailable(_Player)
THEN
ProcCheckIfNPCsBusy(_Trigger); //TODO: do this busy check? Dialogs won't ever start if one of these NPCs is busy
ProcStartOneShotDialog(_Player,_Trigger);

PROC
ProcStartOneShotDialog(_,(TRIGGERGUID)_Trigger)
THEN
NOT DB_OneShot_BusyNPC(_Trigger);

PROC
ProcStartOneShotDialog(_,(TRIGGERGUID)_Trigger)
THEN
ProcOneShotDialogCleanup(_Trigger);

//if the dialog is started (manually), cleanup so this doesn't get started again
IF
DialogStarted(_Dialog,_)
AND
DB_OneShot_DialogSpeakerCount(_Trigger,_Dialog,_Count)
THEN
ProcOneShotDialogCleanup(_Trigger);
ProcTriggerUnregisterForPlayers(_Trigger);
NOT DB_OneShotPlayerTrigger(_Trigger); //because this might not have triggerd yet and we don't want to leave these around

//END_REGION

//REGION One Shot Automated Dialogs

IF
DB_OneShot_ADTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,1);
DB_OneShot_ADSpeakers(_Trigger,_Npc,1);

IF
DB_OneShot_ADTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2)
THEN
DB_OneShotPlayerTrigger(_Trigger);
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,2);
DB_OneShot_ADSpeakers(_Trigger,_Npc,1);
DB_OneShot_ADSpeakers(_Trigger,_Npc2,2);

PROC
ProcDoStartOneShotAD((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,1)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc,1)
THEN
Proc_StartDialog(1,_Dialog,_Npc);

PROC
ProcDoStartOneShotAD((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,2)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc,1)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc2,2)
THEN
Proc_StartDialog(1,_Dialog,_Npc,_Npc2);

PROC
ProcClearOneShotADCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,1)
AND
DB_OneShot_ADTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC)
THEN
NOT DB_OneShot_ADTrigger(_Trigger,_Dialog,_NPC);

PROC
ProcClearOneShotADCount((TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,2)
AND
DB_OneShot_ADTrigger((TRIGGERGUID)_Trigger,(STRING)_Dialog,(CHARACTERGUID)_NPC,(CHARACTERGUID)_NPC2)
THEN
NOT DB_OneShot_ADTrigger(_Trigger,_Dialog,_NPC,_NPC2);

PROC
ProcClearOneShotADSpeakers((TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc,_Count)
THEN
NOT DB_OneShot_ADSpeakers(_Trigger,_Npc,_Count);

PROC
ProcOneShotADCleanup((TRIGGERGUID)_Trigger)
THEN
ProcClearOneShotADCount(_Trigger);
ProcClearOneShotADSpeakers(_Trigger);

PROC
RemoveOneShotAD((TRIGGERGUID)_Trigger)
THEN
ProcOneShotADCleanup(_Trigger);
ProcTriggerUnregisterForPlayers(_Trigger);
NOT DB_OneShotPlayerTrigger(_Trigger);

IF
DB_Dead(_Npc)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc,_)
THEN
RemoveOneShotAD(_Trigger);

PROC
ProcOneShotTriggerEntered((CHARACTERGUID)_Player,(TRIGGERGUID)_Trigger)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_,_)
AND
DB_OneShot_ADSpeakers(_Trigger,_Npc,1)
AND
QRY_SpeakerIsAvailable(_Player)
AND
QRY_SpeakerIsAvailable(_Npc)
THEN
ProcDoStartOneShotAD(_Player,_Trigger);
ProcOneShotADCleanup(_Trigger);

//if the dialog is started (manually), cleanup so this doesn't get started again
IF
AutomatedDialogStarted(_Dialog,_)
AND
DB_OneShot_ADSpeakerCount(_Trigger,_Dialog,_Count)
THEN
ProcOneShotADCleanup(_Trigger);
ProcTriggerUnregisterForPlayers(_Trigger);

//END_REGION

//REGION One Shot Voice Bark

IF
DB_OneShot_VoiceBarkTrigger((TRIGGERGUID)_Trigger,(STRING)_VoiceBark)
THEN
DB_OneShotPlayerTrigger(_Trigger);

PROC
ProcOneShotTriggerEntered(_Player,_Trigger)
AND
DB_OneShot_VoiceBarkTrigger(_Trigger,_VoiceBark)
AND
QRY_SpeakerIsAvailable(_Player)
THEN
StartVoiceBark(_VoiceBark,_Player);

IF
VoiceBarkStarted(_VoiceBark,_)
AND
DB_OneShot_VoiceBarkTrigger(_Trigger,_VoiceBark)
THEN
NOT DB_OneShot_VoiceBarkTrigger(_Trigger,_VoiceBark);

IF
VoiceBarkFailed(_VoiceBark)
AND
DB_OneShot_VoiceBarkTrigger(_Trigger,_VoiceBark)
THEN
NOT DB_OneShot_VoiceBarkTrigger(_Trigger,_VoiceBark);

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
